(function(b){b.fn.drag=function(i,j,k){if(j){this.bind("dragstart",i)}if(k){this.bind("dragend",k)}return !i?this.trigger("drag"):this.bind("drag",j?j:i)};var f=b.event,h=f.special,d=h.drag={not:":input",distance:0,which:1,setup:function(i){i=b.extend({distance:d.distance,which:d.which,not:d.not},i||{});i.distance=c(i.distance);f.add(this,"mousedown",e,i)},teardown:function(){f.remove(this,"mousedown",e);if(this===d.dragging){d.dragging=d.proxy=null}g(this,true)}};function e(j){var k=this,l,i=j.data||{};if(i.elem){k=j.dragTarget=i.elem;j.dragProxy=d.proxy||k;j.cursorOffsetX=i.pageX-i.left;j.cursorOffsetY=i.pageY-i.top;j.offsetX=j.pageX-j.cursorOffsetX;j.offsetY=j.pageY-j.cursorOffsetY}else{if(d.dragging||(i.which>0&&j.which!=i.which)||b(j.target).is(i.not)){return}}switch(j.type){case"mousedown":b.extend(i,b(k).offset(),{elem:k,target:j.target,pageX:j.pageX,pageY:j.pageY});f.add(document,"mousemove mouseup",e,i);g(k,false);return false;case !d.dragging&&"mousemove":if(c(j.pageX-i.pageX)+c(j.pageY-i.pageY)<i.distance){break}j.target=i.target;l=a(j,"dragstart",k);if(l!==false){d.dragging=k;d.proxy=j.dragProxy=b(l||k)[0]}case"mousemove":if(d.dragging){l=a(j,"drag",k);if(h.drop){h.drop.allowed=(l!==false);h.drop.handler(j)}if(l!==false){break}j.type="mouseup"}case"mouseup":f.remove(document,"mousemove mouseup",e);if(d.dragging){if(h.drop){h.drop.handler(j)}a(j,"dragend",k)}g(k,true);d.dragging=d.proxy=i.elem=null;break}}function a(i,k,j){i.type=k;var l=f.dispatch.call(j,i);return l===false?false:l||i.result}function c(i){return Math.pow(i,2)}function g(i,j){if(!i){return}i.unselectable=j?"off":"on";i.onselectstart=function(){return j};if(document.selection&&document.selection.empty){document.selection.empty()}if(i.style){i.style.MozUserSelect=j?"":"none"}}})(jQuery);(function(a){a.fn.kiketable_colsizable=function(b){b=a.extend({},a.fn.kiketable_colsizable.defaults,b);b.dragProxy=(b.dragProxy==="line")?false:true;this.filter("table:not(."+b.namespace+")").addClass(b.namespace).each(function(e){b.renderTime=new Date().getTime();var c=this,f=a(this),d=c.getElementsByTagName("col");d.length&&a(b.dragCells,this).each(function(g){if(!a(this).hasClass("kiketable-th")){a(this).addClass("kiketable-th").wrapInner('<div class="kiketable-th-text"></div>')}a('<div class="'+b.classHandler+'" title="'+b.title+'"></div>').prependTo(this).each(function(){this.td=this.parentNode;this.$td=a(this.td);this.col=d[this.td.cellIndex]}).dblclick(function(){if(this.wtd==null){this.wtd=this.col.offsetWidth;this.wtd0=this.wtd}var h=this.wtd==b.minWidth;this.wtd=(h)?this.wtd0:b.minWidth;this.col.style.width=this.wtd+"px";if(!b.fixWidth){var i=this.wtd0-b.minWidth;c.style.width=f.width()+((h)?i:-i)+"px"}a(this).trigger("minimized")}).bind("dragstart",function(h){this.cell_width=this.$td.width();this.table_width=f.width();this.left0=h.offsetX;this.d1=this.cell_width-this.left0;this.d2=b.minWidth-this.d1;return a(this).clone().appendTo(this.td).css("opacity",b.dragOpacity).css((b.dragProxy)?{top:this.$td.offset().top,left:this.$td.offset().left,width:this.cell_width}:{top:this.$td.offset().top,left:h.offsetX}).removeClass(b.classHandler).addClass((b.dragProxy)?b.classDragArea:b.classDragLine).height(f.height())}).bind("drag",(b.dragMove||b.dragProxy)?function(i){var h=i.offsetX+this.d1;if(h-this.d2-this.d1>=0){i.dragProxy.style.width=h+"px";if(b.dragMove){this.col.style.width=h+"px";if(!b.fixWidth){c.style.width=(this.table_width-this.cell_width+h)+"px"}}}}:function(i){var h=i.offsetX;if(h-this.d2>=0){i.dragProxy.style.left=h+"px"}}).bind("dragend",function(h){if(!b.dragMove){var i=parseInt(h.dragProxy.style.left)-this.left0;this.col.style.width=(b.dragProxy)?h.dragProxy.style.width:(this.cell_width+i)+"px";if(!b.fixWidth){c.style.width=((b.dragProxy)?this.table_width-this.cell_width+parseInt(h.dragProxy.style.width):this.table_width+i)+"px"}}a(h.dragProxy)[b.fxHide](b.fxSpeed,function(){a(this).remove()});a(this).trigger("minimized")}).bind("minimized",function(h){a(this.col)[(parseInt(this.col.style.width)<=b.minWidth)?"addClass":"removeClass"](b.classMinimized)})});b.renderTime=new Date().getTime()-b.renderTime;b.onLoad()});return this};a.fn.kiketable_colsizable.defaults={dragCells:"tr:first > *",dragMove:true,dragProxy:"line",dragOpacity:0.3,minWidth:8,fixWidth:false,fxHide:"fadeOut",fxSpeed:200,namespace:"kiketable-colsizable",classHandler:"kiketable-colsizable-handler",classDragLine:"kiketable-colsizable-dragLine",classDragArea:"kiketable-colsizable-dragArea",classMinimized:"kiketable-colsizable-minimized",title:"Expand/Collapse this column",renderTime:0,onLoad:function(){}}})(jQuery);(function(c){var d={listTargetID:null,onClass:"",offClass:"",hideInList:[],colsHidden:[],saveState:false,onToggle:null,show:function(k){a(k)},hide:function(k){b(k)}};var e=0;var h="columnManagerC";var g=function(n){var m="",k=0,l=n.cMColsVisible;if(n.cMSaveState&&n.id&&l&&c.cookie){for(;k<l.length;k++){m+=(l[k]==false)?0:1}c.cookie(h+n.id,m,{expires:9999})}};var b=function(k){if(jQuery.browser.msie){(b=function(l){l.style.setAttribute("display","none")})(k)}else{(b=function(l){l.style.display="none"})(k)}};var a=function(k){if(jQuery.browser.msie){(a=function(l){l.style.setAttribute("display","block")})(k)}else{(a=function(l){l.style.display="table-cell"})(k)}};var i=function(k){if(jQuery.browser.msie){return(i=function(l){return l.style.getAttribute("display")!="none"})(k)}else{return(i=function(l){return l.style.display!="none"})(k)}};var f=function(m,k,l){for(var n=0;n<k.length;n++){if(k[n].realIndex===undefined){j(m)}if(k[n].realIndex==l){return k[n]}}return null};var j=function(m){var k=m.rows;var s=k.length;var n=[];for(var u=0;u<s;u++){var l=k[u].cells;var o=l.length;for(var v=0;v<o;v++){var p=l[v];var q=p.rowSpan||1;var t=p.colSpan||1;var r=-1;if(!n[u]){n[u]=[]}var y=n[u];while(y[++r]){}p.realIndex=r;for(var w=u;w<u+q;w++){if(!n[w]){n[w]=[]}var z=n[w];for(var x=r;x<r+t;x++){z[x]=1}}}}};c.fn.columnManager=function(n){var m=c.extend({},d,n);var o=function(q){if(!m.listTargetID){return}var y=c("#"+m.listTargetID);if(!y.length){return}var r=null;if(q.tHead&&q.tHead.length){r=q.tHead.rows[0]}else{if(q.rows.length){r=q.rows[0]}else{return}}var p=r.cells;if(!p.length){return}var w=null;if(y.get(0).nodeName.toUpperCase()=="UL"){w=y}else{w=c("<ul></ul>");y.append(w)}var u=q.cMColsVisible;for(var x=0;x<p.length;x++){if(c.inArray(x+1,m.hideInList)>=0){continue}u[x]=(u[x]!==undefined)?u[x]:true;var s=c(p[x]).text(),v;if(!s.length){s=c(p[x]).html();if(!s.length){s="undefined"}}if(u[x]&&m.onClass){v=m.onClass}else{if(!u[x]&&m.offClass){v=m.offClass}}var t=c('<li class="'+v+'">'+s+"</li>").click(k);t[0].cmData={id:q.id,col:x};w.append(t)}q.cMColsVisible=u};var k=function(){var p=this.cmData;if(p&&p.id&&p.col>=0){var r=p.col,q=c("#"+p.id);if(q.length){q.toggleColumns([r+1],m);var s=q.get(0).cMColsVisible;if(m.onToggle){m.onToggle.apply(q.get(0),[r+1,s[r]])}}}};var l=function(q){var p=c.cookie(h+q);if(p){var s=p.split("");for(var r=0;r<s.length;r++){s[r]&=1}return s}return false};return this.each(function(){this.id=this.id||"jQcM0O"+e++;var q,r=[],s=[];j(this);if(m.colsHidden.length){for(q=0;q<m.colsHidden.length;q++){s[m.colsHidden[q]-1]=true;r[m.colsHidden[q]-1]=true}}if(m.saveState){var p=l(this.id);if(p&&p.length){for(q=0;q<p.length;q++){s[q]=true;r[q]=!p[q]}}this.cMSaveState=true}this.cMColsVisible=s;if(r.length){var t=[];for(q=0;q<r.length;q++){if(r[q]){t[t.length]=q+1}}if(t.length){c(this).toggleColumns(t)}}o(this)})};c.fn.toggleColumns=function(l,k){return this.each(function(){var v,u,s,m=this.rows,t=this.cMColsVisible;if(!l){return}if(l.constructor==Number){l=[l]}if(!t){t=this.cMColsVisible=[]}for(v=0;v<m.length;v++){var n=m[v].cells;for(var w=0;w<l.length;w++){var y=l[w]-1;if(y>=0){var q=f(this,n,y);if(!q){var x=y;while(x>0&&!(q=f(this,n,--x))){}if(!q){continue}}if(t[y]==undefined){t[y]=true}if(t[y]){u=k&&k.hide?k.hide:b;s=-1}else{u=k&&k.show?k.show:a;s=1}if(!q.chSpan){q.chSpan=0}if(q.colSpan>1||(s==1&&q.chSpan&&i(q))){if(q.realIndex+q.colSpan+q.chSpan-1<y){continue}q.colSpan+=s;q.chSpan+=s*-1}else{if(q.realIndex+q.chSpan<y){continue}else{u(q)}}}}}for(v=0;v<l.length;v++){this.cMColsVisible[l[v]-1]=!t[l[v]-1];if(k&&k.listTargetID&&(k.onClass||k.offClass)){var o=k.onClass,p=k.offClass,r;if(t[l[v]-1]){o=p;p=k.onClass}r=c("#"+k.listTargetID+" li").filter(function(){return this.cmData&&this.cmData.col==l[v]-1});if(o){r.removeClass(o)}if(p){r.addClass(p)}}}g(this)})};c.fn.showColumns=function(l,k){return this.each(function(){var n,m=[],o=this.cMColsVisible;if(o){if(l&&l.constructor==Number){l=[l]}for(n=0;n<o.length;n++){if(!o[n]&&(!l||c.inArray(n+1,l)>-1)){m.push(n+1)}}c(this).toggleColumns(m,k)}})};c.fn.hideColumns=function(l,k){return this.each(function(){var n,m=l,o=this.cMColsVisible;if(o){if(l.constructor==Number){l=[l]}m=[];for(n=0;n<l.length;n++){if(o[l[n]-1]||o[l[n]-1]==undefined){m.push(l[n])}}}c(this).toggleColumns(m,k)})}})(jQuery);!function(b){if(typeof ko!=="undefined"&&ko.bindingHandlers&&!ko.bindingHandlers.multiselect){ko.bindingHandlers.multiselect={init:function(e,f,g,d,c){},update:function(h,i,j,g,c){var f=ko.utils.unwrapObservable(i());var d=j().options();var e=b(h).data("multiselect");if(!e){b(h).multiselect(f)}else{e.updateOriginalOptions();if(d&&d.length!==e.originalOptions.length){b(h).multiselect("rebuild")}}}}}function a(c,d){this.options=this.mergeOptions(d);this.$select=b(c);this.originalOptions=this.$select.clone()[0].options;this.query="";this.searchTimeout=null;this.options.multiple=this.$select.attr("multiple")==="multiple";this.options.onChange=b.proxy(this.options.onChange,this);this.options.onDropdownShow=b.proxy(this.options.onDropdownShow,this);this.options.onDropdownHide=b.proxy(this.options.onDropdownHide,this);this.buildContainer();this.buildButton();this.buildSelectAll();this.buildDropdown();this.buildDropdownOptions();this.buildFilter();this.updateButtonText();this.$select.hide().after(this.$container)}a.prototype={defaults:{buttonText:function(d,c){if(d.length===0){return this.nonSelectedText+' <b class="caret"></b>'}else{if(d.length>this.numberDisplayed){return d.length+" "+this.nSelectedText+' <b class="caret"></b>'}else{var e="";d.each(function(){var f=(b(this).attr("label")!==undefined)?b(this).attr("label"):b(this).html();e+=f+", "});return e.substr(0,e.length-2)+' <b class="caret"></b>'}}},buttonTitle:function(d,c){if(d.length===0){return this.nonSelectedText}else{var e="";d.each(function(){e+=b(this).text()+", "});return e.substr(0,e.length-2)}},label:function(c){return b(c).attr("label")||b(c).html()},onChange:function(c,d){},onDropdownShow:function(c){},onDropdownHide:function(c){},buttonClass:"btn btn-default",dropRight:false,selectedClass:"active",buttonWidth:"auto",buttonContainer:'<div class="btn-group" />',maxHeight:false,includeSelectAllOption:false,selectAllText:" Select all",selectAllValue:"multiselect-all",enableFiltering:false,enableCaseInsensitiveFiltering:false,filterPlaceholder:"Search",filterBehavior:"text",preventInputChangeEvent:false,nonSelectedText:"None selected",nSelectedText:"selected",numberDisplayed:3},templates:{button:'<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"></button>',ul:'<ul class="multiselect-container dropdown-menu"></ul>',filter:'<div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span><input class="form-control multiselect-search" type="text"></div>',li:'<li><a href="javascript:void(0);"><label></label></a></li>',liGroup:'<li><label class="multiselect-group"></label></li>'},constructor:a,buildContainer:function(){this.$container=b(this.options.buttonContainer);this.$container.on("show.bs.dropdown",this.options.onDropdownShow);this.$container.on("hide.bs.dropdown",this.options.onDropdownHide)},buildButton:function(){this.$button=b(this.templates.button).addClass(this.options.buttonClass);if(this.$select.prop("disabled")){this.disable()}else{this.enable()}if(this.options.buttonWidth){this.$button.css({width:this.options.buttonWidth})}var c=this.$select.attr("tabindex");if(c){this.$button.attr("tabindex",c)}this.$container.prepend(this.$button)},buildDropdown:function(){this.$ul=b(this.templates.ul);if(this.options.dropRight){this.$ul.addClass("pull-right")}if(this.options.maxHeight){this.$ul.css({"max-height":this.options.maxHeight+"px","overflow-y":"auto","overflow-x":"hidden"})}this.$container.append(this.$ul)},buildDropdownOptions:function(){this.$select.children().each(b.proxy(function(d,e){var c=b(e).prop("tagName").toLowerCase();if(c==="optgroup"){this.createOptgroup(e)}else{if(c==="option"){this.createOptionValue(e)}}},this));b("li input",this.$ul).on("change",b.proxy(function(d){var j=b(d.target).prop("checked")||false;var k=b(d.target).val()===this.options.selectAllValue;if(this.options.selectedClass){if(j){b(d.target).parents("li").addClass(this.options.selectedClass)}else{b(d.target).parents("li").removeClass(this.options.selectedClass)}}var h=b(d.target).val();var c=this.getOptionByValue(h);var g=b("option",this.$select).not(c);var f=b("input",this.$container).not(b(d.target));if(k){if(this.$select[0][0].value===this.options.selectAllValue){var l=[];var m=b('option[value!="'+this.options.selectAllValue+'"]',this.$select);for(var e=0;e<m.length;e++){if(m[e].value!==this.options.selectAllValue&&this.getInputByValue(m[e].value).is(":visible")){l.push(m[e].value)}}if(j){this.select(l)}else{this.deselect(l)}}}if(j){c.prop("selected",true);if(this.options.multiple){c.prop("selected",true)}else{if(this.options.selectedClass){b(f).parents("li").removeClass(this.options.selectedClass)}b(f).prop("checked",false);g.prop("selected",false);this.$button.click()}if(this.options.selectedClass==="active"){g.parents("a").css("outline","")}}else{c.prop("selected",false)}this.$select.change();this.options.onChange(c,j);this.updateButtonText();if(this.options.preventInputChangeEvent){return false}},this));b("li a",this.$ul).on("touchstart click",function(g){g.stopPropagation();if(g.shiftKey){var f=b(g.target).prop("checked")||false;if(f){var e=b(g.target).parents("li:last").siblings('li[class="active"]:first');var d=b(g.target).parents("li").index();var c=e.index();if(d>c){b(g.target).parents("li:last").prevUntil(e).each(function(){b(this).find("input:first").prop("checked",true).trigger("change")})}else{b(g.target).parents("li:last").nextUntil(e).each(function(){b(this).find("input:first").prop("checked",true).trigger("change")})}}}b(g.target).blur()});this.$container.on("keydown",b.proxy(function(f){if(b('input[type="text"]',this.$container).is(":focus")){return}if((f.keyCode===9||f.keyCode===27)&&this.$container.hasClass("open")){this.$button.click()}else{var g=b(this.$container).find("li:not(.divider):visible a");if(!g.length){return}var c=g.index(g.filter(":focus"));if(f.keyCode===38&&c>0){c--}else{if(f.keyCode===40&&c<g.length-1){c++}else{if(!~c){c=0}}}var e=g.eq(c);e.focus();if(f.keyCode===32||f.keyCode===13){var d=e.find("input");d.prop("checked",!d.prop("checked"));d.change()}f.stopPropagation();f.preventDefault()}},this))},createOptionValue:function(d){if(b(d).is(":selected")){b(d).prop("selected",true)}var c=this.options.label(d);var h=b(d).val();var g=this.options.multiple?"checkbox":"radio";var i=b(this.templates.li);b("label",i).addClass(g);b("label",i).append('<input type="'+g+'" />');var f=b(d).prop("selected")||false;var e=b("input",i);e.val(h);if(h===this.options.selectAllValue){e.parent().parent().addClass("multiselect-all")}b("label",i).append(" "+c);this.$ul.append(i);if(b(d).is(":disabled")){e.attr("disabled","disabled").prop("disabled",true).parents("li").addClass("disabled")}e.prop("checked",f);if(f&&this.options.selectedClass){e.parents("li").addClass(this.options.selectedClass)}},createOptgroup:function(c){var e=b(c).prop("label");var d=b(this.templates.liGroup);b("label",d).text(e);this.$ul.append(d);b("option",c).each(b.proxy(function(f,g){this.createOptionValue(g)},this))},buildSelectAll:function(){var c=this.$select[0][0]?this.$select[0][0].value===this.options.selectAllValue:false;if(this.options.includeSelectAllOption&&this.options.multiple&&!c){this.$select.prepend('<option value="'+this.options.selectAllValue+'">'+this.options.selectAllText+"</option>")}},buildFilter:function(){if(this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering){var c=Math.max(this.options.enableFiltering,this.options.enableCaseInsensitiveFiltering);if(this.$select.find("option").length>=c){this.$filter=b(this.templates.filter);b("input",this.$filter).attr("placeholder",this.options.filterPlaceholder);this.$ul.prepend(this.$filter);this.$filter.val(this.query).on("click",function(d){d.stopPropagation()}).on("keydown",b.proxy(function(d){clearTimeout(this.searchTimeout);this.searchTimeout=this.asyncFunction(b.proxy(function(){if(this.query!==d.target.value){this.query=d.target.value;b.each(b("li",this.$ul),b.proxy(function(f,g){var i=b("input",g).val();var j=b("label",g).text();if(i!==this.options.selectAllValue&&j){var h=false;var e="";if((this.options.filterBehavior==="text"||this.options.filterBehavior==="both")){e=j}if((this.options.filterBehavior==="value"||this.options.filterBehavior==="both")){e=i}if(this.options.enableCaseInsensitiveFiltering&&e.toLowerCase().indexOf(this.query.toLowerCase())>-1){h=true}else{if(e.indexOf(this.query)>-1){h=true}}if(h){b(g).show()}else{b(g).hide()}}},this))}},this),300,this)},this))}}},destroy:function(){this.$container.remove();this.$select.show()},refresh:function(){b("option",this.$select).each(b.proxy(function(c,d){var e=b("li input",this.$ul).filter(function(){return b(this).val()===b(d).val()});if(b(d).is(":selected")){e.prop("checked",true);if(this.options.selectedClass){e.parents("li").addClass(this.options.selectedClass)}}else{e.prop("checked",false);if(this.options.selectedClass){e.parents("li").removeClass(this.options.selectedClass)}}if(b(d).is(":disabled")){e.attr("disabled","disabled").prop("disabled",true).parents("li").addClass("disabled")}else{e.prop("disabled",false).parents("li").removeClass("disabled")}},this));this.updateButtonText()},select:function(g){if(g&&!b.isArray(g)){g=[g]}for(var c=0;c<g.length;c++){var e=g[c];var f=this.getOptionByValue(e);var d=this.getInputByValue(e);if(this.options.selectedClass){d.parents("li").addClass(this.options.selectedClass)}d.prop("checked",true);f.prop("selected",true);this.options.onChange(f,true)}this.updateButtonText()},deselect:function(c){if(c&&!b.isArray(c)){c=[c]}for(var d=0;d<c.length;d++){var f=c[d];var g=this.getOptionByValue(f);var e=this.getInputByValue(f);if(this.options.selectedClass){e.parents("li").removeClass(this.options.selectedClass)}e.prop("checked",false);g.prop("selected",false);this.options.onChange(g,false)}this.updateButtonText()},rebuild:function(){this.$ul.html("");b('option[value="'+this.options.selectAllValue+'"]',this.$select).remove();this.options.multiple=this.$select.attr("multiple")==="multiple";this.buildSelectAll();this.buildDropdownOptions();this.updateButtonText();this.buildFilter()},dataprovider:function(c){var d="";c.forEach(function(e){d+='<option value="'+e.value+'">'+e.label+"</option>"});this.$select.html(d);this.rebuild()},enable:function(){this.$select.prop("disabled",false);this.$button.prop("disabled",false).removeClass("disabled")},disable:function(){this.$select.prop("disabled",true);this.$button.prop("disabled",true).addClass("disabled")},setOptions:function(c){this.options=this.mergeOptions(c)},mergeOptions:function(c){return b.extend({},this.defaults,c)},updateButtonText:function(){var c=this.getSelected();b("button",this.$container).html(this.options.buttonText(c,this.$select));b("button",this.$container).attr("title",this.options.buttonTitle(c,this.$select))},getSelected:function(){return b('option[value!="'+this.options.selectAllValue+'"]:selected',this.$select).filter(function(){return b(this).prop("selected")})},getOptionByValue:function(c){return b("option",this.$select).filter(function(){return b(this).val()===c})},getInputByValue:function(c){return b("li input",this.$ul).filter(function(){return b(this).val()===c})},updateOriginalOptions:function(){this.originalOptions=this.$select.clone()[0].options},asyncFunction:function(f,e,c){var d=Array.prototype.slice.call(arguments,3);return setTimeout(function(){f.apply(c||window,d)},e)}};b.fn.multiselect=function(c,d){return this.each(function(){var f=b(this).data("multiselect");var e=typeof c==="object"&&c;if(!f){b(this).data("multiselect",(f=new a(this,e)))}if(typeof c==="string"){f[c](d)}})};b.fn.multiselect.Constructor=a;b(function(){b("select[data-role=multiselect]").multiselect()})}(window.jQuery);$(function(){$.fn.init_rapid_data_entry_form=function(b,a){$(this).each(function(){var v=$(this);var X=$("table#rdeTable",v);if(v.hasClass("initialised")){return}var C="rde."+v.data("cookie-prefix")+".visible";var w="rde."+v.data("cookie-prefix")+".sticky";var Q="rde."+v.data("cookie-prefix")+".widths";var f="rde."+v.data("cookie-prefix")+".order";var x=AS.prefixed_cookie(C)?JSON.parse(AS.prefixed_cookie(C)):null;var s=AS.prefixed_cookie(w)?JSON.parse(AS.prefixed_cookie(w)):null;var r=AS.prefixed_cookie(Q)?JSON.parse(AS.prefixed_cookie(Q)):null;var M=AS.prefixed_cookie(f)?JSON.parse(AS.prefixed_cookie(f)):null;var I={};var c={};$(".sections th",X).each(function(){c[$(this).data("id")]=$(this).text()});var J=false;b.off("click").on("click",".remove-row",function(aa){aa.preventDefault();aa.stopPropagation();var Z=$(aa.target).closest("button");if(Z.hasClass("btn-danger")){Z.closest("tr").remove()}else{Z.addClass("btn-danger");$("span",Z).addClass("icon-white");setTimeout(function(){Z.removeClass("btn-danger");$("span",Z).removeClass("icon-white")},10000)}});b.on("click","#rde_reset",function(Z){Z.preventDefault();Z.stopPropagation();$(":input, .btn",v).attr("disabled","disabled");AS.prefixed_cookie(C,null);AS.prefixed_cookie(Q,null);AS.prefixed_cookie(w,null);AS.prefixed_cookie(f,null);x=null;s=null;r=null;M=null;$(document).triggerHandler("rdeload.aspace",[a,b])});b.on("click",".add-row",function(aa){aa.preventDefault();aa.stopPropagation();var Z=P(aa);$(":input:visible:first",Z).focus();j(Z)});var h=function(){Y=Math.max($("tbody tr",X).length-1,0);$("tbody tr",X).each(function(Z,aa){$(aa).data("index",Z)})};var Y=0;h();var P=function(ab){var aa=$(ab.target).closest("tr");if(aa.length===0){aa=$("table tbody tr:last",v)}Y=Y+1;var Z=$(AS.renderTemplate("template_rde_"+v.data("child-type")+"_row",{path:v.data("jsonmodel-type")+"[children]["+Y+"]",id_path:v.data("jsonmodel-type")+"_children__"+Y+"_",index:Y}));Z.data("index",Y);$(".fieldset-labels th",v).each(function(ad,af){var ae=$(af);if(aa.length>0){if(ae.hasClass("fieldset-label")&&ae.hasClass("sticky")){var ag=$(":input:first",$("td",aa).get(ad));var ac=$(":input:first",$("td",Z).get(ad));if(ag.is(":checkbox")){if(ag.is(":checked")){ac.attr("checked","checked")}else{ac.removeAttr("checked")}}else{ac.val(ag.val())}}else{if(I[ae.attr("id")]){var ac=$(":input:first",$("td",Z).get(ad));ac.val(I[ae.attr("id")])}}}if(ae.hasClass("fieldset-label")&&!i(ae.attr("id"))){$($("td",Z).get(ad)).hide()}if(M!=null){$.each(M,function(ai,aj){var ak=$("td[data-col='"+aj+"']",Z);var ah=ak.index();if(ai!==ah){ak.insertBefore($("td",Z).get(ai))}})}});aa.after(Z);H(Y);return Z};b.off("keydown").on("keydown",function(Z){if(Z.keyCode===27){Z.preventDefault();Z.stopImmediatePropagation()}});b.on("keydown",":input, input[type='text']",function(aa){var Z=$(aa.target).closest("tr");var ab=$(aa.target).closest("td");if(aa.keyCode===13){aa.preventDefault();if(aa.shiftKey){$(".add-row",Z).trigger("click");$(":input:visible:first",$("td",Z.next())[ab.index()]).focus()}}else{if(aa.keyCode===27){aa.preventDefault();aa.stopImmediatePropagation();return true}else{if(aa.keyCode===37){if(aa.shiftKey){aa.preventDefault();$(":input:visible:first",p(ab)).focus()}}else{if(aa.keyCode===40){if(aa.shiftKey){aa.preventDefault();if(Z.index()<Z.siblings().length){$(":input:visible:first",$("td",Z.next())[ab.index()]).focus()}}}else{if(aa.keyCode===38){if(aa.shiftKey){aa.preventDefault();if(Z.index()>0){$(":input:visible:first",$("td",Z.prev())[ab.index()]).focus()}}}else{if(aa.keyCode===39){if(aa.shiftKey){aa.preventDefault();$(":input:visible:first",e(ab)).focus()}}else{}}}}}}});b.on("click","th.fieldset-label",function(Z){$(this).toggleClass("sticky");var aa=[];$("table th.sticky",v).each(function(){aa.push($(this).attr("id"))});s=aa;AS.prefixed_cookie(w,JSON.stringify(s))});b.on("click","[data-dismiss]",function(Z){b.modal("hide")});var z=function(aa,Z){aa.each(function(ad,af){var ac=$(af);var ag=Z[ad];var ab=$(".error-summary",ac);var ae=$(".error-summary-list",ab);ae.empty();if(ag.hasOwnProperty("errors")&&!$.isEmptyObject(ag.errors)){ac.removeClass("valid").addClass("invalid");$.each(ag.errors,function(ak,aj){var al=$("[id='"+v.data("jsonmodel-type")+"_children__"+ac.data("index")+"__"+ak.replace(/\//g,"__")+"_']",ac);var ai=$($(".fieldset-labels th",X).get(al.first().closest("td").index()));al.closest(".form-group").addClass("has-error");var ah=$("<div class='error'>");if(al.length>1||al.hasClass("defer-to-section")){ah.text(c[ai.data("section")])}else{ah.text($($(".fieldset-labels th",X).get(al.closest("td").index())).text())}ah.append(" - ").append(aj);ah.append("<span class='glyphicon glyphicon-chevron-right'>");ae.append(ah);ah.data("target",al.first().attr("id"))});$(".modal-body",b).trigger("scroll")}else{ac.removeClass("invalid").addClass("valid")}})};var T=function(){v.ajaxForm({target:$(".rde-wrapper",b),success:function(){$(window).trigger("resize");v=$("form","#rapidDataEntryModal");X=$("table",v);h();if(v.length){z($("tbody tr",v),v.data("exceptions"));T()}else{setTimeout(function(){location.reload(true)},1000)}}});X.kiketable_colsizable({dragCells:"tr.fieldset-labels th.fieldset-label",dragMove:true});$("th.fieldset-label .kiketable-colsizable-handler",X).on("dragend",U);X.columnManager();$("table thead .fieldset-labels th").each(function(aa,Z){if(!$(Z).attr("id")){$(Z).attr("id","rdecol"+aa)}$($("table colgroup col").get(aa)).data("id",$(Z).attr("id"))});d();t();F();A();L();g();V();y();H()};var y=function(){if($("button.toggle-inline-errors").hasClass("active")){X.addClass("show-inline-errors")}else{X.removeClass("show-inline-errors")}};var H=function(aa){var aa=aa||0;var Z=$("td[data-col='colLevel']:eq("+aa+") select");if(Z.val()==="otherlevel"){l("colOtherLevel",aa)}else{R("colOtherLevel",aa)}Z.change(function(){if($(this).val()==="otherlevel"){l("colOtherLevel",aa)}else{R("colOtherLevel",aa)}})};var d=function(){X.on("change",":input:visible",function(){var Z=$(this).closest("tr");j(Z)});$(".modal-body",b).on("scroll",function(Z){$(".error-summary",X).css("left",$(this)[0].scrollLeft+5)});X.on("focusin click",":input",function(){$(this).closest("tr").addClass("last-focused").siblings().removeClass("last-focused")});X.on("click",".error-summary .error",function(){var Z=$("#"+$(this).data("target"));if(!Z.is("visible")){var aa=M[Z.closest("td").index()];$("#rde_hidden_columns").multiselect("select",aa)}Z.closest("td").ScrollTo({axis:"x",callback:function(){Z.focus()}})});X.on("click","td.status",function(Z){Z.preventDefault();Z.stopPropagation();if($(Z.target).closest(".error-summary").length>0){return}if($(this).closest("tr").hasClass("last-focused")){$("button.toggle-inline-errors").trigger("click")}else{$(this).closest("tr").addClass("last-focused").siblings().removeClass("last-focused")}});X.on("click",".hide-error-summary, .show-error-summary",function(Z){Z.preventDefault();Z.stopPropagation();$("button.toggle-inline-errors").trigger("click")})};var V=function(){var ab=$(".fill-column-form",b);var Z=$("button.fill-column",b);var aa=$("table tbody tr:first",v);Z.click(function(ae){ae.preventDefault();ae.stopPropagation();if(!$(this).hasClass("active")){$(".active",$(this).closest(".btn-group")).trigger("click")}Z.toggleClass("active");ab.slideToggle()});var ad=function(){var ag=$("#fill_basic",ab);var ae=$("#basicFillTargetColumn",ag);var af=$("button",ag);K(ae);ae.change(function(){$(".empty",this).remove();var ah=parseInt($("#"+$(this).val()).index());var ai=$(":input:first",$("td",aa).get(ah)).clone();ai.attr("name","").attr("id","basicFillValue");$(".fill-value-container",ag).html(ai);af.removeAttr("disabled").removeClass("disabled")});af.click(function(aj){aj.preventDefault();aj.stopPropagation();var ah=parseInt($("#"+ae.val()).index())+1;var ak=$("table tbody tr td:nth-child("+ah+")",v);if($("#basicFillValue",ag).is(":checkbox")){var ai=$("#basicFillValue",ag).is(":checked");if(ai){$(":input:first",ak).attr("checked","checked")}else{$(":input:first",ak).removeAttr("checked")}}else{var ai=$("#basicFillValue",ag).val();$(":input:first",ak).val(ai)}Z.toggleClass("active");ab.slideToggle();D()})};var ac=function(){var ag=$("#fill_sequence",ab);var ae=$("#sequenceFillTargetColumn",ag);var af=$("button.btn-primary",ag);var ai=$(".sequence-preview",ag);K(ae,null,function(aj){var ak=$("td",aa).get(aj.index());return $(":input:first",ak).is(":text")});ae.change(function(){$(".empty",this).remove();af.removeAttr("disabled").removeClass("disabled")});$("button.preview-sequence",ag).click(function(aj){aj.preventDefault();aj.stopPropagation();$.getJSON(ag.data("sequence-generator-url"),{prefix:$("#sequenceFillPrefix",ag).val(),from:$("#sequenceFillFrom",ag).val(),to:$("#sequenceFillTo",ag).val(),suffix:$("#sequenceFillSuffix",ag).val(),limit:$("tbody tr",X).length},function(ak){ai.html("");if(ak.errors){$.each(ak.errors,function(an,am){var al=$("<div>").html(am).addClass("text-error");ai.append(al)})}else{ai.html($("<p class='values'>").html(ak.values.join(", ")));ai.prepend($("<p class='summary'>").html(ak.summary))}})});var ah=function(aj){$("#sequenceTooSmallMsg",ag).hide();$.getJSON(ag.data("sequence-generator-url"),{prefix:$("#sequenceFillPrefix",ag).val(),from:$("#sequenceFillFrom",ag).val(),to:$("#sequenceFillTo",ag).val(),suffix:$("#sequenceFillSuffix",ag).val(),limit:$("tbody tr",X).length},function(al){ai.html("");if(al.errors){$.each(al.errors,function(ap,ao){var an=$("<div>").html(ao).addClass("text-error");ai.append(an)});return}if(!aj&&al.values.length<$("tbody tr",b).length){$("#sequenceTooSmallMsg",ag).show();return}var ak=$("#"+ae.val()).index();var am=$("table tbody tr td:nth-child("+(ak+1)+")",v);$.each(al.values,function(an,ao){if(an>am.length){return}$(":input:first",am[an]).val(ao)});Z.toggleClass("active");ab.slideToggle();D()})};af.click(function(aj){aj.preventDefault();aj.stopPropagation();ah(false)});$(".btn-continue-sequence-fill",ag).click(function(aj){aj.preventDefault();aj.stopPropagation();ah(true)})};ad();ac()};var n=function(){var Z=[];$("table .fieldset-labels th",v).each(function(){Z.push($(this).attr("id"))});M=Z;AS.prefixed_cookie(f,JSON.stringify(M))};var t=function(){if(M===null){n()}else{var aa=$("tr.fieldset-labels",X);var ab=$("tr.sections",X);var Z=$("colgroup",X);ab.html("");$.each(M,function(ad,ag){var af=$("#"+ag,aa);var ac=af.index();var ae=$($("col",Z).get(ac));if(!i(ag)&&ad>0){E(ac)}if(ad!==ac){af.insertBefore($("th",aa).get(ad));ae.insertBefore($("col",Z).get(ad));$("tbody tr",X).each(function(ai,aj){$($("td",aj).get(ac)).insertBefore($("td",aj).get(ad))})}if(ad===0){ab.append($("<th>").data("id","empty").attr("colspan","1"))}else{if($("th",ab).last().data("id")===af.data("section")){var ah=$("th",ab).last();ah.attr("colspan",parseInt(ah.attr("colspan"))+1)}else{ab.append($("<th>").data("id",af.data("section")).addClass("section-"+af.data("section")).attr("colspan","1").text(c[af.data("section")]))}}});W()}};var k=null;var A=function(){q();B(function(){o();m()})};var B=function(Z){var aa=v.data("child-type");$.ajax({url:v.data("list-templates-uri"),type:"GET",dataType:"json",success:function(ab){k=_.filter(ab,function(ac){return ac.record_type===aa});Z()},error:function(ad,ab,ac){console.log(ac)}})};var q=function(){var Z=$("#saveTemplateForm",b);var aa=$("button.save-template",b);var ac=$("#templateName",Z);var ab=$(".btn-primary",Z);aa.off("click").on("click",function(ad){ad.preventDefault();ad.stopPropagation();if(!$(this).hasClass("active")){$(".active",$(this).closest(".btn-group")).trigger("click")}aa.toggleClass("active");Z.slideToggle()});ac.on("change keyup paste",function(){if($(this).val().length>0){ab.removeAttr("disabled").removeClass("disabled")}else{ab.prop("disabled",true)}});ab.click(function(ae){ae.preventDefault();ae.stopPropagation();var ad={record_type:v.data("child-type"),name:ac.val(),order:[],visible:[],defaults:{},};var af=$("table tbody tr:first",v);$("table .fieldset-labels th",v).each(function(){var ag=$(this).attr("id");ad.order.push(ag);if($(this).is(":visible")){ad.visible.push(ag)}var ah=$("td[data-col='"+ag+"']",af);if($("input",ah).length){ad.defaults[ag]=$("input",ah).val()}else{if($("select",ah).length){ad.defaults[ag]=$("select",ah).val()}}});ad.defaults=_.pick(ad.defaults,function(ag){return ag.length>0});$.ajax({url:v.data("save-template-uri"),type:"POST",data:{template:ad},dataType:"json",success:function(ag){B(function(){o();m()});aa.toggleClass("active");Z.slideToggle()},error:function(ai,ag,ah){console.log(ah)}})})};var o=function(){var ad=$("#manageTemplatesForm",b);var ab=$("button.manage-templates",b);var Z=$("table tbody",ad);var ac=[];ab.off("click").on("click",function(ae){ae.preventDefault();ae.stopPropagation();ac=[];if(!$(this).hasClass("active")){$(".active",$(this).closest(".btn-group")).trigger("click")}Z.empty();aa();ab.toggleClass("active");ad.slideToggle()});$("button.btn-cancel",ad).off("click").on("click",function(ae){ae.preventDefault();ae.stopPropagation();ab.toggleClass("active");ad.slideToggle(function(){ac=[]})});$("button.btn-primary",ad).off("click").on("click",function(ae){ae.preventDefault();ae.stopPropagation();$.ajax({url:v.data("list-templates-uri")+"/batch_delete",type:"POST",dataType:"json",data:{ids:ac},success:function(af){k=af;m()},error:function(ah,af,ag){console.log(ag)}});ab.toggleClass("active");ad.slideToggle()});var aa=function(){_.each(k,function(ae){Z.append(AS.renderTemplate("rde_template_table_row",{item:ae}))});$("button",Z).click(function(ae){ae.preventDefault();ae.stopPropagation();var af=$(this).closest("tr").data("templateId");if(_.indexOf(ac,af)>-1){_.remove(ac,af);$(this).text("Remove")}else{ac.push(af);$(this).text("Keep")}})};$.ajax({url:v.data("list-templates-uri"),type:"GET",dataType:"json",success:function(ae){k=ae}})};var S=function(Z){M=Z.order;x=Z.visible;I=Z.defaults;t();var aa=$("tbody tr:first",v);_.each($("td",aa),function(ae){var ad=$(ae);var ac=ad.data("col");var ab=$(":input:first",ad);if(I[ac]&&(ab.data("value-from-template")||ab.val().length<1)){ab.val(I[ac]);ab.data("value-from-template",true)}})};var m=function(){var aa=$("#rde_select_template");aa.change(function(){var ab=$("option:selected",aa).val();$.ajax({url:v.data("template-base-uri")+"/"+ab,type:"GET",dataType:"json",success:function(ac){S(ac);aa.attr("data-style","btn-success");aa.selectpicker("refresh")}})});var Z=function(){aa.empty();aa.append($("<option>",{disabled:"disabled",selected:"selected"}).text(aa.data("prompt-text")));_.each(k,function(ab){aa.append($("<option>",{value:ab.id}).text(ab.name))});aa.selectpicker("refresh")};Z()};var F=function(){var ac=$("#columnReorderForm",b);var Z=$("button.reorder-columns",b);var aa=$("#columnOrder",ac);var ad=$(".btn-primary",ac);Z.off("click").on("click",function(af){af.preventDefault();af.stopPropagation();if(!$(this).hasClass("active")){$(".active",$(this).closest(".btn-group")).trigger("click")}Z.toggleClass("active");ac.slideToggle()});K(aa);aa.attr("size",$("option",aa).length/2);var ae=function(ag){var af=$("option:selected",aa);if(af.length){if(ag==="up"){af.first().prev().before(af)}else{af.last().next().after(af)}}ad.removeAttr("disabled").removeClass("disabled")};var ab=function(){Z.toggleClass("active");ac.slideToggle(function(){ad.addClass("disabled").attr("disabled","disabled");aa.html("");K(aa)})};$("#columnOrderUp",ac).bind("click",function(){ae("up")});$("#columnOrderDown",ac).bind("click",function(){ae("down")});$(".btn-cancel",ac).click(function(af){af.preventDefault();af.stopPropagation();ab()});ad.click(function(af){af.preventDefault();af.stopPropagation();M=["colStatus"];$("option",aa).each(function(){M.push($(this).val())});M.push("colActions");t();ab();n()})};var K=function(aa,ab,Z){Z=Z||function(){return true};ab=ab||function(){return false};$(".fieldset-labels th",v).each(function(){var ac=$(this);if(ac.hasClass("fieldset-label")&&Z(ac)){var ae=$("<option>");var ad="";ad+=$(".section-"+ac.data("section")+":first").text();ad+=" - ";ad+=ac.text();ae.val(ac.attr("id")).text(ad);if(ab(ac)){ae.attr("selected","selected")}aa.append(ae)}})};var g=function(){var Z=$("#rde_hidden_columns");K(Z,function(aa){return i(aa.attr("id"))});Z.multiselect({buttonClass:"btn btn-small btn-default",buttonWidth:"auto",maxHeight:300,buttonContainer:'<div class="btn-group" />',buttonText:function(aa){if(aa.length==0){return Z.data("i18n-none")+' <b class="caret"></b>'}else{if(aa.length>5){return Z.data("i18n-prefix")+" "+aa.length+" "+Z.data("i18n-suffix")+' <b class="caret"></b>'}else{var ab=Z.data("i18n-prefix")+" ";aa.each(function(){ab+=$(this).text()+", "});return ab.substr(0,ab.length-2)+' <b class="caret"></b>'}}},onChange:function(af,ae){var ad=U();var ac=af.val();var aa=$("#"+ac).index();if(ae){X.showColumns(aa+1);var ab=$($("table colgroup col").get(aa));ab.show();X.width(X.width()+ad[aa])}else{N(aa)}x=Z.val();AS.prefixed_cookie(C,JSON.stringify(x))}});W()};var U=function(){var Z={};$("table colgroup col",v).each(function(ab,aa){if($(aa).prop("width")===null||$(aa).prop("width")===""){$(aa).prop("width",$(aa).data("default-width"))}else{if($(aa).css("width")){var ac=parseInt($(aa).css("width"));$(aa).prop("width",ac)}}Z[$(aa).data("id")]=parseInt($(aa).prop("width"))});r=Z;AS.prefixed_cookie(Q,JSON.stringify(r));return r};var G=function(ab){var aa=O(ab);var Z=$("#"+ab).index();$($("table colgroup col",v).get(Z)).width(aa);return aa};var O=function(Z){if(r){return r[Z]}else{U();return O(Z)}};var u=function(){var Z=0;X.css("tableLayout","auto");$("colgroup col",X).each(function(ab,ac){var aa=O($(ac).data("id"));$(ac).prop("width",aa);Z+=aa});X.width(Z);X.css("tableLayout","fixed")};var L=function(){if(s){$("th.sticky",v).removeClass("sticky");$.each(s,function(){$("#"+this).addClass("sticky")})}};var i=function(Z){if(x){return $.inArray(Z,x)>=0}else{return true}};var W=function(){if(x){var Z=0;$.each($(".fieldset-labels th",v),function(){var ab=$(this).attr("id");var aa=$(this).index();if($(this).hasClass("fieldset-label")){if(i(ab)){Z+=G(ab)}else{N(aa)}}else{Z+=G(ab)}});X.width(Z)}else{u()}};var N=function(Z){X.hideColumns(Z+1);var aa=$($("table colgroup col").get(Z));X.width(X.width()-aa.width());aa.hide()};var E=function(Z){X.showColumns(Z+1);var aa=$($("table colgroup col").get(Z));X.width(X.width()+aa.width());aa.show()};var l=function(aa,ac){var ab=$("tbody tr")[ac];var Z=$("td[data-col='"+aa+"']",ab);Z.removeClass("disabled");$("input",Z).removeAttr("disabled")};var R=function(aa,ac){var ab=$("tbody tr")[ac];var Z=$("td[data-col='"+aa+"']",ab);Z.addClass("disabled");$("input",Z).attr("disabled","disabled")};var p=function(aa){var Z=aa.prev();if(Z.hasClass("disabled")){return p(Z)}else{return Z}};var e=function(aa){var Z=aa.next();if(Z.hasClass("disabled")){return e(Z)}else{return Z}};var D=function(){j($("tbody tr",X))};var j=function(Z){var aa=Z.serializeObject();aa.validate_only="true";$(".error",Z).removeClass("error");$.ajax({url:v.data("validate-row-uri"),type:"POST",data:aa,dataType:"json",success:function(ab){z(Z,ab)}})};$(b).on("click",".modal-footer .btn-primary",function(){$(this).attr("disabled","disabled");v.submit()});$(b).on("click","#validateButton",function(Z){Z.preventDefault();Z.stopPropagation();J=true;$(this).attr("disabled","disabled");v.append("<input type='hidden' name='validate_only' value='true'>");v.submit()});$(".add-rows-form input",b).click(function(Z){Z.preventDefault();Z.stopPropagation()});$(".add-rows-form button",b).click(function(ab){var ac=[];try{var aa=parseInt($("input",$(this).closest(".add-rows-form")).val(),10);for(var Z=1;Z<=aa;Z++){ac.push(P(ab))}}catch(ad){}j($(ac))});b.on("click","button.toggle-inline-errors",function(Z){Z.preventDefault();Z.stopPropagation();$(this).toggleClass("active");X.toggleClass("show-inline-errors")});b.on("keyup","button",function(Z){if(Z.keyCode===13){$(this).trigger("click")}});$(document).triggerHandler("loadedrecordform.aspace",[v]);T();$(window).trigger("resize");setTimeout(function(){D()})});$("select.selectpicker",b).selectpicker()};$(document).bind("rdeload.aspace",function(c,a,b){$.ajax({url:APP_PATH+a.attr("rel")+"s/"+a.data("id")+"/rde",success:function(d){$(".rde-wrapper",b).replaceWith("<div class='modal-body'></div>");$(".modal-body",b).replaceWith(d);$("form","#rapidDataEntryModal").init_rapid_data_entry_form(b,a)}})});$(document).bind("rdeshow.aspace",function(c,a,d){var b=AS.openCustomModal("rapidDataEntryModal",d.text(),AS.renderTemplate("modal_content_loading_template"),"full",{keyboard:false},d);$(document).triggerHandler("rdeload.aspace",[a,b])})});