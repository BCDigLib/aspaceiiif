$(function(){var d=10000;var b="stale";var c="opened_for_editing";var e="repository_changed";var a=function(h){if(h.data("update-monitor")==="enabled"){return}h.data("update-monitor","enabled");h.data("update-monitor-paused",false);var i=h.data("update-monitor-url");var j=h.data("update-monitor-lock_version");var k=h.data("update-monitor-record-uri");var g=h.data("update-monitor-record-is-stale");$(document).trigger("clearupdatemonitorintervals.aspace");var m=function(q){$(".record-pane .update-monitor-error",h).remove();if(g||q.status===b){var p=AS.renderTemplate(g?"update_monitor_save_failed_with_stale_record_template":"update_monitor_stale_record_message_template");$("#form_messages",h).prepend(p);$(".record-pane .form-actions",h).prepend(p);$(".btn-primary, .btn-toolbar .btn",h).attr("disabled","disabled").addClass("disabled");clearInterval($(document).data("UPDATE_MONITOR_POLLING_INTERVAL"))}else{if(q.status===c){var n=[];$.each(q.edited_by,function(r,s){n.push(r)});var p=AS.renderTemplate("update_monitor_other_editors_message_template",{user_ids:n.join(", ")});$("#form_messages",h).prepend(p);$(".record-pane .form-actions",h).prepend(p)}else{if(q.status===e){var p=AS.renderTemplate("update_monitor_repository_changed_message_template");$("#form_messages",h).prepend(p);$(".record-pane .form-actions",h).prepend(p)}}}if($(".as-nav-list li.alert-error").length===0){$(".as-nav-list").prepend(AS.renderTemplate("as_nav_list_errors_item_template"))}var o=$(".as-nav-list li.alert-error");if(!o.hasClass("acknowledged")&&$(document).data("UPDATE_MONITOR_HIGHLIGHT_INTERVAL")==null){$(document).data("UPDATE_MONITOR_HIGHLIGHT_INTERVAL",setInterval(function(){o.toggleClass("active")},3000));o.hover(function(){clearInterval($(document).data("UPDATE_MONITOR_HIGHLIGHT_INTERVAL"));o.removeClass("active").addClass("acknowledged")},function(){})}};var f=function(){$(".update-monitor-error",h).remove()};var l=function(){if(g){m();return}if(h.data("update-monitor-paused")==true){return}$.post(i,{lock_version:j,uri:k},function(n,p,o){if(n.status===b||n.status===c||n.status===e){m(n)}else{f()}},"json").fail(function(n,p,o){if(n.status===500||n.status===403){window.location.replace(FRONTEND_URL)}})};l();$(document).data("UPDATE_MONITOR_POLLING_INTERVAL",setInterval(l,d))};$(document).bind("setupupdatemonitor.aspace",function(g,f){a(f)});$(document).bind("clearupdatemonitorintervals.aspace",function(f){clearInterval($(document).data("UPDATE_MONITOR_HIGHLIGHT_INTERVAL"));clearInterval($(document).data("UPDATE_MONITOR_POLLING_INTERVAL"))})});AS.LoginHelper={init:function(a){$(a).each(function(){var c=$(this);var b=function(e){$(".form-group",c).removeClass("has-error");$(".alert-success",c).show();c.trigger("loginsuccess.aspace",[e])};var d=function(){$(".form-group",c).addClass("has-error");$(".alert-danger",c).show();$("#login",c).removeAttr("disabled");c.trigger("loginerror.aspace")};c.ajaxForm({dataType:"json",beforeSubmit:function(){$("#login",c).attr("disabled","disabled")},success:function(f,e,g){if(f.session){b(f)}else{d()}},error:function(g,f,e){d()}})})}};$(function(){var a=function(){$(this).each(function(){var b=$(this);var c=function(d){$.ajax({url:APP_PATH+"has_session",async:false,data_type:"json",success:function(f){if(f.has_session){return true}else{d.preventDefault();d.stopImmediatePropagation();$(":input[type='submit']",b).removeAttr("disabled");var h=$(".modal.initialised");if(h.length){h.hide()}var e=AS.openAjaxModal(APP_PATH+"login");e.removeClass("inline-login-modal");var g=$("form",e);AS.LoginHelper.init(g);g.on("loginsuccess.aspace",function(i,j){$(":input[name=authenticity_token]").val(j.csrf_token);if(h.length===0){b.unbind("submit",c);b.submit()}else{e.hide();e.remove();h.show()}e.on("hidden",function(){e.remove()});setTimeout(function(){e.modal("hide")},1000);return false});return false}},error:function(){$(":input[type='submit']",b).removeAttr("disabled");return true}})};b.on("submit",c)})};$(document).bind("loadedrecordform.aspace",function(b,c){$.proxy(a,c.find("form.aspace-record-form:not(.public-form)").andSelf().filter("form.aspace-record-form:not(.public-form)"))()});$.proxy(a,$("form.aspace-record-form:not(.public-form)"))()});$(function(){var c=function(){$(this).each(function(){$(".form-overlay",$(this)).height("100%").fadeIn();$(this).addClass("locked")})};var b=function(){$(this).each(function(){var e=$(AS.renderTemplate("form_overlay_unlock_template"));e.on("click",function(f){f.preventDefault();f.stopImmediatePropagation();$(window).trigger("hashchange")});$("#archives_form_overlay",$(this)).append(e);$(".alert",e).fadeIn()})};var d=[37,39,9];var a=function(){$(this).each(function(){var e=$(this);if(e.data("changedDetectionEnabled")){return}e.data("form_changed",e.data("form_changed")||false);e.data("changedDetectionEnabled",true);$("> .form-context > .row > .col-md-9",e).prepend('<div id="archives_form_overlay"><div class="modal-backdrop in form-overlay"></div></div>');$("> .form-context > .row > .col-md-3 .form-actions",e).prepend('<div id="archives_form_actions_overlay" class="modal-backdrop in form-overlay"></div>');var g=function(h){if($(h.target).parents("*[data-no-change-tracking='true']").length===0){e.trigger("formchanged.aspace");e.trigger("readonlytree.aspace")}};e.on("change keyup",":input",function(h){if($(this).data("original_value")&&($(this).data("original_value")!==$(this).val())){g(h)}else{if($.inArray(h.keyCode,d)===-1){g(h)}}});var f=function(i){i.preventDefault();var h=$("<input>").attr("type","hidden").attr("name","ignorewarnings").val("true");$("form.aspace-record-form").append($(h));$("form.aspace-record-form").submit();return false};e.on("click",":radio, :checkbox",g);e.on("formchanged.aspace",function(h){if(e.data("form_changed")===true){h.stopPropagation()}else{$(document).bind("keydown","ctrl+s",f);$(":input",h.target).bind("keydown","ctrl+s",f)}e.data("form_changed",true);$(".record-toolbar",e).addClass("formchanged");$(".record-toolbar .btn-toolbar .btn",e).addClass("disabled").attr("disabled","disabled")});$(".createPlusOneBtn",e).on("click",function(){e.data("createPlusOne","true")});e.bind("submit",function(h){e.data("form_changed",false);e.data("update-monitor-paused",true);e.off("change keyup formchanged.aspace");$(document).unbind("keydown",f);$(":input[type='submit'], :input.btn-primary",e).attr("disabled","disabled");if($(this).data("createPlusOne")){var i=$("<input>").attr("type","hidden").attr("name","plus_one").val("true");$(e).append(i)}return true});$(".record-toolbar .revert-changes .btn",e).click(function(){e.data("form_changed",false);return true});$(".form-actions .btn-cancel",e).click(function(){e.data("form_changed",false);return true});$(window).bind("beforeunload",function(h){if(e.data("form_changed")===true){return"Please note you have some unsaved changes."}});if(e.data("update-monitor")){$(document).trigger("setupupdatemonitor.aspace",[e])}else{if(e.closest(".modal").length===0){$(document).trigger("clearupdatemonitorintervals.aspace",[e])}}})};$(document).bind("loadedrecordform.aspace",function(e,f){$.proxy(a,$("form.aspace-record-form",f))()});$(document).bind("lockform.aspace",function(e,f){$.proxy(c,[f])()});$(document).bind("unlockform.aspace",function(e,f){$.proxy(b,[f])()});$.proxy(a,$("form.aspace-record-form"))()});(function(d){var i={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:false,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:true,theme:null,zindex:999,resultsLimit:null,enableHTML:true,resultsFormatter:function(l){var k=l[this.propertyToSearch];return"<li>"+(this.enableHTML?k:a(k))+"</li>"},tokenFormatter:function(l){var k=l[this.propertyToSearch];return"<li><p>"+(this.enableHTML?k:a(k))+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:false,tokenValue:"id",allowFreeTagging:false,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:false,formatQueryParam:function(l,k){return l},caching:true};var f={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"};var h={BEFORE:0,AFTER:1,END:2};var e={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:null};var j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};var g=/[&<>"'\/]/g;function c(k){return String((k===null||k===undefined)?"":k)}function a(k){return c(k).replace(g,function(l){return j[l]})}var b={init:function(k,l){var m=d.extend({},i,l||{});return this.each(function(){d(this).data("settings",m);d(this).data("tokenInputObject",new d.TokenList(this,k,m))})},clear:function(){this.data("tokenInputObject").clear();return this},add:function(k){this.data("tokenInputObject").add(k);return this},remove:function(k){this.data("tokenInputObject").remove(k);return this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(k){this.data("tokenInputObject").toggleDisabled(k);return this},setOptions:function(k){d(this).data("settings",d.extend({},d(this).data("settings"),k||{}));return this}};d.fn.tokenInput=function(k){if(b[k]){return b[k].apply(this,Array.prototype.slice.call(arguments,1))}else{return b.init.apply(this,arguments)}};d.TokenList=function(o,y,Z){if(d.type(y)==="string"||d.type(y)==="function"){d(o).data("settings").url=y;var s=D();if(d(o).data("settings").crossDomain===undefined&&typeof s==="string"){if(s.indexOf("://")===-1){d(o).data("settings").crossDomain=false}else{d(o).data("settings").crossDomain=(location.href.split(/\/+/g)[1]!==s.split(/\/+/g)[1])}}}else{if(typeof(y)==="object"){d(o).data("settings").local_data=y}}if(d(o).data("settings").classes){d(o).data("settings").classes=d.extend({},f,d(o).data("settings").classes)}else{if(d(o).data("settings").theme){d(o).data("settings").classes={};d.each(f,function(af,ag){d(o).data("settings").classes[af]=ag+"-"+d(o).data("settings").theme})}else{d(o).data("settings").classes=f}}var L=[];var B=0;var x=new d.TokenList.Cache();var X;var T;var F=d('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",d(o).data("settings").idPrefix+o.id).focus(function(){if(d(o).data("settings").disabled){return false}else{if(d(o).data("settings").tokenLimit===null||d(o).data("settings").tokenLimit!==B){r()}}v.addClass(d(o).data("settings").classes.focused)}).blur(function(){M();d(this).val("");v.removeClass(d(o).data("settings").classes.focused);if(d(o).data("settings").allowFreeTagging){n()}else{d(this).val("")}v.removeClass(d(o).data("settings").classes.focused)}).bind("keyup keydown blur update",l).keydown(function(ag){var ai;var af;switch(ag.keyCode){case e.LEFT:return true;case e.RIGHT:return true;case e.UP:case e.DOWN:if(!d(this).val()){ai=t.prev();af=t.next();if((ai.length&&ai.get(0)===J)||(af.length&&af.get(0)===J)){if(ag.keyCode===e.LEFT||ag.keyCode===e.UP){Q(d(J),h.BEFORE)}else{Q(d(J),h.AFTER)}}else{if((ag.keyCode===e.LEFT||ag.keyCode===e.UP)&&ai.length){aa(d(ai.get(0)))}else{if((ag.keyCode===e.RIGHT||ag.keyCode===e.DOWN)&&af.length){aa(d(af.get(0)))}}}}else{var ah=null;if(ag.keyCode===e.DOWN||ag.keyCode===e.RIGHT){ah=d(V).next()}else{ah=d(V).prev()}if(ah.length){ad(ah)}}return false;case e.BACKSPACE:ai=t.prev();if(!d(this).val().length){if(J){q(d(J));K.change()}else{if(ai.length){aa(d(ai.get(0)))}}return false}else{if(d(this).val().length===1){M()}else{setTimeout(function(){I()},5)}}break;case e.TAB:return true;case e.ENTER:if(V){S(d(V).data("tokeninput"));K.change()}else{d(o).trigger("tokeninput.enter")}ag.stopPropagation();ag.preventDefault();break;case e.NUMPAD_ENTER:case e.COMMA:if(V){S(d(V).data("tokeninput"));K.change()}else{if(d(o).data("settings").allowFreeTagging){n()}ag.stopPropagation();ag.preventDefault()}return false;case e.ESCAPE:M();return true;default:if(String.fromCharCode(ag.which)){setTimeout(function(){I()},5)}break}});var K=d(o).hide().val("").focus(function(){ae(F)}).blur(function(){F.blur()});var J=null;var N=0;var V=null;var v=d("<ul />").addClass(d(o).data("settings").classes.tokenList).click(function(ag){var af=d(ag.target).closest("li");if(af&&af.get(0)&&d.data(af.get(0),"tokeninput")){ac(af)}else{if(J){Q(d(J),h.END)}ae(F)}}).mouseover(function(ag){var af=d(ag.target).closest("li");if(af&&J!==this){af.addClass(d(o).data("settings").classes.highlightedToken)}}).mouseout(function(ag){var af=d(ag.target).closest("li");if(af&&J!==this){af.removeClass(d(o).data("settings").classes.highlightedToken)}}).insertBefore(K);var t=d("<li />").addClass(d(o).data("settings").classes.inputToken).appendTo(v).append(F);var ab=d("<div>").addClass(d(o).data("settings").classes.dropdown).appendTo("body").hide();var R=d("<tester/>").insertAfter(F).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:F.css("fontSize"),fontFamily:F.css("fontFamily"),fontWeight:F.css("fontWeight"),letterSpacing:F.css("letterSpacing"),whiteSpace:"nowrap"});K.val("");var E=d(o).data("settings").prePopulate||K.data("pre");if(d(o).data("settings").processPrePopulate&&d.isFunction(d(o).data("settings").onResult)){E=d(o).data("settings").onResult.call(K,E)}if(E&&E.length){d.each(E,function(af,ag){p(ag);O()})}if(d(o).data("settings").disabled){H(true)}if(d.isFunction(d(o).data("settings").onReady)){d(o).data("settings").onReady.call()}this.clear=function(){v.children("li").each(function(){if(d(this).children("input").length===0){q(d(this))}})};this.add=function(af){S(af)};this.remove=function(af){v.children("li").each(function(){if(d(this).children("input").length===0){var ai=d(this).data("tokeninput");var ag=true;for(var ah in af){if(af[ah]!==ai[ah]){ag=false;break}}if(ag){q(d(this))}}})};this.getTokens=function(){return L};this.toggleDisabled=function(af){H(af)};function k(af){return d(o).data("settings").enableHTML?af:a(af)}function H(af){if(typeof af==="boolean"){d(o).data("settings").disabled=af}else{d(o).data("settings").disabled=!d(o).data("settings").disabled}F.attr("disabled",d(o).data("settings").disabled);v.toggleClass(d(o).data("settings").classes.disabled,d(o).data("settings").disabled);if(J){Q(d(J),h.END)}K.attr("disabled",d(o).data("settings").disabled)}function O(){if(d(o).data("settings").tokenLimit!==null&&B>=d(o).data("settings").tokenLimit){F.hide();M();return}}function l(){if(T===(T=F.val())){return}R.html(a(T));F.width(R.width()+30)}function Y(af){return((af>=48&&af<=90)||(af>=96&&af<=111)||(af>=186&&af<=192)||(af>=219&&af<=222))}function n(){var af=d.trim(F.val());var ag=af.split(d(o).data("settings").tokenDelimiter);d.each(ag,function(aj,ai){if(!ai){return}if(d.isFunction(d(o).data("settings").onFreeTaggingAdd)){ai=d(o).data("settings").onFreeTaggingAdd.call(K,ai)}var ah={};ah[d(o).data("settings").tokenValue]=ah[d(o).data("settings").propertyToSearch]=ai;S(ah)})}function p(ag){var ai=d(d(o).data("settings").tokenFormatter(ag));var af=ag.readonly===true?true:false;if(af){ai.addClass(d(o).data("settings").classes.tokenReadOnly)}ai.addClass(d(o).data("settings").classes.token).insertBefore(t);if(!af){d("<span>"+d(o).data("settings").deleteText+"</span>").addClass(d(o).data("settings").classes.tokenDelete).appendTo(ai).click(function(){if(!d(o).data("settings").disabled){q(d(this).parent());K.change();return false}})}var ah=ag;d.data(ai.get(0),"tokeninput",ag);L=L.slice(0,N).concat([ah]).concat(L.slice(N));N++;C(L,K);B+=1;if(d(o).data("settings").tokenLimit!==null&&B>=d(o).data("settings").tokenLimit){F.hide();M()}return ai}function S(af){var ah=d(o).data("settings").onAdd;if(B>0&&d(o).data("settings").preventDuplicates){var ag=null;v.children().each(function(){var aj=d(this);var ai=d.data(aj.get(0),"tokeninput");if(ai&&ai.id===af.id){ag=aj;return false}});if(ag){aa(ag);t.insertAfter(ag);ae(F);return}}if(d(o).data("settings").tokenLimit===null||B<d(o).data("settings").tokenLimit){p(af);O()}F.val("");M();if(d.isFunction(ah)){ah.call(K,af)}}function aa(af){if(!d(o).data("settings").disabled){af.addClass(d(o).data("settings").classes.selectedToken);J=af.get(0);F.val("");M()}}function Q(ag,af){ag.removeClass(d(o).data("settings").classes.selectedToken);J=null;if(af===h.BEFORE){t.insertBefore(ag);N--}else{if(af===h.AFTER){t.insertAfter(ag);N++}else{t.appendTo(v);N=B}}ae(F)}function ac(ag){var af=J;if(J){Q(d(J),h.END)}if(af===ag.get(0)){Q(ag,h.END)}else{aa(ag)}}function q(ag){var ah=d.data(ag.get(0),"tokeninput");var ai=d(o).data("settings").onDelete;var af=ag.prevAll().length;if(af>N){af--}ag.remove();J=null;ae(F);L=L.slice(0,af).concat(L.slice(af+1));if(af<N){N--}C(L,K);B-=1;if(d(o).data("settings").tokenLimit!==null){F.show().val("");ae(F)}if(d.isFunction(ai)){ai.call(K,ah)}}function C(ah,af){var ag=d.map(ah,function(ai){if(typeof d(o).data("settings").tokenValue=="function"){return d(o).data("settings").tokenValue.call(this,ai)}return ai[d(o).data("settings").tokenValue]});af.val(ag.join(d(o).data("settings").tokenDelimiter))}function M(){ab.hide().empty();V=null}function w(){ab.css({position:"absolute",top:d(v).offset().top+d(v).outerHeight(),left:d(v).offset().left,width:d(v).outerWidth(),"z-index":d(o).data("settings").zindex}).show()}function u(){if(d(o).data("settings").searchingText){ab.html("<p>"+k(d(o).data("settings").searchingText)+"</p>");w()}}function r(){if(d(o).data("settings").hintText){ab.html("<p>"+k(d(o).data("settings").hintText)+"</p>");w()}}var P=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g");function W(af){return af.replace(P,"\\$&")}function A(ag,af){return ag.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+W(af)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(ah,ai){return"<b>"+k(ai)+"</b>"})}function G(ag,ah,af){return ag.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+W(ah)+")(?![^<>]*>)(?![^&;]+;)","g"),A(ah,af))}function U(ah,af){if(af&&af.length){ab.empty();var ag=d("<ul>").appendTo(ab).mouseover(function(ai){ad(d(ai.target).closest("li"))}).mousedown(function(ai){S(d(ai.target).closest("li").data("tokeninput"));K.change();return false}).hide();if(d(o).data("settings").resultsLimit&&af.length>d(o).data("settings").resultsLimit){af=af.slice(0,d(o).data("settings").resultsLimit)}d.each(af,function(ai,aj){var ak=d(o).data("settings").resultsFormatter(aj);ak=G(ak,aj[d(o).data("settings").propertyToSearch],ah);ak=d(ak).appendTo(ag);if(ai%2){ak.addClass(d(o).data("settings").classes.dropdownItem)}else{ak.addClass(d(o).data("settings").classes.dropdownItem2)}if(ai===0){ad(ak)}d.data(ak.get(0),"tokeninput",aj)});w();if(d(o).data("settings").animateDropdown){ag.slideDown("fast")}else{ag.show()}}else{if(d(o).data("settings").noResultsText){ab.html("<p>"+k(d(o).data("settings").noResultsText)+"</p>");w()}}}function ad(af){if(af){if(V){m(d(V))}af.addClass(d(o).data("settings").classes.selectedDropdownItem);V=af.get(0)}}function m(af){af.removeClass(d(o).data("settings").classes.selectedDropdownItem);V=null}function I(){var af=F.val();if(af&&af.length){if(J){Q(d(J),h.AFTER)}if(af.length>=d(o).data("settings").minChars){u();clearTimeout(X);X=setTimeout(function(){z(af)},d(o).data("settings").searchDelay)}else{M()}}}function z(al){var ah=al+D();var af=x.get(ah);if(af){if(d.isFunction(d(o).data("settings").onCachedResult)){af=d(o).data("settings").onCachedResult.call(K,af)}U(al,af)}else{if(d(o).data("settings").url){var aj=D();var ai={};ai.data={};if(aj.indexOf("?")>-1){var am=aj.split("?");ai.url=am[0];var ag=am[1].split("&");d.each(ag,function(an,ap){var ao=ap.split("=");ai.data[ao[0]]=ao[1]})}else{ai.url=aj}ai.data[d(o).data("settings").queryParam]=d(o).data("settings").formatQueryParam(al,ai);ai.type=d(o).data("settings").method;ai.dataType=d(o).data("settings").contentType;if(d(o).data("settings").crossDomain){ai.dataType="jsonp"}ai.success=function(an){if(d(o).data("settings").caching){x.add(ah,d(o).data("settings").jsonContainer?an[d(o).data("settings").jsonContainer]:an)}if(d.isFunction(d(o).data("settings").onResult)){an=d(o).data("settings").onResult.call(K,an)}if(F.val()===al){U(al,d(o).data("settings").jsonContainer?an[d(o).data("settings").jsonContainer]:an)}};d.ajax(ai)}else{if(d(o).data("settings").local_data){var ak=d.grep(d(o).data("settings").local_data,function(an){return an[d(o).data("settings").propertyToSearch].toLowerCase().indexOf(al.toLowerCase())>-1});x.add(ah,ak);if(d.isFunction(d(o).data("settings").onResult)){ak=d(o).data("settings").onResult.call(K,ak)}U(al,ak)}}}}function D(){var af=d(o).data("settings").url;if(typeof d(o).data("settings").url=="function"){af=d(o).data("settings").url.call(d(o).data("settings"))}return af}function ae(af){setTimeout(function(){af.focus()},50)}};d.TokenList.Cache=function(l){var n=d.extend({max_size:500},l);var o={};var m=0;var k=function(){o={};m=0};this.add=function(q,p){if(m>n.max_size){k()}if(!o[q]){m+=1}o[q]=p};this.get=function(p){return o[p]}}}(jQuery));$(function(){$.fn.linker=function(){$(this).each(function(){var h=$(this);var l=h.parents(".linker-wrapper:first");if(h.hasClass("initialised")){return}h.addClass("initialised");$(".prelinker",l).remove();var a={url:decodeURIComponent(h.data("url")),browse_url:decodeURIComponent(h.data("browse-url")),format_template:h.data("format_template"),format_template_id:h.data("format_template_id"),format_property:h.data("format_property"),path:h.data("path"),name:h.data("name"),multiplicity:h.data("multiplicity")||"many",label:h.data("label"),label_plural:h.data("label_plural"),modal_id:h.data("modal_id")||(h.attr("id")+"_modal"),sortable:h.data("sortable")===true,types:h.data("types"),exclude_ids:h.data("exclude")||[]};a.allow_multiple=a.multiplicity==="many";if(a.format_template&&a.format_template.substring(0,2)!="${"){a.format_template="${"+a.format_template+"}"}var i=function(m){var n=$("#"+a.modal_id);var o=function(p){$(".linker-container",n).html(p);$("#createAndLinkButton",n).removeAttr("disabled");$("form",n).ajaxForm({data:{inline:true},beforeSubmit:function(){$("#createAndLinkButton",n).attr("disabled","disabled")},success:function(r,q,s){if($(r).is("form")){o(r)}else{if(a.multiplicity==="one"){e()}h.tokenInput("add",{id:r.uri,name:r.display_string||r.title,json:r});h.triggerHandler("change");n.modal("hide")}},error:function(s,r,q){$("#createAndLinkButton",n).removeAttr("disabled")}});n.scrollTo(".alert");n.trigger("resize");$(document).triggerHandler("loadedrecordform.aspace",[n])};$.ajax({url:m,success:o});$("#createAndLinkButton",n).click(function(){$("form",n).triggerHandler("submit")})};var f=function(){AS.openCustomModal(a.modal_id,"Create "+a.label,AS.renderTemplate("linker_createmodal_template",a),"large",{},this);if($(this).hasClass("linker-create-btn")){i($(this).data("target"))}else{i($(".linker-create-btn:first",l).data("target"))}return false};var j=function(){var o={};var n=function(p){$.each(h.tokenInput("get"),function(){o[this.id]=this.json});$.ajax({url:a.browse_url,data:{page:1,type:a.types,linker:true,exclude:a.exclude_ids,multiplicity:a.multiplicity},type:"GET",dataType:"html",success:function(s){var r=$("#"+a.modal_id);var t=$(".linker-container",r);var q=function(){$(":input[name=linker-item]",t).each(function(){var u=$(this);u.click(function(v){v.stopPropagation();if(!a.allow_multiple){o={};$("tr.selected",u.closest("table")).removeClass("selected")}if(o.hasOwnProperty(u.val())){delete o[u.val()];u.closest("tr").removeClass("selected")}else{o[u.val()]=u.data("object");u.closest("tr").addClass("selected")}});$("td",u.closest("tr")).click(function(v){v.preventDefault();u.trigger("click")})});$.each(o,function(u){$(":input[value='"+u+"']",t).attr("checked","checked").closest("tr").addClass("selected")});r.trigger("resize")};t.html(s);$(t).on("click","a",function(u){u.preventDefault();t.load(u.target.href,q)});$(t).on("submit","form",function(v){v.preventDefault();var u=$(v.target);var w=(u.attr("method")||"get").toUpperCase();if(w=="POST"){jQuery.post(u.attr("action")+".js",u.serializeArray(),function(x){t.html(x);q()})}else{t.load(u.attr("action")+".js?"+u.serialize(),q)}});q()}})};var m=function(){selectedItems=[];$(".token-input-delete-token",l).each(function(){$(this).triggerHandler("click")});$.each(o,function(q,p){h.tokenInput("add",{id:q,name:p.display_string||p.title,json:p})});$("#"+a.modal_id).modal("hide");h.triggerHandler("change")};AS.openCustomModal(a.modal_id,"Browse "+a.label_plural,AS.renderTemplate("linker_browsemodal_template",a),"large",{},this);n();$("#"+a.modal_id).on("click","#addSelectedButton",m);$("#"+a.modal_id).on("click",".linker-list .pagination .navigation a",function(){n($(this).attr("rel"))});return false};var g=function(o){var n=[];var m=[];$.each(h.tokenInput("get"),function(p){m.push(p.id)});$.each(o.search_data.results,function(p,q){if($.inArray(q.uri,m)===-1){n.push({name:q.display_string||q.title,id:q.id,json:q})}});return n};var b=function(){$(".linker-browse-btn",l).on("click",j);$(".linker-create-btn",l).on("click",f);l.one("mouseenter focus",".has-popover",function(){$(document).triggerHandler("init.popovers",[h.parent()])})};var e=function(){var o=$(".token-input-list",h.parent());for(var n=0;n<h.tokenInput("get").length;n++){var m=h.tokenInput("get")[n].id.replace(/\//g,"_");$("#"+m+" :input",o).remove()}h.tokenInput("clear")};var d=function(){if($(".token-input-list",l).data("sortable")){$(".token-input-list",l).sortable("destroy")}$(".token-input-list",l).sortable({items:"li.token-input-token"});$(".token-input-list",l).off("sortupdate").on("sortupdate",function(){h.parents("form:first").triggerHandler("formchanged.aspace")})};var c=function(){if(h.data("multiplicity")==="one"){if($.isEmptyObject(h.data("selected"))){return[]}return[{id:h.data("selected").uri,name:h.data("selected").display_string||h.data("selected").title,json:h.data("selected")}]}else{if(!h.data("selected")||h.data("selected").length===0){return[]}return h.data("selected").map(function(m){return{id:m.uri,name:m.display_string||m.title,json:m}})}};var k=function(){var m=$.extend({},AS.linker_locales,{animateDropdown:false,preventDuplicates:true,allowFreeTagging:false,tokenLimit:(a.multiplicity==="one"?1:null),caching:false,onCachedResult:g,onResult:g,zindex:1100,tokenFormatter:function(o){var n=$(AS.renderTemplate("linker_selectedtoken_template",{item:o,config:a}));$("input[name*=resolved]",n).val(JSON.stringify(o.json));return n},resultsFormatter:function(p){var o=p.name;var n=$("<span class='"+p.json.jsonmodel_type+"'>");n.text(o);n.prepend("<span class='icon-token'></span>");var q=$("<li>");q.append(n);return q[0].outerHTML},prePopulate:c(),onDelete:function(){h.triggerHandler("change")},onAdd:function(n){if(a.sortable&&a.allow_multiple){d()}$(document).triggerHandler("init.popovers",[h.parent()])},formatQueryParam:function(p,o){if(h.tokenInput("get").length>0||a.exclude_ids.length>0){var n=$.merge([],a.exclude_ids);$.each(h.tokenInput("get"),function(q,r){n.push(r.id)});o.data["exclude[]"]=n}if(a.types&&a.types.length>0){o.data.type=a.types}return(p+"*").toLowerCase()}});setTimeout(function(){h.tokenInput(a.url,m);$("> :input[type=text]",$(".token-input-input-token",h.parent())).attr("placeholder",AS.linker_locales.hintText);$("> :input[type=text]",$(".token-input-input-token",h.parent())).addClass("form-control");h.parent().addClass("multiplicity-"+a.multiplicity);if(a.sortable&&a.allow_multiple){d();l.addClass("sortable")}});b()};k()})}});$(document).ready(function(){$(document).bind("loadedrecordsubforms.aspace",function(a,b){$(".linker-wrapper:visible > .linker:not(.initialised)",b).linker();$("#archives_tree_toolbar .linker:not(.initialised)").linker()});$(document).bind("subrecordcreated.aspace",function(c,a,b){$(".linker:not(.initialised)",b).linker()})});window.CodeMirror=(function(){function p(a6,a2){var cq={},bD=p.defaults;for(var aU in bD){if(bD.hasOwnProperty(aU)){cq[aU]=(a2&&a2.hasOwnProperty(aU)?a2:bD)[aU]}}var bG=ai("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em");bG.setAttribute("wrap","off");bG.setAttribute("autocorrect","off");bG.setAttribute("autocapitalize","off");var cm=ai("div",[bG],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");var cO=ai("div",null,"CodeMirror-scrollbar-inner");var a5=ai("div",[cO],"CodeMirror-scrollbar");var aL=ai("div"),bA=ai("div",null,null,"position: relative; z-index: -1");var bx=ai("pre","\u00a0","CodeMirror-cursor"),br=ai("pre","\u00a0","CodeMirror-cursor","visibility: hidden");var aQ=ai("div",null,null,"position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden;");var bR=ai("div",[aQ,bx,br,bA,aL],null,"position: relative; z-index: 0");var bi=ai("div",null,"CodeMirror-gutter-text"),a0=ai("div",[bi],"CodeMirror-gutter");var cJ=ai("div",[a0,ai("div",[bR],"CodeMirror-lines")],null,"position: relative");var cz=ai("div",[cJ],null,"position: relative");var bE=ai("div",[cz],"CodeMirror-scroll");bE.setAttribute("tabIndex","-1");var aY=ai("div",[cm,a5,bE],"CodeMirror"+(cq.lineWrapping?" CodeMirror-wrap":""));if(a6.appendChild){a6.appendChild(aY)}else{a6(aY)}c5();cY();if(h){bG.style.width="0px"}if(!k){bE.draggable=true}bR.style.outline="none";if(cq.tabindex!=null){bG.tabIndex=cq.tabindex}if(cq.autofocus){bY()}if(!cq.gutter&&!cq.lineNumbers){a0.style.display="none"}if(af){cm.style.height="1px",cm.style.position="absolute"}if(U){a5.style.zIndex=-2;a5.style.visibility="hidden"}else{if(J){a5.style.minWidth="18px"}}var cx=new i(),aR=new i(),di;var cE,c1=new aj([new O([new H("")])]),dc=0,cL;cj();var dq={from:{line:0,ch:0},to:{line:0,ch:0},inverted:false};var cK,bL,bk,bT=0,bw,cQ=false,cV=false,cc=false;var cS,cw,aW,dg,a9,bc,c2;var by=0,dj=0,b9=0,ca=0;var ct;var b3=c8(0),c6=false,bK=true;var bP=false;var cX=null;aM(function(){bg(cq.value||"");cS=false})();var bu=new D();aC(bE,"mousedown",aM(cM));aC(bE,"dblclick",aM(cl));aC(bR,"selectstart",e);if(!v){aC(bE,"contextmenu",bm)}aC(bE,"scroll",cB);aC(a5,"scroll",bZ);aC(a5,"mousedown",function(){if(cL){setTimeout(bY,0)}});var cA=aC(window,"resize",function(){if(aY.parentNode){cG(true)}else{cA()}},true);aC(bG,"keyup",aM(cN));aC(bG,"input",ba);aC(bG,"keydown",aM(cF));aC(bG,"keypress",aM(bH));aC(bG,"focus",dn);aC(bG,"blur",aZ);function b2(ds){if(cq.onDragEvent&&cq.onDragEvent(cC,P(ds))){return}ac(ds)}if(cq.dragDrop){aC(bE,"dragstart",a1);aC(bE,"dragenter",b2);aC(bE,"dragover",b2);aC(bE,"drop",aM(aH))}aC(bE,"paste",function(){bY();ba()});aC(bG,"paste",function(){cc=true;ba()});aC(bG,"cut",aM(function(){if(!cq.readOnly){bO("")}}));if(af){aC(cz,"mouseup",function(){if(document.activeElement==bG){bG.blur()}bY()})}var cZ;try{cZ=(document.activeElement==bG)}catch(cy){}if(cZ||cq.autofocus){setTimeout(dn,20)}else{aZ()}function bN(ds){return ds>=0&&ds<c1.size}var cC=aY.CodeMirror={getValue:cr,setValue:aM(bg),getSelection:cs,replaceSelection:aM(bO),focus:function(){window.focus();bY();dn();ba()},setOption:function(dt,du){var ds=cq[dt];cq[dt]=du;if(dt=="mode"||dt=="indentUnit"){cj()}else{if(dt=="readOnly"&&du=="nocursor"){aZ();bG.blur()}else{if(dt=="readOnly"&&!du){c4(true)}else{if(dt=="theme"){c5()}else{if(dt=="lineWrapping"&&ds!=du){aM(c9)()}else{if(dt=="tabSize"){cG(true)}else{if(dt=="keyMap"){cY()}else{if(dt=="tabindex"){bG.tabIndex=du}}}}}}}}if(dt=="lineNumbers"||dt=="gutter"||dt=="firstLineNumber"||dt=="theme"||dt=="lineNumberFormatter"){bz();cG(true)}},getOption:function(ds){return cq[ds]},getMode:function(){return cE},undo:aM(dm),redo:aM(db),indentLine:aM(function(dt,ds){if(typeof ds!="string"){if(ds==null){ds=cq.smartIndent?"smart":"prev"}else{ds=ds?"add":"subtract"}}if(bN(dt)){bX(dt,ds)}}),indentSelection:aM(c3),historySize:function(){return{undo:bu.done.length,redo:bu.undone.length}},clearHistory:function(){bu=new D()},setHistory:function(ds){bu=new D();bu.done=ds.done;bu.undone=ds.undone},getHistory:function(){function ds(dy){for(var dx=0,dz=[],dA;dx<dy.length;++dx){dz.push(dA=[]);for(var dw=0,dv=dy[dx];dw<dv.length;++dw){var dt=[],dB=dv[dw];dA.push({start:dB.start,added:dB.added,old:dt});for(var du=0;du<dB.old.length;++du){dt.push(ar(dB.old[du]))}}}return dz}return{done:ds(bu.done),undone:ds(bu.undone)}},matchBrackets:aM(function(){cH(true)}),getTokenAt:aM(function(ds){ds=bd(ds);return c8(ds.line).getTokenAt(cE,cW(ds.line),cq.tabSize,ds.ch)}),getStateAfter:function(ds){ds=co(ds==null?c1.size-1:ds);return cW(ds+1)},cursorCoords:function(dt,ds){if(dt==null){dt=dq.inverted}return this.charCoords(dt?dq.from:dq.to,ds)},charCoords:function(dt,ds){dt=bd(dt);if(ds=="local"){return dk(dt,false)}if(ds=="div"){return dk(dt,true)}return aJ(dt)},coordsChar:function(ds){var dt=z(bR);return b6(ds.x-dt.left,ds.y-dt.top)},defaultTextHeight:function(){return ce()},markText:aM(b4),setBookmark:be,findMarksAt:bI,setMarker:aM(ck),clearMarker:aM(aP),setLineClass:aM(bF),hideLine:aM(function(ds){return dd(ds,true)}),showLine:aM(function(ds){return dd(ds,false)}),onDeleteLine:function(ds,dt){if(typeof ds=="number"){if(!bN(ds)){return null}ds=c8(ds)}(ds.handlers||(ds.handlers=[])).push(dt);return ds},lineInfo:bf,getViewport:function(){return{from:dj,to:b9}},addWidget:function(dw,du,dy,dv,dA){dw=dk(bd(dw));var dx=dw.yBot,dt=dw.x;du.style.position="absolute";cz.appendChild(du);if(dv=="over"){dx=dw.y}else{if(dv=="near"){var ds=Math.max(bE.offsetHeight,c1.height*ce()),dz=Math.max(cz.clientWidth,bR.clientWidth)-bq();if(dw.yBot+du.offsetHeight>ds&&dw.y>du.offsetHeight){dx=dw.y-du.offsetHeight}if(dt+du.offsetWidth>dz){dt=dz-du.offsetWidth}}}du.style.top=(dx+cU())+"px";du.style.left=du.style.right="";if(dA=="right"){dt=cz.clientWidth-du.offsetWidth;du.style.right="0px"}else{if(dA=="left"){dt=0}else{if(dA=="middle"){dt=(cz.clientWidth-du.offsetWidth)/2}}du.style.left=(dt+bq())+"px"}if(dy){aV(dt,dx,dt+du.offsetWidth,dx+du.offsetHeight)}},lineCount:function(){return c1.size},clipPos:bd,getCursor:function(ds){if(ds==null){ds=dq.inverted}return Y(ds?dq.from:dq.to)},somethingSelected:function(){return !R(dq.from,dq.to)},setCursor:aM(function(ds,du,dt){if(du==null&&typeof ds.line=="number"){bs(ds.line,ds.ch,dt)}else{bs(ds,du,dt)}}),setSelection:aM(function(du,dt,ds){(ds?bW:bU)(bd(du),bd(dt||du))}),getLine:function(ds){if(bN(ds)){return c8(ds).text}},getLineHandle:function(ds){if(bN(ds)){return c8(ds)}},setLine:aM(function(ds,dt){if(bN(ds)){cf(dt,{line:ds,ch:0},{line:ds,ch:c8(ds).text.length})}}),removeLine:aM(function(ds){if(bN(ds)){cf("",{line:ds,ch:0},bd({line:ds+1,ch:0}))}}),replaceRange:aM(cf),getRange:function(du,dt,ds){return dh(bd(du),bd(dt),ds)},triggerOnKeyDown:aM(cF),execCommand:function(ds){return r[ds](cC)},moveH:aM(c7),deleteH:aM(cP),moveV:aM(c0),toggleOverwrite:function(){if(cQ){cQ=false;bx.className=bx.className.replace(" CodeMirror-overwrite","")}else{cQ=true;bx.className+=" CodeMirror-overwrite"}},posFromIndex:function(dt){var du=0,ds;c1.iter(0,c1.size,function(dv){var dw=dv.text.length+1;if(dw>dt){ds=dt;return true}dt-=dw;++du});return bd({line:du,ch:ds})},indexFromPos:function(dt){if(dt.line<0||dt.ch<0){return 0}var ds=dt.ch;c1.iter(0,dt.line,function(du){ds+=du.text.length+1});return ds},scrollTo:function(ds,dt){if(ds!=null){bE.scrollLeft=ds}if(dt!=null){a5.scrollTop=bE.scrollTop=dt}cG([])},getScrollInfo:function(){return{x:bE.scrollLeft,y:a5.scrollTop,height:a5.scrollHeight,width:bE.scrollWidth}},scrollIntoView:function(dt){var ds=dk(dt?bd(dt):dq.inverted?dq.from:dq.to);aV(ds.x,ds.y,ds.x,ds.yBot)},setSize:function(du,ds){function dt(dv){dv=String(dv);return/^\d+$/.test(dv)?dv+"px":dv}if(du!=null){aY.style.width=dt(du)}if(ds!=null){bE.style.height=dt(ds)}cC.refresh()},operation:function(ds){return aM(ds)()},compoundChange:function(ds){return cd(ds)},refresh:function(){cG(true,null,bT);if(a5.scrollHeight>bT){a5.scrollTop=bT}},getInputField:function(){return bG},getWrapperElement:function(){return aY},getScrollerElement:function(){return bE},getGutterElement:function(){return a0}};function c8(ds){return K(c1,ds)}function bo(dt,ds){bc=true;var du=ds-dt.height;for(var dv=dt;dv;dv=dv.parent){dv.height+=du}}function cb(ds,dt){if(!ds.styles){ds.highlight(cE,ds.stateAfter=cW(V(ds)),cq.tabSize)}return ds.getContent(cq.tabSize,dt,cq.lineWrapping)}function bg(ds){var dt={line:0,ch:0};a8(dt,{line:c1.size-1,ch:c8(c1.size-1).text.length},g(ds),dt,dt);cS=true}function cr(dt){var ds=[];c1.iter(0,c1.size,function(du){ds.push(du.text)});return ds.join(dt||"\n")}function bZ(ds){if(Math.abs(a5.scrollTop-bT)>1){bT=bE.scrollTop=a5.scrollTop;cG([])}}function cB(ds){if(cq.fixedGutter&&a0.style.left!=bE.scrollLeft+"px"){a0.style.left=bE.scrollLeft+"px"}if(Math.abs(bE.scrollTop-bT)>1){bT=bE.scrollTop;if(a5.scrollTop!=bT){a5.scrollTop=bT}cG([])}if(cq.onScroll){cq.onScroll(cC)}}function cM(dE){bp(ab(dE,"shiftKey"));for(var dy=ap(dE);dy!=aY;dy=dy.parentNode){if(dy.parentNode==cz&&dy!=cJ){return}}for(var dy=ap(dE);dy!=aY;dy=dy.parentNode){if(dy.parentNode==bi){if(cq.onGutterClick){cq.onGutterClick(cC,s(bi.childNodes,dy)+dj,dE)}return e(dE)}}var dt=bn(dE);switch(C(dE)){case 3:if(v){bm(dE)}return;case 2:if(dt){bs(dt.line,dt.ch,true)}setTimeout(bY,20);e(dE);return}if(!dt){if(ap(dE)==bE){e(dE)}return}if(!cL){dn()}var du=+new Date,dH="single";if(bk&&bk.time>du-400&&R(bk.pos,dt)){dH="triple";e(dE);setTimeout(bY,20);a3(dt.line)}else{if(bL&&bL.time>du-400&&R(bL.pos,dt)){dH="double";bk={time:du,pos:dt};e(dE);var ds=bQ(dt);bW(ds.from,ds.to)}else{bL={time:du,pos:dt}}}function dz(dJ){if(k){bE.draggable=false}bw=false;dD();dx();if(Math.abs(dE.clientX-dJ.clientX)+Math.abs(dE.clientY-dJ.clientY)<10){e(dJ);bs(dt.line,dt.ch,true);bY()}}var dI=dt,dw;if(cq.dragDrop&&aa&&!cq.readOnly&&!R(dq.from,dq.to)&&!B(dt,dq.from)&&!B(dq.to,dt)&&dH=="single"){if(k){bE.draggable=true}var dD=aC(document,"mouseup",aM(dz),true);var dx=aC(bE,"drop",aM(dz),true);bw=true;if(bE.dragDrop){bE.dragDrop()}return}e(dE);if(dH=="single"){bs(dt.line,dt.ch,true)}var dG=dq.from,dv=dq.to;function dB(dK){if(dH=="single"){bW(dt,dK)}else{if(dH=="double"){var dJ=bQ(dK);if(B(dK,dG)){bW(dJ.from,dv)}else{bW(dG,dJ.to)}}else{if(dH=="triple"){if(B(dK,dG)){bW(dv,bd({line:dK.line,ch:0}))}else{bW(dG,bd({line:dK.line+1,ch:0}))}}}}}function dF(dJ){var dL=bn(dJ,true);if(dL&&!R(dL,dI)){if(!cL){dn()}dI=dL;dB(dL);cS=false;var dK=b0();if(dL.line>=dK.to||dL.line<dK.from){dw=setTimeout(aM(function(){dF(dJ)}),150)}}}function dC(dJ){clearTimeout(dw);var dK=bn(dJ);if(dK){dB(dK)}e(dJ);bY();cS=true;dA();dD()}var dA=aC(document,"mousemove",aM(function(dJ){clearTimeout(dw);e(dJ);if(!S&&!C(dJ)){dC(dJ)}else{dF(dJ)}}),true);var dD=aC(document,"mouseup",aM(dC),true)}function cl(ds){for(var dt=ap(ds);dt!=aY;dt=dt.parentNode){if(dt.parentNode==bi){return e(ds)}}e(ds)}function aH(dw){if(cq.onDragEvent&&cq.onDragEvent(cC,P(dw))){return}e(dw);var dz=bn(dw,true),dt=dw.dataTransfer.files;if(!dz||cq.readOnly){return}if(dt&&dt.length&&window.FileReader&&window.File){var dy=dt.length,dx=Array(dy),du=0;var dv=function(dC,dB){var dA=new FileReader;dA.onload=function(){dx[dB]=dA.result;if(++du==dy){dz=bd(dz);aM(function(){var dD=cf(dx.join(""),dz,dz);bW(dz,dD)})()}};dA.readAsText(dC)};for(var ds=0;ds<dy;++ds){dv(dt[ds],ds)}}else{if(bw&&!(B(dz,dq.from)||B(dq.to,dz))){return}try{var dx=dw.dataTransfer.getData("Text");if(dx){cd(function(){var dB=dq.from,dA=dq.to;bW(dz,dz);if(bw){cf("",dB,dA)}bO(dx);bY()})}}catch(dw){}}}function a1(dt){var ds=cs();dt.dataTransfer.setData("Text",ds);if(dt.dataTransfer.setDragImage){dt.dataTransfer.setDragImage(ai("img"),0,0)}}function bC(du,ds){if(typeof du=="string"){du=r[du];if(!du){return false}}var dt=cK;try{if(cq.readOnly){cV=true}if(ds){cK=null}du(cC)}catch(dv){if(dv!=ao){throw dv}return false}finally{cK=dt;cV=false}return true}var b1;function de(dz){var ds=aq(cq.keyMap),dw=ds.auto;clearTimeout(b1);if(dw&&!ah(dz)){b1=setTimeout(function(){if(aq(cq.keyMap)==ds){cq.keyMap=(dw.call?dw.call(null,cC):dw)}},50)}var dt=u[ab(dz,"keyCode")],dy=false;var dv=av&&I;if(dt==null||dz.altGraphKey){return false}if(ab(dz,"altKey")){dt="Alt-"+dt}if(ab(dz,dv?"metaKey":"ctrlKey")){dt="Ctrl-"+dt}if(ab(dz,dv?"ctrlKey":"metaKey")){dt="Cmd-"+dt}var dx=false;function du(){dx=true}if(ab(dz,"shiftKey")){dy=at("Shift-"+dt,cq.extraKeys,cq.keyMap,function(dA){return bC(dA,true)},du)||at(dt,cq.extraKeys,cq.keyMap,function(dA){if(typeof dA=="string"&&/^go[A-Z]/.test(dA)){return bC(dA)}},du)}else{dy=at(dt,cq.extraKeys,cq.keyMap,bC,du)}if(dx){dy=false}if(dy){e(dz);df();if(G){dz.oldKeyCode=dz.keyCode;dz.keyCode=0}}return dy}function cn(du,ds){var dt=at("'"+ds+"'",cq.extraKeys,cq.keyMap,function(dv){return bC(dv,true)});if(dt){e(du);df()}return dt}var da=null;function cF(du){if(!cL){dn()}if(S&&du.keyCode==27){du.returnValue=false}if(bP){if(b8()){bP=false}}if(cq.onKeyEvent&&cq.onKeyEvent(cC,P(du))){return}var ds=ab(du,"keyCode");bp(ds==16||ab(du,"shiftKey"));var dt=de(du);if(av){da=dt?ds:null;if(!dt&&ds==88&&ab(du,I?"metaKey":"ctrlKey")){bO("")}}}function bH(dv){if(bP){b8()}if(cq.onKeyEvent&&cq.onKeyEvent(cC,P(dv))){return}var du=ab(dv,"keyCode"),ds=ab(dv,"charCode");if(av&&du==da){da=null;e(dv);return}if(((av&&(!dv.which||dv.which<10))||af)&&de(dv)){return}var dt=String.fromCharCode(ds==null?du:ds);if(cq.electricChars&&cE.electricChars&&cq.smartIndent&&!cq.readOnly){if(cE.electricChars.indexOf(dt)>-1){setTimeout(aM(function(){bX(dq.to.line,"smart")}),75)}}if(cn(dv,dt)){return}ba()}function cN(ds){if(cq.onKeyEvent&&cq.onKeyEvent(cC,P(ds))){return}if(ab(ds,"keyCode")==16){cK=null}}function dn(){if(cq.readOnly=="nocursor"){return}if(!cL){if(cq.onFocus){cq.onFocus(cC)}cL=true;if(bE.className.search(/\bCodeMirror-focused\b/)==-1){bE.className+=" CodeMirror-focused"}}aG();df()}function aZ(){if(cL){if(cq.onBlur){cq.onBlur(cC)}cL=false;if(ct){aM(function(){if(ct){ct();ct=null}})()}bE.className=bE.className.replace(" CodeMirror-focused","")}clearInterval(di);setTimeout(function(){if(!cL){cK=null}},150)}function a8(dy,dx,dw,dt,ds){if(cV){return}var dv=[];c1.iter(dy.line,dx.line+1,function(dz){dv.push(j(dz.text,dz.markedSpans))});if(bu){bu.addChange(dy.line,dw.length,dv);while(bu.done.length>cq.undoDepth){bu.done.shift()}}var du=W(d(dv[0]),d(N(dv)),dy.ch,dx.ch,dw);aN(dy,dx,du,dt,ds)}function cD(dx,dy){if(!dx.length){return}var dz=dx.pop(),dt=[];for(var du=dz.length-1;du>=0;du-=1){var dw=dz[du];var dA=[],ds=dw.start+dw.added;c1.iter(dw.start,ds,function(dB){dA.push(j(dB.text,dB.markedSpans))});dt.push({start:dw.start,added:dw.old.length,old:dA});var dv={line:dw.start+dw.old.length-1,ch:A(ar(N(dA)),ar(N(dw.old)))};aN({line:dw.start,ch:0},{line:ds-1,ch:c8(ds-1).text.length},dw.old,dv,dv)}cS=true;dy.push(dt)}function dm(){cD(bu.done,bu.undone)}function db(){cD(bu.undone,bu.done)}function aN(dH,dw,dt,ds,dL){if(cV){return}var dK=false,dv=b3.text.length;if(!cq.lineWrapping){c1.iter(dH.line,dw.line+1,function(dM){if(!dM.hidden&&dM.text.length==dv){dK=true;return true}})}if(dH.line!=dw.line||dt.length>1){bc=true}var dF=dw.line-dH.line,dE=c8(dH.line),du=c8(dw.line);var dB=N(dt);if(dH.ch==0&&dw.ch==0&&ar(dB)==""){var dC=[],dD=null;for(var dI=0,dJ=dt.length-1;dI<dJ;++dI){dC.push(new H(ar(dt[dI]),d(dt[dI])))}du.update(du.text,d(dB));if(dF){c1.remove(dH.line,dF,c2)}if(dC.length){c1.insert(dH.line,dC)}}else{if(dE==du){if(dt.length==1){dE.update(dE.text.slice(0,dH.ch)+ar(dt[0])+dE.text.slice(dw.ch),d(dt[0]))}else{for(var dC=[],dI=1,dJ=dt.length-1;dI<dJ;++dI){dC.push(new H(ar(dt[dI]),d(dt[dI])))}dC.push(new H(ar(dB)+dE.text.slice(dw.ch),d(dB)));dE.update(dE.text.slice(0,dH.ch)+ar(dt[0]),d(dt[0]));c1.insert(dH.line+1,dC)}}else{if(dt.length==1){dE.update(dE.text.slice(0,dH.ch)+ar(dt[0])+du.text.slice(dw.ch),d(dt[0]));c1.remove(dH.line+1,dF,c2)}else{var dC=[];dE.update(dE.text.slice(0,dH.ch)+ar(dt[0]),d(dt[0]));du.update(ar(dB)+du.text.slice(dw.ch),d(dB));for(var dI=1,dJ=dt.length-1;dI<dJ;++dI){dC.push(new H(ar(dt[dI]),d(dt[dI])))}if(dF>1){c1.remove(dH.line+1,dF-1,c2)}c1.insert(dH.line+1,dC)}}}if(cq.lineWrapping){var dy=Math.max(5,bE.clientWidth/bB()-3);c1.iter(dH.line,dH.line+dt.length,function(dM){if(dM.hidden){return}var dN=Math.ceil(dM.text.length/dy)||1;if(dN!=dM.height){bo(dM,dN)}})}else{c1.iter(dH.line,dH.line+dt.length,function(dN){var dM=dN.text;if(!dN.hidden&&dM.length>dv){b3=dN;dv=dM.length;bK=true;dK=false}});if(dK){c6=true}}dc=Math.min(dc,dH.line);b5(400);var dA=dt.length-dF-1;aW.push({from:dH.line,to:dw.line+1,diff:dA});if(cq.onChange){for(var dI=0;dI<dt.length;++dI){if(typeof dt[dI]!="string"){dt[dI]=dt[dI].text}}var dz={from:dH,to:dw,text:dt};if(dg){for(var dx=dg;dx.next;dx=dx.next){}dx.next=dz}else{dg=dz}}function dG(dM){return dM<=Math.min(dw.line,dw.line+dA)?dM:dM+dA}bU(bd(ds),bd(dL),dG(dq.from.line),dG(dq.to.line))}function aK(){var ds=c1.height*ce()+2*cU();return ds*0.99>bE.offsetHeight?ds:false}function aO(dt){var ds=aK();a5.style.display=ds?"block":"none";if(ds){cO.style.height=cz.style.minHeight=ds+"px";a5.style.height=bE.clientHeight+"px";if(dt!=null){a5.scrollTop=bE.scrollTop=dt;if(k){setTimeout(function(){if(a5.scrollTop!=dt){return}a5.scrollTop=dt+(dt?-1:1);a5.scrollTop=dt},0)}}}else{cz.style.minHeight=""}cJ.style.top=by*ce()+"px"}function bV(){b3=c8(0);bK=true;var ds=b3.text.length;c1.iter(1,c1.size,function(du){var dt=du.text;if(!du.hidden&&dt.length>ds){ds=dt.length;b3=du}});c6=false}function cf(dt,dw,dv){dw=bd(dw);if(!dv){dv=dw}else{dv=bd(dv)}dt=g(dt);function du(dz){if(B(dz,dw)){return dz}if(!B(dv,dz)){return ds}var dx=dz.line+dt.length-(dv.line-dw.line)-1;var dy=dz.ch;if(dz.line==dv.line){dy+=N(dt).length-(dv.ch-(dv.line==dw.line?dw.ch:0))}return{line:dx,ch:dy}}var ds;aX(dt,dw,dv,function(dx){ds=dx;return{from:du(dq.from),to:du(dq.to)}});return ds}function bO(ds,dt){aX(g(ds),dq.from,dq.to,function(du){if(dt=="end"){return{from:du,to:du}}else{if(dt=="start"){return{from:dq.from,to:dq.from}}else{return{from:dq.from,to:du}}}})}function aX(dv,dx,dw,ds){var du=dv.length==1?dv[0].length+dx.ch:N(dv).length;var dt=ds({line:dx.line+dv.length-1,ch:du});a8(dx,dw,dv,dt.from,dt.to)}function dh(dx,dw,dv){var dt=dx.line,ds=dw.line;if(dt==ds){return c8(dt).text.slice(dx.ch,dw.ch)}var du=[c8(dt).text.slice(dx.ch)];c1.iter(dt+1,ds,function(dy){du.push(dy.text)});du.push(c8(ds).text.slice(0,dw.ch));return du.join(dv||"\n")}function cs(ds){return dh(dq.from,dq.to,ds)}function aG(){if(bP){return}cx.set(cq.pollInterval,function(){b8();if(cL){aG()}})}function ba(){var ds=false;bP=true;function dt(){var du=b8();if(!du&&!ds){ds=true;cx.set(60,dt)}else{bP=false;aG()}}cx.set(20,dt)}var bv="";function b8(){if(!cL||b(bG)||cq.readOnly){return false}var dt=bG.value;if(dt==bv){return false}if(!cT){a7()}cK=null;var du=0,ds=Math.min(bv.length,dt.length);while(du<ds&&bv[du]==dt[du]){++du}if(du<bv.length){dq.from={line:dq.from.line,ch:dq.from.ch-(bv.length-du)}}else{if(cQ&&R(dq.from,dq.to)&&!cc){dq.to={line:dq.to.line,ch:Math.min(c8(dq.to.line).text.length,dq.to.ch+(dt.length-du))}}}bO(dt.slice(du),"end");if(dt.length>1000){bG.value=bv=""}else{bv=dt}if(!cT){aT()}cc=false;return true}function c4(ds){if(!R(dq.from,dq.to)){bv="";bG.value=cs();if(cL){aD(bG)}}else{if(ds){bv=bG.value=""}}}function bY(){if(cq.readOnly!="nocursor"){bG.focus()}}function cI(){var dv=cg();aV(dv.x,dv.y,dv.x,dv.yBot);if(!cL){return}var dt=cz.getBoundingClientRect(),ds=null;if(dv.y+dt.top<0){ds=true}else{if(dv.y+dt.top+ce()>(window.innerHeight||document.documentElement.clientHeight)){ds=false}}if(ds!=null){var du=bx.style.display=="none";if(du){bx.style.display="";bx.style.left=dv.x+"px";bx.style.top=(dv.y-by)+"px"}bx.scrollIntoView(ds);if(du){bx.style.display="none"}}}function cg(){var dt=dk(dq.inverted?dq.from:dq.to);var ds=cq.lineWrapping?Math.min(dt.x,bR.offsetWidth):dt.x;return{x:ds,y:dt.y,yBot:dt.yBot}}function aV(dt,dv,ds,du){var dw=bj(dt,dv,ds,du);if(dw.scrollLeft!=null){bE.scrollLeft=dw.scrollLeft}if(dw.scrollTop!=null){a5.scrollTop=bE.scrollTop=dw.scrollTop}}function bj(dv,dC,dt,dB){var dy=bq(),dH=cU();dC+=dH;dB+=dH;dv+=dy;dt+=dy;var dE=bE.clientHeight,dw=a5.scrollTop,dG={};var du=aK()||Infinity;var ds=dC<dH+10,dA=dB+dH>du-10;if(dC<dw){dG.scrollTop=ds?0:Math.max(0,dC)}else{if(dB>dw+dE){dG.scrollTop=(dA?du:dB)-dE}}var dD=bE.clientWidth,dF=bE.scrollLeft;var dz=cq.fixedGutter?a0.clientWidth:0;var dx=dv<dz+dy+10;if(dv<dF+dz||dx){if(dx){dv=0}dG.scrollLeft=Math.max(0,dv-10-dz)}else{if(dt>dD+dF-3){dG.scrollLeft=dt+10-dD}}return dG}function b0(dw){var ds=ce(),dv=(dw!=null?dw:a5.scrollTop)-cU();var du=Math.max(0,Math.floor(dv/ds));var dt=Math.ceil((dv+bE.clientHeight)/ds);return{from:ad(c1,du),to:ad(c1,dt)}}function cG(dB,dx,dv){if(!bE.clientWidth){dj=b9=by=0;return}var dw=b0(dv);if(dB!==true&&dB.length==0&&dw.from>dj&&dw.to<b9){aO(dv);return}var dC=Math.max(dw.from-100,0),dD=Math.min(c1.size,dw.to+100);if(dj<dC&&dC-dj<20){dC=dj}if(b9>dD&&b9-dD<20){dD=Math.min(c1.size,b9)}var dF=dB===true?[]:cp([{from:dj,to:b9,domStart:0}],dB);var dA=0;for(var dy=0;dy<dF.length;++dy){var dz=dF[dy];if(dz.from<dC){dz.domStart+=(dC-dz.from);dz.from=dC}if(dz.to>dD){dz.to=dD}if(dz.from>=dz.to){dF.splice(dy--,1)}else{dA+=dz.to-dz.from}}if(dA==dD-dC&&dC==dj&&dD==b9){aO(dv);return}dF.sort(function(dH,dG){return dH.domStart-dG.domStart});var du=ce(),ds=a0.style.display;aL.style.display="none";bb(dC,dD,dF);aL.style.display=a0.style.display="";var dt=dC!=dj||dD!=b9||ca!=bE.clientHeight+du;if(dt){ca=bE.clientHeight+du}if(dC!=dj||dD!=b9&&cq.onViewportChange){setTimeout(function(){if(cq.onViewportChange){cq.onViewportChange(cC,dC,dD)}})}dj=dC;b9=dD;by=a(c1,dC);b5(100);if(aL.childNodes.length!=b9-dj){throw new Error("BAD PATCH! "+JSON.stringify(dF)+" size="+(b9-dj)+" nodes="+aL.childNodes.length)}function dE(){var dH=aL.firstChild,dG=false;c1.iter(dj,b9,function(dJ){if(!dH){return}if(!dJ.hidden){var dI=Math.round(dH.offsetHeight/du)||1;if(dJ.height!=dI){bo(dJ,dI);bc=dG=true}}dH=dH.nextSibling});return dG}if(cq.lineWrapping){dE()}a0.style.display=ds;if(dt||bc){a4()&&cq.lineWrapping&&dE()&&a4()}aO(dv);dp();if(!dx&&cq.onUpdate){cq.onUpdate(cC)}return true}function cp(dB,dz){for(var dw=0,du=dz.length||0;dw<du;++dw){var dy=dz[dw],ds=[],dA=dy.diff||0;for(var dv=0,dt=dB.length;dv<dt;++dv){var dx=dB[dv];if(dy.to<=dx.from&&dy.diff){ds.push({from:dx.from+dA,to:dx.to+dA,domStart:dx.domStart})}else{if(dy.to<=dx.from||dy.from>=dx.to){ds.push(dx)}else{if(dy.from>dx.from){ds.push({from:dx.from,to:dy.from,domStart:dx.domStart})}if(dy.to<dx.to){ds.push({from:dy.to+dA,to:dx.to+dA,domStart:dx.domStart+(dy.to-dx.from)})}}}}dB=ds}return dB}function bb(dA,dB,dD){function ds(dF){var dE=dF.nextSibling;dF.parentNode.removeChild(dF);return dE}if(!dD.length){aE(aL)}else{var dw=0,du=aL.firstChild,dt;for(var dx=0;dx<dD.length;++dx){var dC=dD[dx];while(dC.domStart>dw){du=ds(du);dw++}for(var dv=0,dz=dC.to-dC.from;dv<dz;++dv){du=du.nextSibling;dw++}}while(du){du=ds(du)}}var dy=dD.shift(),du=aL.firstChild,dv=dA;c1.iter(dA,dB,function(dE){if(dy&&dy.to==dv){dy=dD.shift()}if(!dy||dy.from>dv){if(dE.hidden){var dF=ai("pre")}else{var dF=cb(dE);if(dE.className){dF.className=dE.className}if(dE.bgClassName){var dG=ai("pre","\u00a0",dE.bgClassName,"position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: -2");dF=ai("div",[dG,dF],null,"position: relative")}}aL.insertBefore(dF,du)}else{du=du.nextSibling}++dv})}function a4(){if(!cq.gutter&&!cq.lineNumbers){return}var dt=cJ.offsetHeight,dB=bE.clientHeight;a0.style.height=(dt-dB<2?dB:dt)+"px";var dz=document.createDocumentFragment(),dx=dj,dA;c1.iter(dj,Math.max(b9,dj+1),function(dD){if(dD.hidden){dz.appendChild(ai("pre"))}else{var dC=dD.gutterMarker;var dG=cq.lineNumbers?cq.lineNumberFormatter(dx+cq.firstLineNumber):null;if(dC&&dC.text){dG=dC.text.replace("%N%",dG!=null?dG:"")}else{if(dG==null){dG="\u00a0"}}var dF=dz.appendChild(ai("pre",null,dC&&dC.style));dF.innerHTML=dG;for(var dE=1;dE<dD.height;++dE){dF.appendChild(ai("br"));dF.appendChild(document.createTextNode("\u00a0"))}if(!dC){dA=dx}}++dx});a0.style.display="none";q(bi,dz);if(dA!=null&&cq.lineNumbers){var dv=bi.childNodes[dA-dj];var dw=String(c1.size).length,ds=az(dv.firstChild),du="";while(ds.length+du.length<dw){du+="\u00a0"}if(du){dv.insertBefore(document.createTextNode(du),dv.firstChild)}}a0.style.display="";var dy=Math.abs((parseInt(bR.style.marginLeft)||0)-a0.offsetWidth)>2;bR.style.marginLeft=a0.offsetWidth+"px";bc=false;return dy}function dp(){var dv=R(dq.from,dq.to);var dG=dk(dq.from,true);var dB=dv?dG:dk(dq.to,true);var dz=dq.inverted?dG:dB,dt=ce();var ds=z(aY),du=z(aL);cm.style.top=Math.max(0,Math.min(bE.offsetHeight,dz.y+du.top-ds.top))+"px";cm.style.left=Math.max(0,Math.min(bE.offsetWidth,dz.x+du.left-ds.left))+"px";if(dv){bx.style.top=dz.y+"px";bx.style.left=(cq.lineWrapping?Math.min(dz.x,bR.offsetWidth):dz.x)+"px";bx.style.display="";bA.style.display="none"}else{var dE=dG.y==dB.y,dy=document.createDocumentFragment();var dC=bR.clientWidth||bR.offsetWidth;var dx=bR.clientHeight||bR.offsetHeight;var dF=function(dL,dK,dJ,dH){var dI=l?"width: "+(!dJ?dC:dC-dJ-dL)+"px":"right: "+dJ+"px";dy.appendChild(ai("div",null,"CodeMirror-selected","position: absolute; left: "+dL+"px; top: "+dK+"px; "+dI+"; height: "+dH+"px"))};if(dq.from.ch&&dG.y>=0){var dD=dE?dC-dB.x:0;dF(dG.x,dG.y,dD,dt)}var dw=Math.max(0,dG.y+(dq.from.ch?dt:0));var dA=Math.min(dB.y,dx)-dw;if(dA>0.2*dt){dF(0,dw,0,dA)}if((!dE||!dq.from.ch)&&dB.y<dx-0.5*dt){dF(0,dB.y,dC-dB.x,dt)}q(bA,dy);bx.style.display="none";bA.style.display=""}}function bp(ds){if(ds){cK=cK||(dq.inverted?dq.to:dq.from)}else{cK=null}}function bW(du,dt){var ds=cK&&bd(cK);if(ds){if(B(ds,du)){du=ds}else{if(B(dt,ds)){dt=ds}}}bU(du,dt);cw=true}function bU(dz,dy,ds,dx){cX=null;if(ds==null){ds=dq.from.line;dx=dq.to.line}if(R(dq.from,dz)&&R(dq.to,dy)){return}if(B(dy,dz)){var dv=dy;dy=dz;dz=dv}if(dz.line!=ds){var dw=ch(dz,ds,dq.from.ch);if(!dw){dd(dz.line,false)}else{dz=dw}}if(dy.line!=dx){dy=ch(dy,dx,dq.to.ch)}if(R(dz,dy)){dq.inverted=false}else{if(R(dz,dq.to)){dq.inverted=false}else{if(R(dy,dq.from)){dq.inverted=true}}}if(cq.autoClearEmptyLines&&R(dq.from,dq.to)){var du=dq.inverted?dz:dy;if(du.line!=dq.from.line&&dq.from.line<c1.size){var dt=c8(dq.from.line);if(/^\s+$/.test(dt.text)){setTimeout(aM(function(){if(dt.parent&&/^\s+$/.test(dt.text)){var dA=V(dt);cf("",{line:dA,ch:0},{line:dA,ch:dt.text.length})}},10))}}}dq.from=dz;dq.to=dy;a9=true}function ch(dx,dt,du){function dw(dA){var dC=dx.line+dA,dz=dA==1?c1.size:-1;while(dC!=dz){var dy=c8(dC);if(!dy.hidden){var dB=dx.ch;if(dv||dB>du||dB>dy.text.length){dB=dy.text.length}return{line:dC,ch:dB}}dC+=dA}}var ds=c8(dx.line);var dv=dx.ch==ds.text.length&&dx.ch!=du;if(!ds.hidden){return dx}if(dx.line>=dt){return dw(1)||dw(-1)}else{return dw(-1)||dw(1)}}function bs(ds,du,dt){var dv=bd({line:ds,ch:du||0});(dt?bW:bU)(dv,dv)}function co(ds){return Math.max(0,Math.min(ds,c1.size-1))}function bd(du){if(du.line<0){return{line:0,ch:0}}if(du.line>=c1.size){return{line:c1.size-1,ch:c8(c1.size-1).text.length}}var ds=du.ch,dt=c8(du.line).text.length;if(ds==null||ds>dt){return{line:du.line,ch:dt}}else{if(ds<0){return{line:du.line,ch:0}}else{return du}}}function cR(dv,dz){var dw=dq.inverted?dq.from:dq.to,dA=dw.line,ds=dw.ch;var dy=c8(dA);function dt(){for(var dB=dA+dv,dD=dv<0?-1:c1.size;dB!=dD;dB+=dv){var dC=c8(dB);if(!dC.hidden){dA=dB;dy=dC;return true}}}function dx(dB){if(ds==(dv<0?0:dy.text.length)){if(!dB&&dt()){ds=dv<0?dy.text.length:0}else{return false}}else{ds+=dv}return true}if(dz=="char"){dx()}else{if(dz=="column"){dx(true)}else{if(dz=="word"){var du=false;for(;;){if(dv<0){if(!dx()){break}}if(L(dy.text.charAt(ds))){du=true}else{if(du){if(dv<0){dv=1;dx()}break}}if(dv>0){if(!dx()){break}}}}}}return{line:dA,ch:ds}}function c7(ds,dt){var du=ds<0?dq.from:dq.to;if(cK||R(dq.from,dq.to)){du=cR(ds,dt)}bs(du.line,du.ch,true)}function cP(ds,dt){if(!R(dq.from,dq.to)){cf("",dq.from,dq.to)}else{if(ds<0){cf("",cR(ds,dt),dq.to)}else{cf("",dq.from,cR(ds,dt))}}cw=true}function c0(dt,dv){var dx=0,dy=dk(dq.inverted?dq.from:dq.to,true);if(cX!=null){dy.x=cX}if(dv=="page"){var ds=Math.min(bE.clientHeight,window.innerHeight||document.documentElement.clientHeight);var dw=b6(dy.x,dy.y+ds*dt)}else{if(dv=="line"){var du=ce();var dw=b6(dy.x,dy.y+0.5*du+dt*du)}}if(dv=="page"){a5.scrollTop+=dk(dw,true).y-dy.y}bs(dw.line,dw.ch,true);cX=dy.x}function bQ(dx){var dv=c8(dx.line).text;var dw=dx.ch,du=dx.ch;if(dv){if(dx.after===false||du==dv.length){--dw}else{++du}var dt=dv.charAt(dw);var ds=L(dt)?L:/\s/.test(dt)?function(dy){return/\s/.test(dy)}:function(dy){return !/\s/.test(dy)&&L(dy)};while(dw>0&&ds(dv.charAt(dw-1))){--dw}while(du<dv.length&&ds(dv.charAt(du))){++du}}return{from:{line:dx.line,ch:dw},to:{line:dx.line,ch:du}}}function a3(ds){bW({line:ds,ch:0},bd({line:ds+1,ch:0}))}function c3(du){if(R(dq.from,dq.to)){return bX(dq.from.line,du)}var dt=dq.to.line-(dq.to.ch?0:1);for(var ds=dq.from.line;ds<=dt;++ds){bX(ds,du)}}function bX(du,dB){if(!dB){dB="add"}if(dB=="smart"){if(!cE.indent){dB="prev"}else{var ds=cW(du)}}var dC=c8(du),dw=dC.indentation(cq.tabSize),dt=dC.text.match(/^\s*/)[0],dy;if(dB=="smart"){dy=cE.indent(ds,dC.text.slice(dt.length),dC.text);if(dy==ao){dB="prev"}}if(dB=="prev"){if(du){dy=c8(du-1).indentation(cq.tabSize)}else{dy=0}}else{if(dB=="add"){dy=dw+cq.indentUnit}else{if(dB=="subtract"){dy=dw-cq.indentUnit}}}dy=Math.max(0,dy);var dA=dy-dw;var dz="",dx=0;if(cq.indentWithTabs){for(var dv=Math.floor(dy/cq.tabSize);dv;--dv){dx+=cq.tabSize;dz+="\t"}}if(dx<dy){dz+=ax(dy-dx)}if(dz!=dt){cf(dz,{line:du,ch:0},{line:du,ch:dt.length})}dC.stateAfter=null}function cj(){cE=p.getMode(cq,cq.mode);c1.iter(0,c1.size,function(ds){ds.stateAfter=null});dc=0;b5(100)}function bz(){var ds=cq.gutter||cq.lineNumbers;a0.style.display=ds?"":"none";if(ds){bc=true}else{aL.parentNode.style.marginLeft=0}}function c9(du,dt){if(cq.lineWrapping){aY.className+=" CodeMirror-wrap";var ds=bE.clientWidth/bB()-3;c1.iter(0,c1.size,function(dv){if(dv.hidden){return}var dw=Math.ceil(dv.text.length/ds)||1;if(dw!=1){bo(dv,dw)}});bR.style.minWidth=br.style.left=""}else{aY.className=aY.className.replace(" CodeMirror-wrap","");bV();c1.iter(0,c1.size,function(dv){if(dv.height!=1&&!dv.hidden){bo(dv,1)}})}aW.push({from:0,to:c1.size})}function c5(){bE.className=bE.className.replace(/\s*cm-s-\S+/g,"")+cq.theme.replace(/(^|\s)\s*/g," cm-s-")}function cY(){var ds=f[cq.keyMap].style;aY.className=aY.className.replace(/\s*cm-keymap-\S+/g,"")+(ds?" cm-keymap-"+ds:"")}function dr(dt,ds){this.lines=[];this.type=dt;if(ds){this.style=ds}}dr.prototype.clear=aM(function(){var dv,ds;for(var du=0;du<this.lines.length;++du){var dt=this.lines[du];var dw=aF(dt.markedSpans,this);if(dw.from!=null){dv=V(dt)}if(dw.to!=null){ds=V(dt)}dt.markedSpans=aB(dt.markedSpans,dw)}if(dv!=null){aW.push({from:dv,to:ds+1})}this.lines.length=0;this.explicitlyCleared=true});dr.prototype.find=function(){var dx,dw;for(var dt=0;dt<this.lines.length;++dt){var ds=this.lines[dt];var du=aF(ds.markedSpans,this);if(du.from!=null||du.to!=null){var dv=V(ds);if(du.from!=null){dx={line:dv,ch:du.from}}if(du.to!=null){dw={line:dv,ch:du.to}}}}if(this.type=="bookmark"){return dx}return dx&&{from:dx,to:dw}};function b4(dy,dx,dw,du){dy=bd(dy);dx=bd(dx);var dt=new dr("range",dw);if(du){for(var dv in du){if(du.hasOwnProperty(dv)){dt[dv]=du[dv]}}}var ds=dy.line;c1.iter(ds,dx.line+1,function(dz){var dA={from:ds==dy.line?dy.ch:null,to:ds==dx.line?dx.ch:null,marker:dt};dz.markedSpans=(dz.markedSpans||[]).concat([dA]);dt.lines.push(dz);++ds});aW.push({from:dy.line,to:dx.line+1});return dt}function be(dv){dv=bd(dv);var dt=new dr("bookmark"),ds=c8(dv.line);bu.addChange(dv.line,1,[j(ds.text,ds.markedSpans)],true);var du={from:dv.ch,to:dv.ch,marker:dt};ds.markedSpans=(ds.markedSpans||[]).concat([du]);dt.lines.push(ds);return dt}function bI(dw){dw=bd(dw);var dv=[],dt=c8(dw.line).markedSpans;if(dt){for(var ds=0;ds<dt.length;++ds){var du=dt[ds];if((du.from==null||du.from<=dw.ch)&&(du.to==null||du.to>=dw.ch)){dv.push(du.marker)}}}return dv}function ck(ds,du,dt){if(typeof ds=="number"){ds=c8(co(ds))}ds.gutterMarker={text:du,style:dt};bc=true;return ds}function aP(ds){if(typeof ds=="number"){ds=c8(co(ds))}ds.gutterMarker=null;bc=true}function bh(dt,dv){var du=dt,ds=dt;if(typeof dt=="number"){ds=c8(co(dt))}else{du=V(dt)}if(du==null){return null}if(dv(ds,du)){aW.push({from:du,to:du+1})}else{return null}return ds}function bF(dt,ds,du){return bh(dt,function(dv){if(dv.className!=ds||dv.bgClassName!=du){dv.className=ds;dv.bgClassName=du;return true}})}function dd(dt,ds){return bh(dt,function(du,dx){if(du.hidden!=ds){du.hidden=ds;if(!cq.lineWrapping){if(ds&&du.text.length==b3.text.length){c6=true}else{if(!ds&&du.text.length>b3.text.length){b3=du;c6=false}}}bo(du,ds?0:1);var dw=dq.from.line,dv=dq.to.line;if(ds&&(dw==dx||dv==dx)){var dz=dw==dx?ch({line:dw,ch:0},dw,0):dq.from;var dy=dv==dx?ch({line:dv,ch:0},dv,0):dq.to;if(!dy){return}bU(dz,dy)}return(bc=true)}})}function bf(dt){if(typeof dt=="number"){if(!bN(dt)){return null}var du=dt;dt=c8(dt);if(!dt){return null}}else{var du=V(dt);if(du==null){return null}}var ds=dt.gutterMarker;return{line:du,handle:dt,text:dt.text,markerText:ds&&ds.text,markerClass:ds&&ds.style,lineClass:dt.className,bgClass:dt.bgClassName}}function cu(ds,dv){if(dv==0){return{top:0,left:0}}var dy=cb(ds,dv);q(aQ,dy);var du=dy.anchor;var dx=du.offsetTop,dw=du.offsetLeft;if(S&&dx==0&&dw==0){var dt=ai("span","x");du.parentNode.insertBefore(dt,du.nextSibling);dx=dt.offsetTop}return{top:dx,left:dw}}function dk(dx,dv){var ds,dt=ce(),dw=dt*(a(c1,dx.line)-(dv?by:0));if(dx.ch==0){ds=0}else{var du=cu(c8(dx.line),dx.ch);ds=du.left;if(cq.lineWrapping){dw+=Math.max(0,du.top)}}return{x:ds,y:dw,yBot:dw+dt}}function b6(dD,dC){var dA=ce(),dx=bB(),dJ=by+Math.floor(dC/dA);if(dJ<0){return{line:0,ch:0}}var dE=ad(c1,dJ);if(dE>=c1.size){return{line:c1.size-1,ch:c8(c1.size-1).text.length}}var dt=c8(dE),dG=dt.text;var dL=cq.lineWrapping,dB=dL?dJ-a(c1,dE):0;if(dD<=0&&dB==0){return{line:dE,ch:0}}var dy=false;function dK(dN){var dO=cu(dt,dN);if(dL){var dP=Math.round(dO.top/dA);dy=dP!=dB;return Math.max(0,dO.left+(dP-dB)*bE.clientWidth)}return dO.left}var dI=0,dH=0,du=dG.length,ds;var dF=Math.min(du,Math.ceil((dD+dB*bE.clientWidth*0.9)/dx));for(;;){var dz=dK(dF);if(dz<=dD&&dF<du){dF=Math.min(du,Math.ceil(dF*1.2))}else{ds=dz;du=dF;break}}if(dD>ds){return{line:dE,ch:du}}dF=Math.floor(du*0.8);dz=dK(dF);if(dz<dD){dI=dF;dH=dz}for(;;){if(du-dI<=1){var dw=dD-dH<ds-dD;return{line:dE,ch:dw?dI:du,after:dw}}var dM=Math.ceil((dI+du)/2),dv=dK(dM);if(dv>dD){du=dM;ds=dv;if(dy){ds+=1000}}else{dI=dM;dH=dv}}}function aJ(du){var ds=dk(du,true),dt=z(bR);return{x:dt.left+ds.x,y:dt.top+ds.y,yBot:dt.top+ds.yBot}}var bl,aS,aI;function ce(){if(aI==null){aI=ai("pre");for(var dt=0;dt<49;++dt){aI.appendChild(document.createTextNode("x"));aI.appendChild(ai("br"))}aI.appendChild(document.createTextNode("x"))}var ds=aL.clientHeight;if(ds==aS){return bl}aS=ds;q(aQ,aI.cloneNode(true));bl=aQ.firstChild.offsetHeight/50||1;aE(aQ);return bl}var dl,bS=0;function bB(){if(bE.clientWidth==bS){return dl}bS=bE.clientWidth;var ds=ai("span","x");var dt=ai("pre",[ds]);q(aQ,dt);return(dl=ds.offsetWidth||10)}function cU(){return bR.offsetTop}function bq(){return bR.offsetLeft}function bn(dw,dv){var du=z(bE,true),ds,dx;try{ds=dw.clientX;dx=dw.clientY}catch(dw){return null}if(!dv&&(ds-du.left>bE.clientWidth||dx-du.top>bE.clientHeight)){return null}var dt=z(bR,true);return b6(ds-dt.left,dx-dt.top)}var bM;function bm(dt){var dx=bn(dt),dw=a5.scrollTop;if(!dx||av){return}if(R(dq.from,dq.to)||B(dx,dq.from)||!B(dx,dq.to)){aM(bs)(dx.line,dx.ch)}var dv=bG.style.cssText;cm.style.position="absolute";bG.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(dt.clientY-5)+"px; left: "+(dt.clientX-5)+"px; z-index: 1000; background: white; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";bY();c4(true);if(R(dq.from,dq.to)){bG.value=bv=" "}function ds(){cm.style.position="relative";bG.style.cssText=dv;if(G){a5.scrollTop=dw}aG();if(bG.selectionStart!=null){clearTimeout(bM);var dz=bG.value=" "+(R(dq.from,dq.to)?"":bG.value),dy=0;bv=" ";bG.selectionStart=1;bG.selectionEnd=dz.length;bM=setTimeout(function dA(){if(bv==" "&&bG.selectionStart==0){aM(r.selectAll)(cC)}else{if(dy++<10){bM=setTimeout(dA,500)}else{c4()}}},200)}}if(v){ac(dt);var du=aC(window,"mouseup",function(){du();setTimeout(ds,20)},true)}else{setTimeout(ds,50)}}function df(){clearInterval(di);var ds=true;bx.style.visibility="";di=setInterval(function(){bx.style.visibility=(ds=!ds)?"":"hidden"},cq.cursorBlinkRate)}var bJ={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function cH(dy){var ds=dq.inverted?dq.from:dq.to,dA=c8(ds.line),dt=ds.ch-1;var dx=(dt>=0&&bJ[dA.text.charAt(dt)])||bJ[dA.text.charAt(++dt)];if(!dx){return}var dB=dx.charAt(0),dz=dx.charAt(1)==">",dL=dz?1:-1,dG=dA.styles;for(var dM=dt+1,dI=0,dK=dG.length;dI<dK;dI+=2){if((dM-=dG[dI].length)<=0){var dJ=dG[dI+1];break}}var dv=[dA.text.charAt(dt)],dF=/[(){}[\]]/;function dD(dY,dT,dU){if(!dY.text){return}var dX=dY.styles,dS=dz?0:dY.text.length-1,dV;for(var dP=dz?0:dX.length-2,dR=dz?dX.length:-2;dP!=dR;dP+=2*dL){var dW=dX[dP];if(dX[dP+1]!=dJ){dS+=dL*dW.length;continue}for(var dO=dz?0:dW.length-1,dN=dz?dW.length:-1;dO!=dN;dO+=dL,dS+=dL){if(dS>=dT&&dS<dU&&dF.test(dV=dW.charAt(dO))){var dQ=bJ[dV];if(dQ.charAt(1)==">"==dz){dv.push(dV)}else{if(dv.pop()!=dQ.charAt(0)){return{pos:dS,match:false}}else{if(!dv.length){return{pos:dS,match:true}}}}}}}}for(var dI=ds.line,dK=dz?Math.min(dI+100,c1.size):Math.max(-1,dI-100);dI!=dK;dI+=dL){var dA=c8(dI),dw=dI==ds.line;var dC=dD(dA,dw&&dz?dt+1:0,dw&&!dz?dt:dA.text.length);if(dC){break}}if(!dC){dC={pos:null,match:false}}var dJ=dC.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";var dH=b4({line:ds.line,ch:dt},{line:ds.line,ch:dt+1},dJ),du=dC.pos!=null&&b4({line:dI,ch:dC.pos},{line:dI,ch:dC.pos+1},dJ);var dE=aM(function(){dH.clear();du&&du.clear()});if(dy){setTimeout(dE,800)}else{ct=dE}}function bt(dy){var dx,du;for(var dt=dy,dv=dy-40;dt>dv;--dt){if(dt==0){return 0}var ds=c8(dt-1);if(ds.stateAfter){return dt}var dw=ds.indentation(cq.tabSize);if(du==null||dx>dw){du=dt-1;dx=dw}}return du}function cW(du){var dt=bt(du),ds=dt&&c8(dt-1).stateAfter;if(!ds){ds=t(cE)}else{ds=m(cE,ds)}c1.iter(dt,du,function(dv){dv.process(cE,ds,cq.tabSize);dv.stateAfter=(dt==du-1||dt%5==0)?m(cE,ds):null});return ds}function ci(){if(dc>=b9){return}var ds=+new Date+cq.workTime,du=m(cE,cW(dc));var dt=dc;c1.iter(dc,b9,function(dv){if(dc>=dj){dv.highlight(cE,du,cq.tabSize);dv.stateAfter=m(cE,du)}else{dv.process(cE,du,cq.tabSize);dv.stateAfter=dc%5==0?m(cE,du):null}++dc;if(+new Date>ds){b5(cq.workDelay);return true}});if(b9>dt&&dc>=dj){aM(function(){aW.push({from:dt,to:dc})})()}}function b5(ds){if(dc<b9){aR.set(ds,ci)}}function a7(){cS=cw=dg=null;aW=[];a9=false;c2=[]}function aT(){if(c6){bV()}if(bK&&!cq.lineWrapping){var ds=br.offsetWidth,dy=cu(b3,b3.text.length).left;if(!J){br.style.left=dy+"px";bR.style.minWidth=(dy+ds)+"px"}bK=false}var dw,dt;if(a9){var dx=cg();dw=bj(dx.x,dx.y,dx.x,dx.yBot)}if(aW.length||dw&&dw.scrollTop!=null){dt=cG(aW,true,dw&&dw.scrollTop)}if(!dt){if(a9){dp()}if(bc){a4()}}if(dw){cI()}if(a9){df()}if(cL&&(cS===true||(cS!==false&&a9))){c4(cw)}if(a9&&cq.matchBrackets){setTimeout(aM(function(){if(ct){ct();ct=null}if(R(dq.from,dq.to)){cH(false)}}),20)}var dz=a9,du=c2;if(dg&&cq.onChange&&cC){cq.onChange(cC,dg)}if(dz&&cq.onCursorActivity){cq.onCursorActivity(cC)}for(var dv=0;dv<du.length;++dv){du[dv](cC)}if(dt&&cq.onUpdate){cq.onUpdate(cC)}}var cT=0;function aM(ds){return function(){if(!cT++){a7()}try{var dt=ds.apply(this,arguments)}finally{if(!--cT){aT()}}return dt}}function cd(ds){bu.startCompound();try{return ds()}finally{bu.endCompound()}}for(var b7 in c){if(c.propertyIsEnumerable(b7)&&!cC.propertyIsEnumerable(b7)){cC[b7]=c[b7]}}for(var cv=0;cv<aw.length;++cv){aw[cv](cC)}return cC}p.defaults={value:"",mode:null,theme:"default",indentUnit:2,indentWithTabs:false,smartIndent:true,tabSize:4,keyMap:"default",extraKeys:null,electricChars:true,autoClearEmptyLines:false,onKeyEvent:null,onDragEvent:null,lineWrapping:false,lineNumbers:false,gutter:false,fixedGutter:false,firstLineNumber:1,readOnly:false,dragDrop:true,onChange:null,onCursorActivity:null,onViewportChange:null,onGutterClick:null,onUpdate:null,onFocus:null,onBlur:null,onScroll:null,matchBrackets:false,cursorBlinkRate:530,workTime:100,workDelay:200,pollInterval:100,undoDepth:40,tabindex:null,autofocus:null,lineNumberFormatter:function(aG){return aG}};var h=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent);var I=h||/Mac/.test(navigator.platform);var ae=/Win/.test(navigator.platform);var y=p.modes={},ak=p.mimeModes={};p.defineMode=function(aG,aI){if(!p.defaults.mode&&aG!="null"){p.defaults.mode=aG}if(arguments.length>2){aI.dependencies=[];for(var aH=2;aH<arguments.length;++aH){aI.dependencies.push(arguments[aH])}}y[aG]=aI};p.defineMIME=function(aH,aG){ak[aH]=aG};p.resolveMode=function(aG){if(typeof aG=="string"&&ak.hasOwnProperty(aG)){aG=ak[aG]}else{if(typeof aG=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(aG)){return p.resolveMode("application/xml")}}if(typeof aG=="string"){return{name:aG}}else{return aG||{name:"null"}}};p.getMode=function(aH,aG){var aG=p.resolveMode(aG);var aJ=y[aG.name];if(!aJ){return p.getMode(aH,"text/plain")}var aK=aJ(aH,aG);if(Z.hasOwnProperty(aG.name)){var aI=Z[aG.name];for(var aL in aI){if(aI.hasOwnProperty(aL)){aK[aL]=aI[aL]}}}aK.name=aG.name;return aK};p.listModes=function(){var aH=[];for(var aG in y){if(y.propertyIsEnumerable(aG)){aH.push(aG)}}return aH};p.listMIMEs=function(){var aH=[];for(var aG in ak){if(ak.propertyIsEnumerable(aG)){aH.push({mime:aG,mode:ak[aG]})}}return aH};var c=p.extensions={};p.defineExtension=function(aG,aH){c[aG]=aH};var aw=[];p.defineInitHook=function(aG){aw.push(aG)};var Z=p.modeExtensions={};p.extendMode=function(aI,aH){var aG=Z.hasOwnProperty(aI)?Z[aI]:(Z[aI]={});for(var aJ in aH){if(aH.hasOwnProperty(aJ)){aG[aJ]=aH[aJ]}}};var r=p.commands={selectAll:function(aG){aG.setSelection({line:0,ch:0},{line:aG.lineCount()-1})},killLine:function(aG){var aJ=aG.getCursor(true),aI=aG.getCursor(false),aH=!R(aJ,aI);if(!aH&&aG.getLine(aJ.line).length==aJ.ch){aG.replaceRange("",aJ,{line:aJ.line+1,ch:0})}else{aG.replaceRange("",aJ,aH?aI:{line:aJ.line})}},deleteLine:function(aG){var aH=aG.getCursor().line;aG.replaceRange("",{line:aH,ch:0},{line:aH})},undo:function(aG){aG.undo()},redo:function(aG){aG.redo()},goDocStart:function(aG){aG.setCursor(0,0,true)},goDocEnd:function(aG){aG.setSelection({line:aG.lineCount()-1},null,true)},goLineStart:function(aG){aG.setCursor(aG.getCursor().line,0,true)},goLineStartSmart:function(aG){var aJ=aG.getCursor();var aI=aG.getLine(aJ.line),aH=Math.max(0,aI.search(/\S/));aG.setCursor(aJ.line,aJ.ch<=aH&&aJ.ch?0:aH,true)},goLineEnd:function(aG){aG.setSelection({line:aG.getCursor().line},null,true)},goLineUp:function(aG){aG.moveV(-1,"line")},goLineDown:function(aG){aG.moveV(1,"line")},goPageUp:function(aG){aG.moveV(-1,"page")},goPageDown:function(aG){aG.moveV(1,"page")},goCharLeft:function(aG){aG.moveH(-1,"char")},goCharRight:function(aG){aG.moveH(1,"char")},goColumnLeft:function(aG){aG.moveH(-1,"column")},goColumnRight:function(aG){aG.moveH(1,"column")},goWordLeft:function(aG){aG.moveH(-1,"word")},goWordRight:function(aG){aG.moveH(1,"word")},delCharLeft:function(aG){aG.deleteH(-1,"char")},delCharRight:function(aG){aG.deleteH(1,"char")},delWordLeft:function(aG){aG.deleteH(-1,"word")},delWordRight:function(aG){aG.deleteH(1,"word")},indentAuto:function(aG){aG.indentSelection("smart")},indentMore:function(aG){aG.indentSelection("add")},indentLess:function(aG){aG.indentSelection("subtract")},insertTab:function(aG){aG.replaceSelection("\t","end")},defaultTab:function(aG){if(aG.somethingSelected()){aG.indentSelection("add")}else{aG.replaceSelection("\t","end")}},transposeChars:function(aG){var aI=aG.getCursor(),aH=aG.getLine(aI.line);if(aI.ch>0&&aI.ch<aH.length-1){aG.replaceRange(aH.charAt(aI.ch)+aH.charAt(aI.ch-1),{line:aI.line,ch:aI.ch-1},{line:aI.line,ch:aI.ch+1})}},newlineAndIndent:function(aG){aG.replaceSelection("\n","end");aG.indentLine(aG.getCursor().line)},toggleOverwrite:function(aG){aG.toggleOverwrite()}};var f=p.keyMap={};f.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharRight",Backspace:"delCharLeft",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"};f.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goWordLeft","Ctrl-Right":"goWordRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delWordLeft","Ctrl-Delete":"delWordRight","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"};f.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goWordLeft","Alt-Right":"goWordRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delWordLeft","Ctrl-Alt-Backspace":"delWordRight","Alt-Delete":"delWordRight","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore",fallthrough:["basic","emacsy"]};f["default"]=I?f.macDefault:f.pcDefault;f.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharRight","Ctrl-H":"delCharLeft","Alt-D":"delWordRight","Alt-Backspace":"delWordLeft","Ctrl-K":"killLine","Ctrl-T":"transposeChars"};function aq(aG){if(typeof aG=="string"){return f[aG]}else{return aG}}function at(aH,aG,aL,aJ,aI){function aK(aQ){aQ=aq(aQ);var aO=aQ[aH];if(aO===false){if(aI){aI()}return true}if(aO!=null&&aJ(aO)){return true}if(aQ.nofallthrough){if(aI){aI()}return true}var aN=aQ.fallthrough;if(aN==null){return false}if(Object.prototype.toString.call(aN)!="[object Array]"){return aK(aN)}for(var aM=0,aP=aN.length;aM<aP;++aM){if(aK(aN[aM])){return true}}return false}if(aG&&aK(aG)){return true}return aK(aL)}function ah(aH){var aG=u[ab(aH,"keyCode")];return aG=="Ctrl"||aG=="Alt"||aG=="Shift"||aG=="Mod"}p.isModifierKey=ah;p.fromTextArea=function(aM,aO){if(!aO){aO={}}aO.value=aM.value;if(!aO.tabindex&&aM.tabindex){aO.tabindex=aM.tabindex}if(aO.autofocus==null){var aG=document.body;try{aG=document.activeElement}catch(aI){}aO.autofocus=aG==aM||aM.getAttribute("autofocus")!=null&&aG==document.body}function aK(){aM.value=aN.getValue()}if(aM.form){var aH=aC(aM.form,"submit",aK,true);if(typeof aM.form.submit=="function"){var aL=aM.form.submit;aM.form.submit=function aJ(){aK();aM.form.submit=aL;aM.form.submit();aM.form.submit=aJ}}}aM.style.display="none";var aN=p(function(aP){aM.parentNode.insertBefore(aP,aM.nextSibling)},aO);aN.save=aK;aN.getTextArea=function(){return aM};aN.toTextArea=function(){aK();aM.parentNode.removeChild(aN.getWrapperElement());aM.style.display="";if(aM.form){aH();if(typeof aM.form.submit=="function"){aM.form.submit=aL}}};return aN};var v=/gecko\/\d{7}/i.test(navigator.userAgent);var S=/MSIE \d/.test(navigator.userAgent);var J=/MSIE [1-7]\b/.test(navigator.userAgent);var G=/MSIE [1-8]\b/.test(navigator.userAgent);var l=S&&document.documentMode==5;var k=/WebKit\//.test(navigator.userAgent);var n=/Chrome\//.test(navigator.userAgent);var av=/Opera\//.test(navigator.userAgent);var E=/Apple Computer/.test(navigator.vendor);var af=/KHTML\//.test(navigator.userAgent);var U=/Mac OS X 10\D([7-9]|\d\d)\D/.test(navigator.userAgent);function m(aJ,aG){if(aG===true){return aG}if(aJ.copyState){return aJ.copyState(aG)}var aI={};for(var aK in aG){var aH=aG[aK];if(aH instanceof Array){aH=aH.concat([])}aI[aK]=aH}return aI}p.copyState=m;function t(aI,aH,aG){return aI.startState?aI.startState(aH,aG):true}p.startState=t;p.innerMode=function(aI,aG){while(aI.innerMode){var aH=aI.innerMode(aG);aG=aH.state;aI=aH.mode}return aH||{mode:aI,state:aG}};function ag(aG,aH){this.pos=this.start=0;this.string=aG;this.tabSize=aH||8}ag.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==0},peek:function(){return this.string.charAt(this.pos)||undefined},next:function(){if(this.pos<this.string.length){return this.string.charAt(this.pos++)}},eat:function(aG){var aI=this.string.charAt(this.pos);if(typeof aG=="string"){var aH=aI==aG}else{var aH=aI&&(aG.test?aG.test(aI):aG(aI))}if(aH){++this.pos;return aI}},eatWhile:function(aG){var aH=this.pos;while(this.eat(aG)){}return this.pos>aH},eatSpace:function(){var aG=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos))){++this.pos}return this.pos>aG},skipToEnd:function(){this.pos=this.string.length},skipTo:function(aG){var aH=this.string.indexOf(aG,this.pos);if(aH>-1){this.pos=aH;return true}},backUp:function(aG){this.pos-=aG},column:function(){return an(this.string,this.start,this.tabSize)},indentation:function(){return an(this.string,null,this.tabSize)},match:function(aJ,aH,aG){if(typeof aJ=="string"){var aK=function(aL){return aG?aL.toLowerCase():aL};if(aK(this.string).indexOf(aK(aJ),this.pos)==this.pos){if(aH!==false){this.pos+=aJ.length}return true}}else{var aI=this.string.slice(this.pos).match(aJ);if(aI&&aI.index>0){return null}if(aI&&aH!==false){this.pos+=aI[0].length}return aI}},current:function(){return this.string.slice(this.start,this.pos)}};p.StringStream=ag;function X(aI,aH,aG){this.from=aI;this.to=aH;this.marker=aG}function aF(aI,aG){if(aI){for(var aH=0;aH<aI.length;++aH){var aJ=aI[aH];if(aJ.marker==aG){return aJ}}}}function aB(aH,aI){var aJ;for(var aG=0;aG<aH.length;++aG){if(aH[aG]!=aI){(aJ||(aJ=[])).push(aH[aG])}}return aJ}function T(aH,aI,aK){if(aH){for(var aL=0,aN;aL<aH.length;++aL){var aO=aH[aL],aM=aO.marker;var aG=aO.from==null||(aM.inclusiveLeft?aO.from<=aI:aO.from<aI);if(aG||aM.type=="bookmark"&&aO.from==aI&&aO.from!=aK){var aJ=aO.to==null||(aM.inclusiveRight?aO.to>=aI:aO.to>aI);(aN||(aN=[])).push({from:aO.from,to:aJ?null:aO.to,marker:aM})}}}return aN}function au(aI,aL){if(aI){for(var aK=0,aH;aK<aI.length;++aK){var aM=aI[aK],aG=aM.marker;var aN=aM.to==null||(aG.inclusiveRight?aM.to>=aL:aM.to>aL);if(aN||aG.type=="bookmark"&&aM.from==aL){var aJ=aM.from==null||(aG.inclusiveLeft?aM.from<=aL:aM.from<aL);(aH||(aH=[])).push({from:aJ?null:aM.from-aL,to:aM.to==null?null:aM.to-aL,marker:aG})}}}return aH}function W(aO,aT,aH,aK,aN){if(!aO&&!aT){return aN}var aM=T(aO,aH);var aR=au(aT,aK);var aS=aN.length==1,aI=N(aN).length+(aS?aH:0);if(aM){for(var aJ=0;aJ<aM.length;++aJ){var aQ=aM[aJ];if(aQ.to==null){var aU=aF(aR,aQ.marker);if(!aU){aQ.to=aH}else{if(aS){aQ.to=aU.to==null?null:aU.to+aI}}}}}if(aR){for(var aJ=0;aJ<aR.length;++aJ){var aQ=aR[aJ];if(aQ.to!=null){aQ.to+=aI}if(aQ.from==null){var aU=aF(aM,aQ.marker);if(!aU){aQ.from=aI;if(aS){(aM||(aM=[])).push(aQ)}}}else{aQ.from+=aI;if(aS){(aM||(aM=[])).push(aQ)}}}}var aL=[j(aN[0],aM)];if(!aS){var aP=aN.length-2,aG;if(aP>0&&aM){for(var aJ=0;aJ<aM.length;++aJ){if(aM[aJ].to==null){(aG||(aG=[])).push({from:null,to:null,marker:aM[aJ].marker})}}}for(var aJ=0;aJ<aP;++aJ){aL.push(j(aN[aJ+1],aG))}aL.push(j(N(aN),aR))}return aL}function ar(aG){return typeof aG=="string"?aG:aG.text}function d(aJ){if(typeof aJ=="string"){return null}var aI=aJ.markedSpans,aG=null;for(var aH=0;aH<aI.length;++aH){if(aI[aH].marker.explicitlyCleared){if(!aG){aG=aI.slice(0,aH)}}else{if(aG){aG.push(aI[aH])}}}return !aG?aI:aG.length?aG:null}function j(aH,aG){return aG?{text:aH,markedSpans:aG}:aH}function ay(aI){var aK=aI.markedSpans;if(!aK){return}for(var aJ=0;aJ<aK.length;++aJ){var aH=aK[aJ].marker.lines;var aG=s(aH,aI);aH.splice(aG,1)}aI.markedSpans=null}function aA(aH,aJ){if(!aJ){return}for(var aI=0;aI<aJ.length;++aI){var aG=aJ[aI].marker.lines.push(aH)}aH.markedSpans=aJ}var am=" ";if(v||(S&&!J)){am="\u200b"}else{if(av){am=""}}function H(aH,aG){this.text=aH;this.height=1;aA(this,aG)}H.prototype={update:function(aH,aG){this.text=aH;this.stateAfter=this.styles=null;ay(this);aA(this,aG)},highlight:function(aM,aJ,aK){var aL=new ag(this.text,aK),aG=this.styles||(this.styles=[]);var aN=aG.length=0;if(this.text==""&&aM.blankLine){aM.blankLine(aJ)}while(!aL.eol()){var aH=aM.token(aL,aJ),aI=aL.current();aL.start=aL.pos;if(aN&&aG[aN-1]==aH){aG[aN-2]+=aI}else{if(aI){aG[aN++]=aI;aG[aN++]=aH}}if(aL.pos>5000){aG[aN++]=this.text.slice(aL.pos);aG[aN++]=null;break}}},process:function(aJ,aG,aH){var aI=new ag(this.text,aH);if(this.text==""&&aJ.blankLine){aJ.blankLine(aG)}while(!aI.eol()&&aI.pos<=5000){aJ.token(aI,aG);aI.start=aI.pos}},getTokenAt:function(aM,aJ,aK,aI){var aG=this.text,aL=new ag(aG,aK);while(aL.pos<aI&&!aL.eol()){aL.start=aL.pos;var aH=aM.token(aL,aJ)}return{start:aL.start,end:aL.pos,string:aL.current(),className:aH||null,state:aJ}},indentation:function(aG){return an(this.text,null,aG)},getContent:function(aV,aG,aR){var aM=true,aK=0,a2=/[\t\u0000-\u0019\u200b\u2028\u2029\uFEFF]/g;var aU=ai("pre");function a3(bh,bm,be){if(!bm){return}if(aM&&S&&bm.charAt(0)==" "){bm="\u00a0"+bm.slice(1)}aM=false;if(!a2.test(bm)){aK+=bm.length;var bi=document.createTextNode(bm)}else{var bi=document.createDocumentFragment(),bk=0;while(true){a2.lastIndex=bk;var bf=a2.exec(bm);var bj=bf?bf.index-bk:bm.length-bk;if(bj){bi.appendChild(document.createTextNode(bm.slice(bk,bk+bj)));aK+=bj}if(!bf){break}bk+=bj+1;if(bf[0]=="\t"){var bl=aV-aK%aV;bi.appendChild(ai("span",ax(bl),"cm-tab"));aK+=bl}else{var bg=ai("span","\u2022","cm-invalidchar");bg.title="\\u"+bf[0].charCodeAt(0).toString(16);bi.appendChild(bg);aK+=1}}}if(be){bh.appendChild(ai("span",[bi],be))}else{bh.appendChild(bi)}}var a6=a3;if(aG!=null){var a0=0,aN=aU.anchor=ai("span");a6=function(bg,bj,bh){var bf=bj.length;if(aG>=a0&&aG<a0+bf){var bi=aG-a0;if(bi){a3(bg,bj.slice(0,bi),bh);if(aR){var be=bj.slice(bi-1,bi+1);if(F.test(be)){bg.appendChild(ai("wbr"))}else{if(!J&&/\w\w/.test(be)){bg.appendChild(document.createTextNode("\u200d"))}}}}bg.appendChild(aN);a3(aN,av?bj.slice(bi,bi+1):bj.slice(bi),bh);if(av){a3(bg,bj.slice(bi+1),bh)}aG--;a0+=bf}else{a0+=bf;a3(bg,bj,bh);if(a0==aG&&a0==ba){w(aN,am);bg.appendChild(aN)}else{if(a0>aG+10&&/\s/.test(bj)){a6=function(){}}}}}}var aZ=this.styles,aO=this.text,aW=this.markedSpans;var ba=aO.length;function aJ(be){if(!be){return null}return"cm-"+be.replace(/ +/g," cm-")}if(!aO&&aG==null){a6(aU," ")}else{if(!aW||!aW.length){for(var a7=0,aQ=0;aQ<ba;a7+=2){var aY=aZ[a7],a9=aZ[a7+1],a1=aY.length;if(aQ+a1>ba){aY=aY.slice(0,ba-aQ)}aQ+=a1;a6(aU,aY,aJ(a9))}}else{aW.sort(function(bf,be){return bf.from-be.from});var aL=0,a7=0,aT="",a9,bd=0;var bc=aW[0].from||0,a5=[],bb=0;var a8=function(){var be;while(bb<aW.length&&((be=aW[bb]).from==aL||be.from==null)){if(be.marker.type=="range"){a5.push(be)}++bb}bc=bb<aW.length?aW[bb].from:Infinity;for(var bf=0;bf<a5.length;++bf){var bg=a5[bf].to;if(bg==null){bg=Infinity}if(bg==aL){a5.splice(bf--,1)}else{bc=Math.min(bg,bc)}}};var aX=0;while(aL<ba){if(bc==aL){a8()}var aS=Math.min(ba,bc);while(true){if(aT){var aI=aL+aT.length;var aH=a9;for(var a4=0;a4<a5.length;++a4){var aP=a5[a4];aH=(aH?aH+" ":"")+aP.marker.style;if(aP.marker.endStyle&&aP.to===Math.min(aI,aS)){aH+=" "+aP.marker.endStyle}if(aP.marker.startStyle&&aP.from===aL){aH+=" "+aP.marker.startStyle}}a6(aU,aI>aS?aT.slice(0,aS-aL):aT,aH);if(aI>=aS){aT=aT.slice(aS-aL);aL=aS;break}aL=aI}aT=aZ[a7++];a9=aJ(aZ[a7++])}}}}return aU},cleanUp:function(){this.parent=null;ay(this)}};function O(aH){this.lines=aH;this.parent=null;for(var aI=0,aJ=aH.length,aG=0;aI<aJ;++aI){aH[aI].parent=this;aG+=aH[aI].height}this.height=aG}O.prototype={chunkSize:function(){return this.lines.length},remove:function(aG,aM,aK){for(var aJ=aG,aL=aG+aM;aJ<aL;++aJ){var aH=this.lines[aJ];this.height-=aH.height;aH.cleanUp();if(aH.handlers){for(var aI=0;aI<aH.handlers.length;++aI){aK.push(aH.handlers[aI])}}}this.lines.splice(aG,aM)},collapse:function(aG){aG.splice.apply(aG,[aG.length,0].concat(this.lines))},insertHeight:function(aH,aI,aG){this.height+=aG;this.lines=this.lines.slice(0,aH).concat(aI).concat(this.lines.slice(aH));for(var aJ=0,aK=aI.length;aJ<aK;++aJ){aI[aJ].parent=this}},iterN:function(aG,aJ,aI){for(var aH=aG+aJ;aG<aH;++aG){if(aI(this.lines[aG])){return true}}}};function aj(aJ){this.children=aJ;var aI=0,aG=0;for(var aH=0,aL=aJ.length;aH<aL;++aH){var aK=aJ[aH];aI+=aK.chunkSize();aG+=aK.height;aK.parent=this}this.size=aI;this.height=aG;this.parent=null}aj.prototype={chunkSize:function(){return this.size},remove:function(aI,aH,aL){this.size-=aH;for(var aJ=0;aJ<this.children.length;++aJ){var aG=this.children[aJ],aM=aG.chunkSize();if(aI<aM){var aK=Math.min(aH,aM-aI),aN=aG.height;aG.remove(aI,aK,aL);this.height-=aN-aG.height;if(aM==aK){this.children.splice(aJ--,1);aG.parent=null}if((aH-=aK)==0){break}aI=0}else{aI-=aM}}if(this.size-aH<25){var aO=[];this.collapse(aO);this.children=[new O(aO)];this.children[0].parent=this}},collapse:function(aG){for(var aH=0,aI=this.children.length;aH<aI;++aH){this.children[aH].collapse(aG)}},insert:function(aH,aI){var aG=0;for(var aJ=0,aK=aI.length;aJ<aK;++aJ){aG+=aI[aJ].height}this.insertHeight(aH,aI,aG)},insertHeight:function(aH,aO,aN){this.size+=aO.length;this.height+=aN;for(var aI=0,aK=this.children.length;aI<aK;++aI){var aG=this.children[aI],aL=aG.chunkSize();if(aH<=aL){aG.insertHeight(aH,aO,aN);if(aG.lines&&aG.lines.length>50){while(aG.lines.length>50){var aJ=aG.lines.splice(aG.lines.length-25,25);var aM=new O(aJ);aG.height-=aM.height;this.children.splice(aI+1,0,aM);aM.parent=this}this.maybeSpill()}break}aH-=aL}},maybeSpill:function(){if(this.children.length<=10){return}var aJ=this;do{var aH=aJ.children.splice(aJ.children.length-5,5);var aI=new aj(aH);if(!aJ.parent){var aK=new aj(aJ.children);aK.parent=aJ;aJ.children=[aK,aI];aJ=aK}else{aJ.size-=aI.size;aJ.height-=aI.height;var aG=s(aJ.parent.children,aJ);aJ.parent.children.splice(aG+1,0,aI)}aI.parent=aJ.parent}while(aJ.children.length>10);aJ.parent.maybeSpill()},iter:function(aI,aH,aG){this.iterN(aI,aH-aI,aG)},iterN:function(aG,aN,aM){for(var aH=0,aK=this.children.length;aH<aK;++aH){var aL=this.children[aH],aJ=aL.chunkSize();if(aG<aJ){var aI=Math.min(aN,aJ-aG);if(aL.iterN(aG,aI,aM)){return true}if((aN-=aI)==0){break}aG=0}else{aG-=aJ}}}};function K(aG,aK){while(!aG.lines){for(var aH=0;;++aH){var aJ=aG.children[aH],aI=aJ.chunkSize();if(aK<aI){aG=aJ;break}aK-=aI}}return aG.lines[aK]}function V(aG){if(aG.parent==null){return null}var aL=aG.parent,aK=s(aL.lines,aG);for(var aH=aL.parent;aH;aL=aH,aH=aH.parent){for(var aI=0,aJ=aH.children.length;;++aI){if(aH.children[aI]==aL){break}aK+=aH.children[aI].chunkSize()}}return aK}function ad(aM,aK){var aI=0;outer:do{for(var aJ=0,aL=aM.children.length;aJ<aL;++aJ){var aH=aM.children[aJ],aG=aH.height;if(aK<aG){aM=aH;continue outer}aK-=aG;aI+=aH.chunkSize()}return aI}while(!aM.lines);for(var aJ=0,aL=aM.lines.length;aJ<aL;++aJ){var aO=aM.lines[aJ],aN=aO.height;if(aK<aN){break}aK-=aN}return aI+aJ}function a(aG,aM){var aI=0;outer:do{for(var aH=0,aK=aG.children.length;aH<aK;++aH){var aL=aG.children[aH],aJ=aL.chunkSize();if(aM<aJ){aG=aL;continue outer}aM-=aJ;aI+=aL.height}return aI}while(!aG.lines);for(var aH=0;aH<aM;++aH){aI+=aG.lines[aH].height}return aI}function D(){this.time=0;this.done=[];this.undone=[];this.compound=0;this.closed=false}D.prototype={addChange:function(aG,aL,aH){this.undone.length=0;var aI=+new Date,aN=N(this.done),aO=aN&&N(aN);var aK=aI-this.time;if(aN&&!this.closed&&this.compound){aN.push({start:aG,added:aL,old:aH})}else{if(aK>400||!aO||this.closed||aO.start>aG+aH.length||aO.start+aO.added<aG){this.done.push([{start:aG,added:aL,old:aH}]);this.closed=false}else{var aM=Math.max(0,aO.start-aG),aP=Math.max(0,(aG+aH.length)-(aO.start+aO.added));for(var aJ=aM;aJ>0;--aJ){aO.old.unshift(aH[aJ-1])}for(var aJ=aP;aJ>0;--aJ){aO.old.push(aH[aH.length-aJ])}if(aM){aO.start=aG}aO.added+=aL-(aH.length-aM-aP)}}this.time=aI},startCompound:function(){if(!this.compound++){this.closed=true}},endCompound:function(){if(!--this.compound){this.closed=true}}};function x(){ac(this)}function P(aG){if(!aG.stop){aG.stop=x}return aG}function e(aG){if(aG.preventDefault){aG.preventDefault()}else{aG.returnValue=false}}function o(aG){if(aG.stopPropagation){aG.stopPropagation()}else{aG.cancelBubble=true}}function ac(aG){e(aG);o(aG)}p.e_stop=ac;p.e_preventDefault=e;p.e_stopPropagation=o;function ap(aG){return aG.target||aG.srcElement}function C(aH){var aG=aH.which;if(aG==null){if(aH.button&1){aG=1}else{if(aH.button&2){aG=3}else{if(aH.button&4){aG=2}}}}if(I&&aH.ctrlKey&&aG==1){aG=3}return aG}function ab(aH,aI){var aG=aH.override&&aH.override.hasOwnProperty(aI);return aG?aH.override[aI]:aH[aI]}function aC(aJ,aI,aH,aG){if(typeof aJ.addEventListener=="function"){aJ.addEventListener(aI,aH,false);if(aG){return function(){aJ.removeEventListener(aI,aH,false)}}}else{var aK=function(aL){aH(aL||window.event)};aJ.attachEvent("on"+aI,aK);if(aG){return function(){aJ.detachEvent("on"+aI,aK)}}}}p.connect=aC;function i(){this.id=null}i.prototype={set:function(aG,aH){clearTimeout(this.id);this.id=setTimeout(aH,aG)}};var ao=p.Pass={toString:function(){return"CodeMirror.Pass"}};var aa=function(){if(G){return false}var aG=ai("div");return"draggable" in aG||"dragDrop" in aG}();var Q=function(){var aG=ai("textarea");aG.value="foo\nbar";if(aG.value.indexOf("\r")>-1){return"\r\n"}return"\n"}();var F=/^$/;if(v){F=/$'/}else{if(E){F=/\-[^ \-?]|\?[^ !'\"\),.\-\/:;\?\]\}]/}else{if(n){F=/\-[^ \-\.?]|\?[^ \-\.?\]\}:;!'\"\),\/]|[\.!\"#&%\)*+,:;=>\]|\}~][\(\{\[<]|\$'/}}}function an(aH,aG,aJ){if(aG==null){aG=aH.search(/[^\s\u00a0]/);if(aG==-1){aG=aH.length}}for(var aI=0,aK=0;aI<aG;++aI){if(aH.charAt(aI)=="\t"){aK+=aJ-(aK%aJ)}else{++aK}}return aK}function z(aJ,aG){try{var aI=aJ.getBoundingClientRect();aI={top:aI.top,left:aI.left}}catch(aK){aI={top:0,left:0}}if(!aG){if(window.pageYOffset==null){var aH=document.documentElement||document.body.parentNode;if(aH.scrollTop==null){aH=document.body}aI.top+=aH.scrollTop;aI.left+=aH.scrollLeft}else{aI.top+=window.pageYOffset;aI.left+=window.pageXOffset}}return aI}function az(aG){return aG.textContent||aG.innerText||aG.nodeValue||""}var al=[""];function ax(aG){while(al.length<=aG){al.push(N(al)+" ")}return al[aG]}function N(aG){return aG[aG.length-1]}function aD(aG){if(h){aG.selectionStart=0;aG.selectionEnd=aG.value.length}else{aG.select()}}function R(aH,aG){return aH.line==aG.line&&aH.ch==aG.ch}function B(aH,aG){return aH.line<aG.line||(aH.line==aG.line&&aH.ch<aG.ch)}function Y(aG){return{line:aG.line,ch:aG.ch}}function ai(aG,aK,aJ,aI){var aL=document.createElement(aG);if(aJ){aL.className=aJ}if(aI){aL.style.cssText=aI}if(typeof aK=="string"){w(aL,aK)}else{if(aK){for(var aH=0;aH<aK.length;++aH){aL.appendChild(aK[aH])}}}return aL}function aE(aG){aG.innerHTML="";return aG}function q(aG,aH){aE(aG).appendChild(aH)}function w(aG,aH){if(G){aG.innerHTML="";aG.appendChild(document.createTextNode(aH))}else{aG.textContent=aH}}function A(aJ,aI){if(!aI){return 0}if(!aJ){return aI.length}for(var aH=aJ.length,aG=aI.length;aH>=0&&aG>=0;--aH,--aG){if(aJ.charAt(aH)!=aI.charAt(aG)){break}}return aG+1}function s(aJ,aG){if(aJ.indexOf){return aJ.indexOf(aG)}for(var aH=0,aI=aJ.length;aH<aI;++aH){if(aJ[aH]==aG){return aH}}return -1}var M=/[\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc]/;function L(aG){return/\w/.test(aG)||aG>"\x80"&&(aG.toUpperCase()!=aG.toLowerCase()||M.test(aG))}var g="\n\nb".split(/\n/).length!=3?function(aL){var aM=0,aG=[],aK=aL.length;while(aM<=aK){var aJ=aL.indexOf("\n",aM);if(aJ==-1){aJ=aL.length}var aI=aL.slice(aM,aL.charAt(aJ-1)=="\r"?aJ-1:aJ);var aH=aI.indexOf("\r");if(aH!=-1){aG.push(aI.slice(0,aH));aM+=aH+1}else{aG.push(aI);aM=aJ+1}}return aG}:function(aG){return aG.split(/\r\n?|\n/)};p.splitLines=g;var b=window.getSelection?function(aH){try{return aH.selectionStart!=aH.selectionEnd}catch(aG){return false}}:function(aI){try{var aG=aI.ownerDocument.selection.createRange()}catch(aH){}if(!aG||aG.parentElement()!=aI){return false}return aG.compareEndPoints("StartToEnd",aG)!=0};p.defineMode("null",function(){return{token:function(aG){aG.skipToEnd()}}});p.defineMIME("text/plain","null");var u={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};p.keyNames=u;(function(){for(var aG=0;aG<10;aG++){u[aG+48]=String(aG)}for(var aG=65;aG<=90;aG++){u[aG]=String.fromCharCode(aG)}for(var aG=1;aG<=12;aG++){u[aG+111]=u[aG+63235]="F"+aG}})();p.version="2.35 +";return p})();(function(){CodeMirror.simpleHint=function(e,b,a){var c={},g=CodeMirror.simpleHint.defaults;for(var d in g){if(g.hasOwnProperty(d)){c[d]=(a&&a.hasOwnProperty(d)?a:g)[d]}}function f(r){if(e.somethingSelected()){return}var o=e.getTokenAt(e.getCursor());if(c.closeOnTokenChange&&r!=null&&(o.start!=r.start||o.className!=r.className)){return}var v=b(e);if(!v||!v.list.length){return}var s=v.list;function t(i){e.replaceRange(i,v.from,v.to)}if(c.completeSingle&&s.length==1){t(s[0]);return true}var j=document.createElement("div");j.className="CodeMirror-completions";var k=j.appendChild(document.createElement("select"));if(!window.opera){k.multiple=true}for(var m=0;m<s.length;++m){var h=k.appendChild(document.createElement("option"));h.appendChild(document.createTextNode(s[m]))}k.firstChild.selected=true;k.size=Math.min(10,s.length);var q=c.alignWithWord?e.charCoords(v.from):e.cursorCoords();j.style.left=q.x+"px";j.style.top=q.yBot+"px";document.body.appendChild(j);var p=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);if(p-q.x<k.clientWidth){j.style.left=(q.x-k.clientWidth)+"px"}if(s.length<=10){j.style.width=(k.clientWidth-1)+"px"}var l=false;function u(){if(l){return}l=true;j.parentNode.removeChild(j)}function n(){t(s[k.selectedIndex]);u();setTimeout(function(){e.focus()},50)}CodeMirror.connect(k,"blur",u);CodeMirror.connect(k,"keydown",function(w){var i=w.keyCode;if(i==13){CodeMirror.e_stop(w);n()}else{if(i==27){CodeMirror.e_stop(w);u();e.focus()}else{if(i!=38&&i!=40&&i!=33&&i!=34&&!CodeMirror.isModifierKey(w)){u();e.focus();e.triggerOnKeyDown(w);if(!c.closeOnBackspace||i!=8){setTimeout(function(){f(o)},50)}}}}});CodeMirror.connect(k,"dblclick",n);k.focus();if(window.opera){setTimeout(function(){if(!l){k.focus()}},100)}return true}return f()};CodeMirror.simpleHint.defaults={closeOnBackspace:true,closeOnTokenChange:false,completeSingle:true,alignWithWord:true}})();(function(){CodeMirror.defaults.closeTagEnabled=true;CodeMirror.defaults.closeTagIndent=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];CodeMirror.defaults.closeTagVoid=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];function b(g,h){return CodeMirror.innerMode(g.getMode(),h).state}CodeMirror.defineExtension("closeTag",function(n,g,j,k){if(!n.getOption("closeTagEnabled")){throw CodeMirror.Pass}var m=n.getCursor();var p=n.getTokenAt(m);var h=b(n,p.state);if(h){if(g==">"){var l=h.type;if(p.className=="tag"&&l=="closeTag"){throw CodeMirror.Pass}n.replaceSelection(">");m={line:m.line,ch:m.ch+1};n.setCursor(m);p=n.getTokenAt(n.getCursor());h=b(n,p.state);if(!h){throw CodeMirror.Pass}var l=h.type;if(p.className=="tag"&&l!="selfcloseTag"){var i=h.tagName;if(i.length>0&&f(n,k,i)){a(n,j,m,i)}return}n.setSelection({line:m.line,ch:m.ch-1},m);n.replaceSelection("")}else{if(g=="/"){if(p.className=="tag"&&p.string=="<"){var o=h.context,i=o?o.tagName:"";if(i.length>0){c(n,m,i);return}}}}}throw CodeMirror.Pass});function a(h,g,j,i){if(d(h,g,i)){h.replaceSelection("\n\n</"+i+">","end");h.indentLine(j.line+1);h.indentLine(j.line+2);h.setCursor({line:j.line+1,ch:h.getLine(j.line+1).length})}else{h.replaceSelection("</"+i+">");h.setCursor(j)}}function d(h,g,i){if(typeof g=="undefined"||g==null||g==true){g=h.getOption("closeTagIndent")}if(!g){g=[]}return e(g,i.toLowerCase())!=-1}function f(g,h,i){if(g.getOption("mode")=="xml"){return true}if(typeof h=="undefined"||h==null){h=g.getOption("closeTagVoid")}if(!h){h=[]}return e(h,i.toLowerCase())==-1}function e(k,g){if(k.indexOf){return k.indexOf(g)}for(var h=0,j=k.length;h<j;++h){if(k[h]==g){return h}}return -1}function c(g,i,h){g.replaceSelection("/"+h+">");g.setCursor({line:i.line,ch:i.ch+h.length+2})}})();(function(){CodeMirror.xmlHints=[];CodeMirror.xmlHint=function(d,f){if(f.length>0){var e=d.getCursor();d.replaceSelection(f);e={line:e.line,ch:e.ch+1};d.setCursor(e)}CodeMirror.simpleHint(d,a)};CodeMirror.xmlSimpleHint=function(d){CodeMirror.simpleHint(d,a)};var a=function(d){var k=d.getCursor();if(k.ch>0){var j=d.getRange({line:0,ch:0},k);var h="";var l="";for(var e=j.length-1;e>=0;e--){if(j[e]==" "||j[e]=="<"){l=j[e];break}else{h=j[e]+h}}j=j.slice(0,j.length-h.length);var g=b(d,j)+l;var f=CodeMirror.xmlHints[g];if(typeof f==="undefined"){f=[""]}else{f=f.slice(0);for(var e=f.length-1;e>=0;e--){if(f[e].indexOf(h)!=0){f.splice(e,1)}}}return{list:f,from:{line:k.line,ch:k.ch-h.length},to:k}}};var b=function(g,l){var d="";if(l.length>=0){var j=new RegExp("<([^!?][^\\s/>]*).*?>","g");var f=[];var h;while((h=j.exec(l))!=null){f.push({tag:h[1],selfclose:(h[0].slice(h[0].length-2)==="/>")})}for(var e=f.length-1,k=0;e>=0;e--){var m=f[e];if(m.tag[0]=="/"){k++}else{if(m.selfclose==false){if(k>0){k--}else{d="<"+m.tag+">"+d}}}}d+=c(l)}return d};var c=function(g){var d=g.lastIndexOf("<");var f=g.lastIndexOf(">");if(f<d){g=g.slice(d);if(g!="<"){var e=g.indexOf(" ");if(e<0){e=g.indexOf("\t")}if(e<0){e=g.indexOf("\n")}if(e<0){e=g.length}return g.slice(0,e)}}return""}})();CodeMirror.defineMode("xml",function(y,k){var r=y.indentUnit;var x=k.htmlMode?{autoSelfClosers:{area:true,base:true,br:true,col:true,command:true,embed:true,frame:true,hr:true,img:true,input:true,keygen:true,link:true,meta:true,param:true,source:true,track:true,wbr:true},implicitlyClosed:{dd:true,li:true,optgroup:true,option:true,p:true,rp:true,rt:true,tbody:true,td:true,tfoot:true,th:true,tr:true},contextGrabbers:{dd:{dd:true,dt:true},dt:{dd:true,dt:true},li:{li:true},option:{option:true,optgroup:true},optgroup:{optgroup:true},p:{address:true,article:true,aside:true,blockquote:true,dir:true,div:true,dl:true,fieldset:true,footer:true,form:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,header:true,hgroup:true,hr:true,menu:true,nav:true,ol:true,p:true,pre:true,section:true,table:true,ul:true},rp:{rp:true,rt:true},rt:{rp:true,rt:true},tbody:{tbody:true,tfoot:true},td:{td:true,th:true},tfoot:{tbody:true},th:{td:true,th:true},thead:{tbody:true,tfoot:true},tr:{tr:true}},doNotIndent:{pre:true},allowUnquoted:true,allowMissing:true}:{autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:false,allowMissing:false};var a=k.alignCDATA;var f,g;function o(E,D){function B(G){D.tokenize=G;return G(E,D)}var C=E.next();if(C=="<"){if(E.eat("!")){if(E.eat("[")){if(E.match("CDATA[")){return B(w("atom","]]>"))}else{return null}}else{if(E.match("--")){return B(w("comment","-->"))}else{if(E.match("DOCTYPE",true,true)){E.eatWhile(/[\w\._\-]/);return B(z(1))}else{return null}}}}else{if(E.eat("?")){E.eatWhile(/[\w\._\-]/);D.tokenize=w("meta","?>");return"meta"}else{g=E.eat("/")?"closeTag":"openTag";E.eatSpace();f="";var F;while((F=E.eat(/[^\s\u00a0=<>\"\'\/?]/))){f+=F}D.tokenize=n;return"tag"}}}else{if(C=="&"){var A;if(E.eat("#")){if(E.eat("x")){A=E.eatWhile(/[a-fA-F\d]/)&&E.eat(";")}else{A=E.eatWhile(/[\d]/)&&E.eat(";")}}else{A=E.eatWhile(/[\w\.\-:]/)&&E.eat(";")}return A?"atom":"error"}else{E.eatWhile(/[^&<]/);return null}}}function n(C,B){var A=C.next();if(A==">"||(A=="/"&&C.eat(">"))){B.tokenize=o;g=A==">"?"endTag":"selfcloseTag";return"tag"}else{if(A=="="){g="equals";return null}else{if(/[\'\"]/.test(A)){B.tokenize=j(A);return B.tokenize(C,B)}else{C.eatWhile(/[^\s\u00a0=<>\"\']/);return"word"}}}}function j(A){return function(C,B){while(!C.eol()){if(C.next()==A){B.tokenize=n;break}}return"string"}}function w(B,A){return function(D,C){while(!D.eol()){if(D.match(A)){C.tokenize=o;break}D.next()}return B}}function z(A){return function(D,C){var B;while((B=D.next())!=null){if(B=="<"){C.tokenize=z(A+1);return C.tokenize(D,C)}else{if(B==">"){if(A==1){C.tokenize=o;break}else{C.tokenize=z(A-1);return C.tokenize(D,C)}}}}return"meta"}}var l,h;function b(){for(var A=arguments.length-1;A>=0;A--){l.cc.push(arguments[A])}}function e(){b.apply(null,arguments);return true}function i(A,C){var B=x.doNotIndent.hasOwnProperty(A)||(l.context&&l.context.noIndent);l.context={prev:l.context,tagName:A,indent:l.indented,startOfLine:C,noIndent:B}}function u(){if(l.context){l.context=l.context.prev}}function d(A){if(A=="openTag"){l.tagName=f;return e(m,c(l.startOfLine))}else{if(A=="closeTag"){var B=false;if(l.context){if(l.context.tagName!=f){if(x.implicitlyClosed.hasOwnProperty(l.context.tagName.toLowerCase())){u()}B=!l.context||l.context.tagName!=f}}else{B=true}if(B){h="error"}return e(s(B))}}return e()}function c(A){return function(B){if(B=="selfcloseTag"||(B=="endTag"&&x.autoSelfClosers.hasOwnProperty(l.tagName.toLowerCase()))){q(l.tagName.toLowerCase());return e()}if(B=="endTag"){q(l.tagName.toLowerCase());i(l.tagName,A);return e()}return e()}}function s(A){return function(B){if(A){h="error"}if(B=="endTag"){u();return e()}h="error";return e(arguments.callee)}}function q(B){var A;while(true){if(!l.context){return}A=l.context.tagName.toLowerCase();if(!x.contextGrabbers.hasOwnProperty(A)||!x.contextGrabbers[A].hasOwnProperty(B)){return}u()}}function m(A){if(A=="word"){h="attribute";return e(p,m)}if(A=="endTag"||A=="selfcloseTag"){return b()}h="error";return e(m)}function p(A){if(A=="equals"){return e(v,m)}if(!x.allowMissing){h="error"}else{if(A=="word"){h="attribute"}}return(A=="endTag"||A=="selfcloseTag")?b():e()}function v(A){if(A=="string"){return e(t)}if(A=="word"&&x.allowUnquoted){h="string";return e()}h="error";return(A=="endTag"||A=="selfCloseTag")?b():e()}function t(A){if(A=="string"){return e(t)}else{return b()}}return{startState:function(){return{tokenize:o,cc:[],indented:0,startOfLine:true,tagName:null,context:null}},token:function(D,C){if(D.sol()){C.startOfLine=true;C.indented=D.indentation()}if(D.eatSpace()){return null}h=g=f=null;var B=C.tokenize(D,C);C.type=g;if((B||g)&&B!="comment"){l=C;while(true){var A=C.cc.pop()||d;if(A(g||B)){break}}}C.startOfLine=false;return h||B},indent:function(D,A,C){var B=D.context;if((D.tokenize!=n&&D.tokenize!=o)||B&&B.noIndent){return C?C.match(/^(\s*)/)[0].length:0}if(a&&/<!\[CDATA\[/.test(A)){return 0}if(B&&/^<\//.test(A)){B=B.prev}while(B&&!B.startOfLine){B=B.prev}if(B){return B.indent+r}else{return 0}},electricChars:"/"}});CodeMirror.defineMIME("text/xml","xml");CodeMirror.defineMIME("application/xml","xml");if(!CodeMirror.mimeModes.hasOwnProperty("text/html")){CodeMirror.defineMIME("text/html",{name:"xml",htmlMode:true})}$(function(){AS.mixedContentElements={language:{tag:"language",attributes:[],exclude:["accessrestrict","accruals","acqinfo","altformavail","appraisal","arrangement","bibliography","bioghist","custodhist","fileplan","index","odd","otherfindaid","originalsloc","phystech","prefercite","processinfo","relatedmaterial","scopecontent","separatedmaterial","userestrict","dimensions","legalstatus","summary","edition","extent","note","inscription","physdesc","relatedmaterial","abstract","physloc","materialspec","physfacet"]},blockquote:{tag:"blockquote",attributes:[],exclude:["abstract","dimensions","legalstatus","langmaterial","materialspec","physdesc","physfacet","physloc"]},date:{tag:"date",attributes:["type","normal","calendar","era"],exclude:["abstract","accruals","appraisal","arrangement","note_index","note_bibliography","bioghist","accessrestrict","userestrict","custodhist","dimensions","altformavail","originalsloc","fileplan","odd","acqinfo","otherfindaid","phystech","prefercite","processinfo","relatedmaterial","scopecontent","separatedmaterial","langmaterial","materialspec","physloc"]},"function":{tag:"function",attributes:["rules","source"],exclude:["abstract","accruals","appraisal","arrangement","note_bibliography","bioghist","accessrestrict","userestrict","custodhist","dimensions","altformavail","originalsloc","fileplan","odd","acqinfo","legalstatus","otherfindaid","phystech","prefercite","processinfo","relatedmaterial","scopecontent","separatedmaterial","note_index","langmaterial","materialspec","physloc"]},occupation:{tag:"occupation",attributes:["type","normal","calendar","era"],exclude:["abstract","accruals","appraisal","arrangement","note_bibliography","bioghist","accessrestrict","userestrict","custodhist","dimensions","altformavail","originalsloc","fileplan","odd","acqinfo","legalstatus","otherfindaid","phystech","prefercite","processinfo","relatedmaterial","scopecontent","separatedmaterial","note_index","langmaterial","materialspec","physloc"]},subject:{tag:"subject",attributes:["type","normal","calendar","era"],exclude:["abstract","accruals","appraisal","arrangement","note_bibliography","bioghist","accessrestrict","userestrict","custodhist","dimensions","altformavail","originalsloc","fileplan","odd","acqinfo","legalstatus","otherfindaid","phystech","prefercite","processinfo","relatedmaterial","scopecontent","separatedmaterial","note_index","langmaterial","materialspec","physloc"]},emph:{tag:"emph",attributes:["render"],exclude:["langmaterial","abstract","accruals","appraisal","arrangement","note_bibliography","bioghist","accessrestrict","userestrict","custodhist","altformavail","originalsloc","fileplan","odd","acqinfo","otherfindaid","phystech","prefercite","processinfo","relatedmaterial","scopecontent","separatedmaterial","note_index"]},corpname:{tag:"corpname",attributes:["rules","role","source"],exclude:["abstract","accruals","acqinfo","appraisal","arrangement","note_bibliography","bioghist","accessrestrict","userestrict","custodhist","dimensions","altformavail","originalsloc","fileplan","odd","acqinfo","legalstatus","otherfindaid","phystech","prefercite","processinfo","relatedmaterial","scopecontent","separatedmaterial","note_index","langmaterial","materialspec","physloc"]},persname:{tag:"persname",attributes:["rules","role","source"],exclude:["abstract","accruals","appraisal","acqinfo","arrangement","note_bibliography","bioghist","accessrestrict","userestrict","custodhist","dimensions","altformavail","originalsloc","fileplan","odd","acqinfo","legalstatus","otherfindaid","phystech","prefercite","processinfo","relatedmaterial","scopecontent","separatedmaterial","note_index","langmaterial","materialspec","physloc"]},famname:{tag:"famname",attributes:["rules","role","source"],exclude:["abstract","accruals","appraisal","acqinfo","arrangement","note_bibliography","bioghist","accessrestrict","userestrict","custodhist","dimensions","altformavail","originalsloc","fileplan","odd","acqinfo","legalstatus","otherfindaid","phystech","prefercite","processinfo","relatedmaterial","scopecontent","separatedmaterial","note_index","langmaterial","materialspec","physloc"]},name:{tag:"name",attributes:["rules","role","source"],exclude:["abstract","accruals","acqinfo","appraisal","arrangement","note_bibliography","bioghist","accessrestrict","userestrict","custodhist","dimensions","altformavail","originalsloc","fileplan","odd","acqinfo","legalstatus","otherfindaid","phystech","prefercite","processinfo","relatedmaterial","scopecontent","separatedmaterial","note_index","langmaterial","materialspec","physloc"]},geogname:{tag:"geogname",attributes:["rules","role","source"],exclude:["abstract","accruals","appraisal","arrangement","note_bibliography","bioghist","accessrestrict","userestrict","custodhist","dimensions","altformavail","originalsloc","fileplan","odd","acqinfo","legalstatus","otherfindaid","phystech","prefercite","processinfo","relatedmaterial","scopecontent","separatedmaterial","note_index","langmaterial","materialspec","physloc"]},genreform:{tag:"genreform",attributes:["rules","role","type"],exclude:["abstract","accruals","appraisal","arrangement","note_bibliography","bioghist","accessrestrict","userestrict","custodhist","dimensions","altformavail","originalsloc","fileplan","odd","acqinfo","legalstatus","otherfindaid","phystech","prefercite","processinfo","relatedmaterial","scopecontent","separatedmaterial","note_index","langmaterial","materialspec","physloc"]},title:{tag:"title",attributes:["render","accruals"],exclude:["langmaterial","appraisal","accruals","arrangement","bioghist","accessrestrict","userestrict","custodhist","altformavail","originalsloc","fileplan","odd","acqinfo","legalstatus","phystech","prefercite","processinfo","scopecontent","note_index"]},ref:{tag:"ref",attributes:["target","show","title","actuate","href"],exclude:["langmaterial","accruals","appraisal","arrangement","bioghist","accessrestrict","userestrict","custodhist","altformavail","originalsloc","fileplan","odd","acqinfo","legalstatus","phystech","prefercite","processinfo","scopecontent","note_index"]},extref:{tag:"extref",attributes:["show","title","actuate","href"],exclude:["langmaterial","abstract","accruals","appraisal","arrangement","bioghist","accessrestrict","userestrict","custodhist","altformavail","originalsloc","fileplan","odd","acqinfo","legalstatus","phystech","prefercite","processinfo","scopecontent","separatedmaterial","note_index"]},}});$(function(){$.fn.mixedContent=function(){$(this).each(function(){var k=$(this);if(k.hasClass("initialised")){return}var h;var d=b(k);var j=a(d);var e=$(AS.renderTemplate("mixed_content_wrap_action_template",{tags:j}));var g=$("select",e);var i=CodeMirror.fromTextArea(k[0],{value:k.val(),onFocus:function(){d=b(k);j=a(d);c(j);g.empty();$.each(j,function(l,m){g.append("<option>"+l+"</option>")})},mode:"text/html",smartIndent:false,extraKeys:{"'>'":function(l){l.closeTag(l,">")},"'/'":function(l){l.closeTag(l,"/")},"' '":function(l){CodeMirror.xmlHint(l," ")},"'<'":function(l){CodeMirror.xmlHint(l,"<")},"Ctrl-Space":function(l){CodeMirror.xmlHint(l,"")}},lineWrapping:true,onCursorActivity:function(m){if(m.somethingSelected()){var p=i.cursorCoords(true,"local");var l=i.cursorCoords(false,"local");var o=e.height()-20+l.y;var n=Math.min(p.y==l.y?p.x:l.x,$(i.getWrapperElement()).width()-e.width());e.css("top",o+"px").css("left",n+"px").css("position","absolute");e.show()}else{g.val("");e.hide();i.save()}}});k.data("CodeMirror",i);k.addClass("initialised");var f=function(n){if(i.somethingSelected()&&g.val()!=""){var m=g.val();i.replaceSelection("<"+m+">"+i.getSelection()+"</"+m+">");var l=i.getCursor();i.setCursor({line:l.line,ch:i.getSelection()+l.ch});i.focus()}};e.bind("change",f);$(i.getWrapperElement()).append(e).append(AS.renderTemplate("mixed_content_help_template"))})};var b=function(e){var d=e.closest(".mixed-content-anchor > ul > li").find("[class$=-type]").map(function(){return this.value}).get();return d};var a=function(d){d=(typeof d==="undefined")?[]:d;whitelist={};if(AS.mixedContentElements){$.each(AS.mixedContentElements,function(e,g){var f=false;if(g.exclude){f=($(g.exclude).filter(d).length>0)}if(!f){whitelist[e]=g}})}return whitelist};var c=function(d){var e=function(j,f){CodeMirror.xmlHints[j]=[];for(var h=0;h<f.length;h++){var g=f[h];if(typeof g=="string"){g=AS.mixedContentElements[g]}CodeMirror.xmlHints[j].push(g.tag);CodeMirror.xmlHints[j+g.tag+" "]=g.attributes||[];if(g.elements){e(j+g.tag+"><",g.elements)}}};d=(typeof d==="undefined")?{}:d;if(d){CodeMirror.xmlHints["<"]=[];$.each(d,function(f,g){CodeMirror.xmlHints["<"].push(f);CodeMirror.xmlHints["<"+f+" "]=g.attributes||[];if(g.elements){e("<"+g.tag+"><",g.elements)}})}else{throw"No mixed content rules found: AS.mixedContentElements is null"}};c();$(document).bind("subrecordcreated.aspace",function(f,d,e){$("textarea.mixed-content:not(.initialised)",e).mixedContent()});$(document).bind("expandcontainer.aspace",function(d,e){$("textarea.mixed-content:not(.initialised)",e).mixedContent()})});AS.initSubRecordCollapsible=function(c,b){if(c.parents(".subrecord-form-fields").length>0){return}var d=function(){a.html(b())};var a=$("<div>").addClass("subrecord-summary-view");var f=$(".subrecord-form-container:first",c);var e=c.closest("li");$(".subrecord-form-remove",e).after(AS.renderTemplate("template_subrecord_collapse_action"));e.on("click",".collapse-subrecord-toggle",function(g){g.preventDefault();g.stopPropagation();if(!e.hasClass("collapsed")){d();f.hide();a.fadeIn()}else{f.slideDown("slow",function(){$(document).trigger("expandcontainer.aspace",f)});a.hide()}e.toggleClass("collapsed")}).on("click",".subrecord-summary-view",function(g){$(".collapse-subrecord-toggle",e).trigger("click")});if(c.find(".error:first").length>0||c.data("collapsed")===false){a.hide()}else{f.hide();e.addClass("collapsed")}d();c.append(a)};AS.initTooManySubRecords=function(b,d,c){if(d>4){var a=$(AS.renderTemplate("too_many_subrecords_template"));a.hide();b.append(a);a.fadeIn();$(".subrecord-form-container",b).hide();b.addClass("too-many");$(".subrecord-form-heading .btn",b).prop("disabled",true);$(b).on("click",function(e){e.preventDefault();b.children().andSelf().removeClass("too-many");a.html("<i class='spinner'></i>");$(".subrecord-form-heading .btn",b).prop("disabled",false);setTimeout(function(){c(function(){a.remove();$(".subrecord-form-container",b).fadeIn();$(document).trigger("loadedrecordsubforms.aspace",b)})},1000);b.unbind(e)});return true}else{return false}};$(document).ready(function(){function a(d){var c=d.data("type");if(c=="note_multipart"){var b=function(){var g=$(".note-type option:selected",d).val();var f=$("#notes_restriction",d);if(g=="accessrestrict"||g=="userestrict"){$(":input",f).removeAttr("disabled");f.show();var e=f.find("select[id*='_local_access_restriction_type_']");if(g=="accessrestrict"){e.removeAttr("disabled");e.closest(".control-group").show()}else{e.closest(".control-group").hide();e.attr("disabled","disabled")}}else{$(":input",f).attr("disabled","disabled");f.hide()}};$(".note-type",d).on("change",function(){b()});b()}}$(document).bind("subrecordcreated.aspace",function(b,d,c){if(d=="note"){a(c)}});$(document).bind("loadedrecordform.aspace",function(b,c){c.find("section.notes-form.subrecord-form .subrecord-form-fields").each(function(){a($(this))})});$("section.notes-form.subrecord-form .subrecord-form-fields").each(function(){a($(this))})});$(function(){$.fn.init_notes_form=function(){$(this).each(function(){var k=$(this);if(k.hasClass("initialised")||k.hasClass("too-many")){return}var j=$(".subrecord-form-fields",k).length;var g={};var f=function(t,s,q,p,r){$((p||".add-item-btn"),t).click(function(x){x.preventDefault();x.stopPropagation();var w=s;if(typeof(s)==="function"){w=s($(this))}var v=$(this).parent().hasClass("controls")?$(this).parent():$(this).closest(".subrecord-form");var u=$(".subrecord-form-list:first",v);var y=$(AS.renderTemplate(w,{path:AS.quickTemplate(u.data("name-path"),{index:j}),id_path:AS.quickTemplate(u.data("id-path"),{index:j}),index:"${index}"}));y=$("<li>").data("type",y.data("type")).append(y);y.attr("data-index",j);u.append(y);AS.initSubRecordSorting(u);if(r){r(y)}else{n(y,false)}if(q){$(document).triggerHandler("subrecordcreated.aspace",["note",y])}k.parents("form:first").triggerHandler("formchanged.aspace");$(":input:visible:first",y).focus();j++})};g.note_bibliography=function(p){f(p,"template_bib_item")};g.note_outline=function(p){f(p,"template_note_outline_level",true,".add-level-btn")};g.note_outline_level=function(p){f(p,"template_note_outline_string",true,".add-sub-item-btn");f(p,"template_note_outline_level",true,".add-sub-level-btn")};var e=function(p){$(".dropdown-menu.subrecord-selector li",p).click(function(q){if(!$(q.target).hasClass("btn")){q.stopPropagation()}})};e();var c=function(q){if(!q){q=$(document)}var p=$(".content-list",q);if(p.length>0){f(p,"template_content_item",true,".add-content-item-btn")}};var b=function(q){var p=$("<a href='javascript:void(0)' class='btn btn-default btn-xs pull-right subrecord-form-remove'><span class='glyphicon glyphicon-remove'></span></a>");q.prepend(p);p.on("click",function(){AS.confirmSubFormDelete($(this),function(){if(q.parent().hasClass("subrecord-form-wrapper")){q.parent().remove()}else{q.remove();if($(".subrecord-form-list:first",k).children("li").length<2){$(".subrecord-form-heading:first .btn.apply-note-order",k).attr("disabled","disabled")}}k.parents("form:first").triggerHandler("formchanged.aspace");$(document).triggerHandler("subrecorddeleted.aspace",[k])})})};g.note_index=function(p){f(p,"template_note_index_item")};g.note_chronology=function(p){f(p,"template_chronology_item",true)};g.note_definedlist=function(p){f(p,"template_definedlist_item")};g.note_orderedlist=function(p){f(p,"template_orderedlist_item")};g.chronology_item=function(p){f(p,"template_orderedlist_item",false,".add-event-btn")};g.note_multipart=function(q){var p=function(s){var r=$("select.multipart-note-type",s);r.change(i);b(s)};f(q,"template_note_multipart_selector",true,".add-sub-note-btn",p)};g.note_bioghist=function(q){var p=function(s){var r=$("select.bioghist-note-type",s);r.change(i);b(s)};f(q,"template_note_bioghist_selector",true,".add-sub-note-btn",p)};var a=function(u){if(!$.contains(document,u[0])){return}var q=function(v){if(v.length===0){return"&hellip;"}var w=$(v.get(0)).val();if(w.length<=200){return w+((v.length>1)?"<br/>&hellip;":"")}return $.trim(w).substring(0,200).split(" ").slice(0,-1).join(" ")+"&hellip;"};var s=function(){var v={type:$("#"+t+"_type_ :selected",u).text(),label:$("#"+t+"_label_",u).val(),jsonmodel_type:$("> .subrecord-form-heading:first",u).text(),summary:q($(":input[id*='_content_']",u))};return AS.renderTemplate("template_note_summary",v)};var r=u.closest(".subrecord-form-list").data("id-path");var p=u.closest("li").data("index");var t=AS.quickTemplate(r,{index:p});AS.initSubRecordCollapsible(u,s)};var n=function(s,p){if(s.hasClass("initialised")){return}s.addClass("initialised");if(!p){b(s)}e(s);var q=$("ul.subrecord-form-list:first",s);AS.initSubRecordSorting(q);var r=s.data("type");if(g[r]){g[r](s)}c(s);a(s)};var i=function(){var t=$(this).parents("[data-index]:first");var q=$(".selected-container",t);var p=t.parents(".subrecord-form-list:first");if($(this).val()===""){q.html(AS.renderTemplate("template_note_type_nil"));return}var r=$(AS.renderTemplate("template_"+$(this).val(),{path:AS.quickTemplate(p.data("name-path"),{index:t.data("index")}),id_path:AS.quickTemplate(p.data("id-path"),{index:t.data("index")}),index:"${index}"}));r.data("type");r.attr("data-index",t.data("index"));var s=$(".note-type option:contains('"+$(":selected",this).text()+"')",r);$(".note-type",r).val(s.val());n(r,true);q.html(r);$(":input:visible:first",r).focus();t.parents("form:first").triggerHandler("formchanged.aspace");$(document).triggerHandler("subrecordcreated.aspace",["note",r])};var m=function(q){q.preventDefault();q.stopPropagation();var p=$(".subrecord-form-list:first",k);$.ajax({url:APP_PATH+"notes/note_order",type:"GET",success:function(v){var t=p.children().detach();var s=_.sortBy(t,function(w){var x=$("select.note-type",$(w)).val();if(_.isUndefined(x)){if($("select.top-level-note-type",$(w)).length){x=$("select.top-level-note-type",$(w)).val().replace(/^note_/,"")}else{x=$(".subrecord-form-fields",$(w)).data("type").replace(/^note_/,"")}}return _.indexOf(v,x)});var u=_.map(t,function(w){return $(w).data("index")});var r=_.map(s,function(w){return $(w).data("index")});if(!_.isEqual(u,r)){$("form.aspace-record-form").triggerHandler("formchanged.aspace")}$(s).appendTo(p)},error:function(t,s,r){$container.html("<div class='alert alert-error'><p>An error occurred loading note order list.</p><pre>"+r+"</pre></div>")}})};var d=function(q){q.preventDefault();q.stopPropagation();var p=$(".subrecord-form-list:first",k);var t=k.hasClass("note-inline");if(t==true){var s=k.get(0).id;var r="template_"+s+"_note_type_selector_inline";var v=$(AS.renderTemplate(r))}else{var v=$(AS.renderTemplate("template_note_type_selector"))}v=$("<li>").data("type",v.data("type")).append(v);v.attr("data-index",j);p.append(v);AS.initSubRecordSorting(p);if(p.children("li").length>1){$(".subrecord-form-heading:first .btn.apply-note-order",k).removeAttr("disabled")}$(document).triggerHandler("subrecordcreated.aspace",["note",v]);$(":input:visible:first",v).focus();k.parents("form:first").triggerHandler("formchanged.aspace");b(v);var u=$("select.top-level-note-type",v);u.change(i);j++};$(".subrecord-form-heading:first .btn.add-note",k).click(d);$(".subrecord-form-heading:first .btn.apply-note-order",k).click(m);var l=$(".subrecord-form-list:first",k);if(l.children("li").length>1){$(".subrecord-form-heading:first .btn.apply-note-order",k).removeAttr("disabled")}var o=function(){$(".subrecord-form-inline",k).each(function(){b($(this))})};var h=function(q){var p=$("ul.subrecord-form-list:first",k);AS.initSubRecordSorting(p);AS.initAddAsYouGoActions(k,p);$(".subrecord-form-list > .subrecord-form-wrapper:visible > .subrecord-form-fields:not('.initialised')",q).each(function(){n($(this),false)});o()};$existingNotes=$(".subrecord-form-list:first > .subrecord-form-wrapper",k);tooManyNotes=AS.initTooManySubRecords(k,$existingNotes.length,h);if(tooManyNotes===false){k.addClass("initialised");h(k)}})};$(document).ready(function(){$(document).bind("loadedrecordform.aspace",function(a,b){$("section.notes-form.subrecord-form:not(.initialised)",b).init_notes_form()})})});$(function(){$.fn.init_subrecord_form=function(){$(this).each(function(){var a=$(this);if((a.hasClass("initialised")&&a.is(":visible"))||a.hasClass("too-many")){return}a.data("form_index",$("> .subrecord-form-container .subrecord-form-fields",a).length);var b=function(g){$(document).on("subrecordcreated.aspace",function(j,h,i){i.triggerHandler(j)});$(document).on("showall.aspace",function(j,h,i){i.triggerHandler(j)});var e=function(){var i=$(this);if(i.hasClass("initialised")){return}i.addClass("initialised");var h=function(){var j=$("<a href='javascript:void(0)' class='btn btn-default btn-xs pull-right subrecord-form-remove'><span class='glyphicon glyphicon-remove'></span></a>");i.prepend(j);j.on("click",function(){AS.confirmSubFormDelete($(this),function(){i.remove();if(a.data("cardinality")==="zero_to_one"){$("> .subrecord-form-heading > .btn",a).removeAttr("disabled")}a.parents("form:first").triggerHandler("formchanged.aspace");$(document).triggerHandler("subrecorddeleted.aspace",[a])});return false})};if(i.closest(".subrecord-form").data("remove")!="disabled"){h()}AS.initSubRecordSorting($("ul.subrecord-form-list",i));if(a.data("cardinality")==="zero_to_one"){$("> .subrecord-form-heading > .btn",a).attr("disabled","disabled")}$(document).triggerHandler("subrecordcreated.aspace",[i.data("object-name")||a.data("object-name"),i])};var d=function(j,h){var i=$("<li>").append(j);i.attr("data-index",a.data("form_index"));i.hide();h.append(i);i.fadeIn();AS.initSubRecordSorting(h);a.parents("form:first").triggerHandler("formchanged.aspace");$.proxy(e,i)();$(".subrecord-form:not(.initialised)",i).init_subrecord_form();$(":input:first",i).focus();a.data("form_index",a.data("form_index")+1)};if(a.data("custom-action")){$(a).on("click","> .subrecord-form-heading > .custom-action .btn:not(.show-all)",function(j){j.preventDefault();var i=$(".subrecord-form-list:first",$(this).parents(".subrecord-form:first"));var h={path:AS.quickTemplate(i.data("name-path"),{index:a.data("form_index")}),id_path:AS.quickTemplate(i.data("id-path"),{index:a.data("form_index")}),index:"${index}"};$(document).triggerHandler("subrecordcreaterequest.aspace",[a.data("object-name"),$(this).data(),h,i,d])});g()}else{$(a).on("click","> .subrecord-form-heading > .btn:not(.show-all)",function(k){k.preventDefault();var i=$(".subrecord-form-list:first",$(this).parents(".subrecord-form:first"));var h={path:AS.quickTemplate(i.data("name-path"),{index:a.data("form_index")}),id_path:AS.quickTemplate(i.data("id-path"),{index:a.data("form_index")}),index:"${index}"};var j=$(AS.renderTemplate(a.data("template"),h));d(j,i)});g()}var f=$("ul.subrecord-form-list:first",a);AS.initAddAsYouGoActions(a,f);AS.initSubRecordSorting(f);$("> .subrecord-form-container > .subrecord-form-list > .subrecord-form-wrapper:not(.initialised):visible",a).each(e)};var c=function(){return $(".subrecord-form-list:first > li",a).length};tooManyRecords=AS.initTooManySubRecords(a,c(),b);if(tooManyRecords===false){a.addClass("initialised");b(function(){$(document).trigger("loadedrecordsubforms.aspace",a)})}})};$(document).ready(function(){$(document).bind("loadedrecordform.aspace",function(a,b){$("#basic_information:not(.initialised)",b).init_subrecord_form();$(".subrecord-form[data-subrecord-form]:not(.initialised)",b).init_subrecord_form()});$(".subrecord-form[data-subrecord-form]:not(.initialised)").init_subrecord_form();$(document).on("subrecordmonkeypatch.aspace",function(b,a){$(".subrecord-form[data-subrecord-form]",a).init_subrecord_form()});$oc=$("#object_container:not(.initialised)");if($oc.length){$(document).triggerHandler("loadedrecordform.aspace",[$oc])}})});$(function(){var a=function(d){var b=$(d);var c="#location";if(b.selector==="#new_location_batch"){c="#location_batch"}$temporary=$(c+"_temporary_",b);$temporaryQuestion=$(c+"_temporary_question_",b);if($temporary.val()!=""){$temporaryQuestion.prop("checked",true)}$temporaryQuestion.on("change",function(){$temporary.val("");$temporary.prop("disabled",function(f,e){return !e})})};$(document).ready(function(){if($("#new_location").length>0){a($("#new_location"))}if($("#new_location_batch").length>0){a($("#new_location_batch"))}$(document).bind("loadedrecordform.aspace",function(b,c){a(("#new_location",c))});$(document).bind("subrecordcreated.aspace",function(d,b,c){if(b==="container_location"){a($(c));$("[id$=__status_]",$(c)).bind("change",function(){$this=$(this);$endDate=$("[id$=__end_date_]",c);if($this.val()=="previous"&&$endDate.val().length==0){$endDate.val($endDate.data("date"))}})}})});$(document).ready(function(){$(".linker:not(.initialised)").linker()})});$(function(){$("button.preview-locations").on("click",function(){var a=$(this).closest("form");AS.openCustomModal("batchPreviewModal",$(this).text(),"<div class='alert alert-info'>Loading...</div>","container",{},this);$.ajax({url:a.attr("action")+"?dry_run=true",type:"POST",data:a.serializeArray(),success:function(b){$(".alert","#batchPreviewModal").replaceWith(AS.renderTemplate("modal_quick_template",{message:b}));$(window).trigger("resize")}})});$("form#new_location_batch").submit(function(){$(".btn-primary",this).addClass("disabled").addClass("busy")})});